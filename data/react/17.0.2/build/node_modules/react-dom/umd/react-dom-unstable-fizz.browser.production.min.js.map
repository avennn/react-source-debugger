{"version":3,"file":"react-dom-unstable-fizz.browser.production.min.js","sources":["../../../../packages/react-server/src/ReactServerStreamConfigBrowser.js","../../../../packages/react-server/src/ReactDOMServerFormatConfig.js","../../../../packages/shared/ReactSymbols.js","../../../../packages/react-server/src/ReactFizzServer.js","../../../../packages/react-dom/src/server/ReactDOMFizzServerBrowser.js"],"sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nexport type Destination = ReadableStreamController;\n\nexport function scheduleWork(callback: () => void) {\n  callback();\n}\n\nexport function flushBuffered(destination: Destination) {\n  // WHATWG Streams do not yet have a way to flush the underlying\n  // transform streams. https://github.com/whatwg/streams/issues/960\n}\n\nexport function beginWriting(destination: Destination) {}\n\nexport function writeChunk(\n  destination: Destination,\n  buffer: Uint8Array,\n): boolean {\n  destination.enqueue(buffer);\n  return destination.desiredSize > 0;\n}\n\nexport function completeWriting(destination: Destination) {}\n\nexport function close(destination: Destination) {\n  destination.close();\n}\n\nconst textEncoder = new TextEncoder();\n\nexport function convertStringToBuffer(content: string): Uint8Array {\n  return textEncoder.encode(content);\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport {convertStringToBuffer} from 'react-server/src/ReactServerStreamConfig';\n\nexport function formatChunkAsString(type: string, props: Object): string {\n  let str = '<' + type + '>';\n  if (typeof props.children === 'string') {\n    str += props.children;\n  }\n  str += '</' + type + '>';\n  return str;\n}\n\nexport function formatChunk(type: string, props: Object): Uint8Array {\n  return convertStringToBuffer(formatChunkAsString(type, props));\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n// ATTENTION\n// When adding new symbols to this file,\n// Please consider also adding to 'react-devtools-shared/src/backend/ReactSymbols'\n\n// The Symbol used to tag the ReactElement-like types. If there is no native Symbol\n// nor polyfill, then a plain number is used for performance.\nexport let REACT_ELEMENT_TYPE = 0xeac7;\nexport let REACT_PORTAL_TYPE = 0xeaca;\nexport let REACT_FRAGMENT_TYPE = 0xeacb;\nexport let REACT_STRICT_MODE_TYPE = 0xeacc;\nexport let REACT_PROFILER_TYPE = 0xead2;\nexport let REACT_PROVIDER_TYPE = 0xeacd;\nexport let REACT_CONTEXT_TYPE = 0xeace;\nexport let REACT_FORWARD_REF_TYPE = 0xead0;\nexport let REACT_SUSPENSE_TYPE = 0xead1;\nexport let REACT_SUSPENSE_LIST_TYPE = 0xead8;\nexport let REACT_MEMO_TYPE = 0xead3;\nexport let REACT_LAZY_TYPE = 0xead4;\nexport let REACT_BLOCK_TYPE = 0xead9;\nexport let REACT_SERVER_BLOCK_TYPE = 0xeada;\nexport let REACT_FUNDAMENTAL_TYPE = 0xead5;\nexport let REACT_SCOPE_TYPE = 0xead7;\nexport let REACT_OPAQUE_ID_TYPE = 0xeae0;\nexport let REACT_DEBUG_TRACING_MODE_TYPE = 0xeae1;\nexport let REACT_OFFSCREEN_TYPE = 0xeae2;\nexport let REACT_LEGACY_HIDDEN_TYPE = 0xeae3;\n\nif (typeof Symbol === 'function' && Symbol.for) {\n  const symbolFor = Symbol.for;\n  REACT_ELEMENT_TYPE = symbolFor('react.element');\n  REACT_PORTAL_TYPE = symbolFor('react.portal');\n  REACT_FRAGMENT_TYPE = symbolFor('react.fragment');\n  REACT_STRICT_MODE_TYPE = symbolFor('react.strict_mode');\n  REACT_PROFILER_TYPE = symbolFor('react.profiler');\n  REACT_PROVIDER_TYPE = symbolFor('react.provider');\n  REACT_CONTEXT_TYPE = symbolFor('react.context');\n  REACT_FORWARD_REF_TYPE = symbolFor('react.forward_ref');\n  REACT_SUSPENSE_TYPE = symbolFor('react.suspense');\n  REACT_SUSPENSE_LIST_TYPE = symbolFor('react.suspense_list');\n  REACT_MEMO_TYPE = symbolFor('react.memo');\n  REACT_LAZY_TYPE = symbolFor('react.lazy');\n  REACT_BLOCK_TYPE = symbolFor('react.block');\n  REACT_SERVER_BLOCK_TYPE = symbolFor('react.server.block');\n  REACT_FUNDAMENTAL_TYPE = symbolFor('react.fundamental');\n  REACT_SCOPE_TYPE = symbolFor('react.scope');\n  REACT_OPAQUE_ID_TYPE = symbolFor('react.opaque.id');\n  REACT_DEBUG_TRACING_MODE_TYPE = symbolFor('react.debug_trace_mode');\n  REACT_OFFSCREEN_TYPE = symbolFor('react.offscreen');\n  REACT_LEGACY_HIDDEN_TYPE = symbolFor('react.legacy_hidden');\n}\n\nconst MAYBE_ITERATOR_SYMBOL = typeof Symbol === 'function' && Symbol.iterator;\nconst FAUX_ITERATOR_SYMBOL = '@@iterator';\n\nexport function getIteratorFn(maybeIterable: ?any): ?() => ?Iterator<*> {\n  if (maybeIterable === null || typeof maybeIterable !== 'object') {\n    return null;\n  }\n  const maybeIterator =\n    (MAYBE_ITERATOR_SYMBOL && maybeIterable[MAYBE_ITERATOR_SYMBOL]) ||\n    maybeIterable[FAUX_ITERATOR_SYMBOL];\n  if (typeof maybeIterator === 'function') {\n    return maybeIterator;\n  }\n  return null;\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {Destination} from './ReactServerStreamConfig';\nimport type {ReactNodeList} from 'shared/ReactTypes';\n\nimport {\n  scheduleWork,\n  beginWriting,\n  writeChunk,\n  completeWriting,\n  flushBuffered,\n  close,\n} from './ReactServerStreamConfig';\nimport {formatChunk} from './ReactServerFormatConfig';\nimport {REACT_ELEMENT_TYPE} from 'shared/ReactSymbols';\n\ntype OpaqueRequest = {\n  destination: Destination,\n  children: ReactNodeList,\n  completedChunks: Array<Uint8Array>,\n  flowing: boolean,\n  ...\n};\n\nexport function createRequest(\n  children: ReactNodeList,\n  destination: Destination,\n): OpaqueRequest {\n  return {destination, children, completedChunks: [], flowing: false};\n}\n\nfunction performWork(request: OpaqueRequest): void {\n  const element = (request.children: any);\n  request.children = null;\n  if (element && element.$$typeof !== REACT_ELEMENT_TYPE) {\n    return;\n  }\n  const type = element.type;\n  const props = element.props;\n  if (typeof type !== 'string') {\n    return;\n  }\n  request.completedChunks.push(formatChunk(type, props));\n  if (request.flowing) {\n    flushCompletedChunks(request);\n  }\n\n  flushBuffered(request.destination);\n}\n\nfunction flushCompletedChunks(request: OpaqueRequest) {\n  const destination = request.destination;\n  const chunks = request.completedChunks;\n  request.completedChunks = [];\n\n  beginWriting(destination);\n  try {\n    for (let i = 0; i < chunks.length; i++) {\n      const chunk = chunks[i];\n      writeChunk(destination, chunk);\n    }\n  } finally {\n    completeWriting(destination);\n  }\n  close(destination);\n}\n\nexport function startWork(request: OpaqueRequest): void {\n  request.flowing = true;\n  scheduleWork(() => performWork(request));\n}\n\nexport function startFlowing(request: OpaqueRequest): void {\n  request.flowing = false;\n  flushCompletedChunks(request);\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {ReactNodeList} from 'shared/ReactTypes';\n\nimport {\n  createRequest,\n  startWork,\n  startFlowing,\n} from 'react-server/src/ReactFizzServer';\n\nfunction renderToReadableStream(children: ReactNodeList): ReadableStream {\n  let request;\n  return new ReadableStream({\n    start(controller) {\n      request = createRequest(children, controller);\n      startWork(request);\n    },\n    pull(controller) {\n      startFlowing(request);\n    },\n    cancel(reason) {},\n  });\n}\n\nexport {renderToReadableStream};\n"],"names":["scheduleWork","callback","flushBuffered","destination","writeChunk","buffer","enqueue","desiredSize","close","textEncoder","TextEncoder","convertStringToBuffer","content","encode","formatChunkAsString","type","props","str","children","formatChunk","REACT_ELEMENT_TYPE","Symbol","for","symbolFor","REACT_PORTAL_TYPE","createRequest","completedChunks","flowing","performWork","request","element","$$typeof","push","flushCompletedChunks","chunks","beginWriting","i","length","chunk","completeWriting","startWork","startFlowing","renderToReadableStream","ReadableStream","start","controller","pull","cancel","reason"],"mappings":"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"}