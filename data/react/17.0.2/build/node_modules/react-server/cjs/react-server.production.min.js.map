{"version":3,"file":"react-server.production.min.js","sources":["../../../../packages/react-server/src/forks/ReactServerStreamConfig.custom.js","../../../../packages/react-server/src/forks/ReactServerFormatConfig.custom.js","../../../../packages/shared/ReactSymbols.js","../../../../packages/react-server/src/ReactFizzServer.js"],"sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n// This is a host config that's used for the `react-server` package on npm.\n// It is only used by third-party renderers.\n//\n// Its API lets you pass the host config as an argument.\n// However, inside the `react-server` we treat host config as a module.\n// This file is a shim between two worlds.\n//\n// It works because the `react-server` bundle is wrapped in something like:\n//\n// module.exports = function ($$$config) {\n//   /* renderer code */\n// }\n//\n// So `$$$config` looks like a global variable, but it's\n// really an argument to a top-level wrapping function.\n\ndeclare var $$$hostConfig: any;\nexport opaque type Destination = mixed; // eslint-disable-line no-undef\n\nexport const scheduleWork = $$$hostConfig.scheduleWork;\nexport const beginWriting = $$$hostConfig.beginWriting;\nexport const writeChunk = $$$hostConfig.writeChunk;\nexport const completeWriting = $$$hostConfig.completeWriting;\nexport const flushBuffered = $$$hostConfig.flushBuffered;\nexport const close = $$$hostConfig.close;\nexport const convertStringToBuffer = $$$hostConfig.convertStringToBuffer;\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n// This is a host config that's used for the `react-server` package on npm.\n// It is only used by third-party renderers.\n//\n// Its API lets you pass the host config as an argument.\n// However, inside the `react-server` we treat host config as a module.\n// This file is a shim between two worlds.\n//\n// It works because the `react-server` bundle is wrapped in something like:\n//\n// module.exports = function ($$$config) {\n//   /* renderer code */\n// }\n//\n// So `$$$config` looks like a global variable, but it's\n// really an argument to a top-level wrapping function.\n\ndeclare var $$$hostConfig: any;\nexport opaque type Destination = mixed; // eslint-disable-line no-undef\n\nexport const formatChunkAsString = $$$hostConfig.formatChunkAsString;\nexport const formatChunk = $$$hostConfig.formatChunk;\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n// ATTENTION\n// When adding new symbols to this file,\n// Please consider also adding to 'react-devtools-shared/src/backend/ReactSymbols'\n\n// The Symbol used to tag the ReactElement-like types. If there is no native Symbol\n// nor polyfill, then a plain number is used for performance.\nexport let REACT_ELEMENT_TYPE = 0xeac7;\nexport let REACT_PORTAL_TYPE = 0xeaca;\nexport let REACT_FRAGMENT_TYPE = 0xeacb;\nexport let REACT_STRICT_MODE_TYPE = 0xeacc;\nexport let REACT_PROFILER_TYPE = 0xead2;\nexport let REACT_PROVIDER_TYPE = 0xeacd;\nexport let REACT_CONTEXT_TYPE = 0xeace;\nexport let REACT_FORWARD_REF_TYPE = 0xead0;\nexport let REACT_SUSPENSE_TYPE = 0xead1;\nexport let REACT_SUSPENSE_LIST_TYPE = 0xead8;\nexport let REACT_MEMO_TYPE = 0xead3;\nexport let REACT_LAZY_TYPE = 0xead4;\nexport let REACT_BLOCK_TYPE = 0xead9;\nexport let REACT_SERVER_BLOCK_TYPE = 0xeada;\nexport let REACT_FUNDAMENTAL_TYPE = 0xead5;\nexport let REACT_SCOPE_TYPE = 0xead7;\nexport let REACT_OPAQUE_ID_TYPE = 0xeae0;\nexport let REACT_DEBUG_TRACING_MODE_TYPE = 0xeae1;\nexport let REACT_OFFSCREEN_TYPE = 0xeae2;\nexport let REACT_LEGACY_HIDDEN_TYPE = 0xeae3;\n\nif (typeof Symbol === 'function' && Symbol.for) {\n  const symbolFor = Symbol.for;\n  REACT_ELEMENT_TYPE = symbolFor('react.element');\n  REACT_PORTAL_TYPE = symbolFor('react.portal');\n  REACT_FRAGMENT_TYPE = symbolFor('react.fragment');\n  REACT_STRICT_MODE_TYPE = symbolFor('react.strict_mode');\n  REACT_PROFILER_TYPE = symbolFor('react.profiler');\n  REACT_PROVIDER_TYPE = symbolFor('react.provider');\n  REACT_CONTEXT_TYPE = symbolFor('react.context');\n  REACT_FORWARD_REF_TYPE = symbolFor('react.forward_ref');\n  REACT_SUSPENSE_TYPE = symbolFor('react.suspense');\n  REACT_SUSPENSE_LIST_TYPE = symbolFor('react.suspense_list');\n  REACT_MEMO_TYPE = symbolFor('react.memo');\n  REACT_LAZY_TYPE = symbolFor('react.lazy');\n  REACT_BLOCK_TYPE = symbolFor('react.block');\n  REACT_SERVER_BLOCK_TYPE = symbolFor('react.server.block');\n  REACT_FUNDAMENTAL_TYPE = symbolFor('react.fundamental');\n  REACT_SCOPE_TYPE = symbolFor('react.scope');\n  REACT_OPAQUE_ID_TYPE = symbolFor('react.opaque.id');\n  REACT_DEBUG_TRACING_MODE_TYPE = symbolFor('react.debug_trace_mode');\n  REACT_OFFSCREEN_TYPE = symbolFor('react.offscreen');\n  REACT_LEGACY_HIDDEN_TYPE = symbolFor('react.legacy_hidden');\n}\n\nconst MAYBE_ITERATOR_SYMBOL = typeof Symbol === 'function' && Symbol.iterator;\nconst FAUX_ITERATOR_SYMBOL = '@@iterator';\n\nexport function getIteratorFn(maybeIterable: ?any): ?() => ?Iterator<*> {\n  if (maybeIterable === null || typeof maybeIterable !== 'object') {\n    return null;\n  }\n  const maybeIterator =\n    (MAYBE_ITERATOR_SYMBOL && maybeIterable[MAYBE_ITERATOR_SYMBOL]) ||\n    maybeIterable[FAUX_ITERATOR_SYMBOL];\n  if (typeof maybeIterator === 'function') {\n    return maybeIterator;\n  }\n  return null;\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {Destination} from './ReactServerStreamConfig';\nimport type {ReactNodeList} from 'shared/ReactTypes';\n\nimport {\n  scheduleWork,\n  beginWriting,\n  writeChunk,\n  completeWriting,\n  flushBuffered,\n  close,\n} from './ReactServerStreamConfig';\nimport {formatChunk} from './ReactServerFormatConfig';\nimport {REACT_ELEMENT_TYPE} from 'shared/ReactSymbols';\n\ntype OpaqueRequest = {\n  destination: Destination,\n  children: ReactNodeList,\n  completedChunks: Array<Uint8Array>,\n  flowing: boolean,\n  ...\n};\n\nexport function createRequest(\n  children: ReactNodeList,\n  destination: Destination,\n): OpaqueRequest {\n  return {destination, children, completedChunks: [], flowing: false};\n}\n\nfunction performWork(request: OpaqueRequest): void {\n  const element = (request.children: any);\n  request.children = null;\n  if (element && element.$$typeof !== REACT_ELEMENT_TYPE) {\n    return;\n  }\n  const type = element.type;\n  const props = element.props;\n  if (typeof type !== 'string') {\n    return;\n  }\n  request.completedChunks.push(formatChunk(type, props));\n  if (request.flowing) {\n    flushCompletedChunks(request);\n  }\n\n  flushBuffered(request.destination);\n}\n\nfunction flushCompletedChunks(request: OpaqueRequest) {\n  const destination = request.destination;\n  const chunks = request.completedChunks;\n  request.completedChunks = [];\n\n  beginWriting(destination);\n  try {\n    for (let i = 0; i < chunks.length; i++) {\n      const chunk = chunks[i];\n      writeChunk(destination, chunk);\n    }\n  } finally {\n    completeWriting(destination);\n  }\n  close(destination);\n}\n\nexport function startWork(request: OpaqueRequest): void {\n  request.flowing = true;\n  scheduleWork(() => performWork(request));\n}\n\nexport function startFlowing(request: OpaqueRequest): void {\n  request.flowing = false;\n  flushCompletedChunks(request);\n}\n"],"names":["scheduleWork","$$$hostConfig","beginWriting","writeChunk","completeWriting","flushBuffered","close","convertStringToBuffer","formatChunkAsString","formatChunk","REACT_ELEMENT_TYPE","Symbol","for","symbolFor","REACT_PORTAL_TYPE","createRequest","children","destination","completedChunks","flowing","performWork","request","element","$$typeof","type","props","push","flushCompletedChunks","chunks","i","length","chunk","startWork","startFlowing"],"mappings":"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"}