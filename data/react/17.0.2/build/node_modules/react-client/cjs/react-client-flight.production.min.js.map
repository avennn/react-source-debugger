{"version":3,"file":"react-client-flight.production.min.js","sources":["../../../../packages/react-client/src/forks/ReactFlightClientHostConfig.custom.js","../../../../packages/shared/ReactSymbols.js","../../../../packages/react-client/src/ReactFlightClient.js","../../../../packages/react-client/src/ReactFlightClientStream.js"],"sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n// This is a host config that's used for the `react-server` package on npm.\n// It is only used by third-party renderers.\n//\n// Its API lets you pass the host config as an argument.\n// However, inside the `react-server` we treat host config as a module.\n// This file is a shim between two worlds.\n//\n// It works because the `react-server` bundle is wrapped in something like:\n//\n// module.exports = function ($$$config) {\n//   /* renderer code */\n// }\n//\n// So `$$$config` looks like a global variable, but it's\n// really an argument to a top-level wrapping function.\n\ndeclare var $$$hostConfig: any;\n\nexport type Response = any;\nexport opaque type ModuleMetaData = mixed; // eslint-disable-line no-undef\nexport opaque type ModuleReference<T> = mixed; // eslint-disable-line no-undef\nexport const resolveModuleReference = $$$hostConfig.resolveModuleReference;\nexport const preloadModule = $$$hostConfig.preloadModule;\nexport const requireModule = $$$hostConfig.requireModule;\n\nexport opaque type Source = mixed; // eslint-disable-line no-undef\n\nexport type UninitializedModel = string;\nexport const parseModel = $$$hostConfig.parseModel;\n\nexport opaque type StringDecoder = mixed; // eslint-disable-line no-undef\n\nexport const supportsBinaryStreams = $$$hostConfig.supportsBinaryStreams;\nexport const createStringDecoder = $$$hostConfig.createStringDecoder;\nexport const readPartialStringChunk = $$$hostConfig.readPartialStringChunk;\nexport const readFinalStringChunk = $$$hostConfig.readFinalStringChunk;\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n// ATTENTION\n// When adding new symbols to this file,\n// Please consider also adding to 'react-devtools-shared/src/backend/ReactSymbols'\n\n// The Symbol used to tag the ReactElement-like types. If there is no native Symbol\n// nor polyfill, then a plain number is used for performance.\nexport let REACT_ELEMENT_TYPE = 0xeac7;\nexport let REACT_PORTAL_TYPE = 0xeaca;\nexport let REACT_FRAGMENT_TYPE = 0xeacb;\nexport let REACT_STRICT_MODE_TYPE = 0xeacc;\nexport let REACT_PROFILER_TYPE = 0xead2;\nexport let REACT_PROVIDER_TYPE = 0xeacd;\nexport let REACT_CONTEXT_TYPE = 0xeace;\nexport let REACT_FORWARD_REF_TYPE = 0xead0;\nexport let REACT_SUSPENSE_TYPE = 0xead1;\nexport let REACT_SUSPENSE_LIST_TYPE = 0xead8;\nexport let REACT_MEMO_TYPE = 0xead3;\nexport let REACT_LAZY_TYPE = 0xead4;\nexport let REACT_BLOCK_TYPE = 0xead9;\nexport let REACT_SERVER_BLOCK_TYPE = 0xeada;\nexport let REACT_FUNDAMENTAL_TYPE = 0xead5;\nexport let REACT_SCOPE_TYPE = 0xead7;\nexport let REACT_OPAQUE_ID_TYPE = 0xeae0;\nexport let REACT_DEBUG_TRACING_MODE_TYPE = 0xeae1;\nexport let REACT_OFFSCREEN_TYPE = 0xeae2;\nexport let REACT_LEGACY_HIDDEN_TYPE = 0xeae3;\n\nif (typeof Symbol === 'function' && Symbol.for) {\n  const symbolFor = Symbol.for;\n  REACT_ELEMENT_TYPE = symbolFor('react.element');\n  REACT_PORTAL_TYPE = symbolFor('react.portal');\n  REACT_FRAGMENT_TYPE = symbolFor('react.fragment');\n  REACT_STRICT_MODE_TYPE = symbolFor('react.strict_mode');\n  REACT_PROFILER_TYPE = symbolFor('react.profiler');\n  REACT_PROVIDER_TYPE = symbolFor('react.provider');\n  REACT_CONTEXT_TYPE = symbolFor('react.context');\n  REACT_FORWARD_REF_TYPE = symbolFor('react.forward_ref');\n  REACT_SUSPENSE_TYPE = symbolFor('react.suspense');\n  REACT_SUSPENSE_LIST_TYPE = symbolFor('react.suspense_list');\n  REACT_MEMO_TYPE = symbolFor('react.memo');\n  REACT_LAZY_TYPE = symbolFor('react.lazy');\n  REACT_BLOCK_TYPE = symbolFor('react.block');\n  REACT_SERVER_BLOCK_TYPE = symbolFor('react.server.block');\n  REACT_FUNDAMENTAL_TYPE = symbolFor('react.fundamental');\n  REACT_SCOPE_TYPE = symbolFor('react.scope');\n  REACT_OPAQUE_ID_TYPE = symbolFor('react.opaque.id');\n  REACT_DEBUG_TRACING_MODE_TYPE = symbolFor('react.debug_trace_mode');\n  REACT_OFFSCREEN_TYPE = symbolFor('react.offscreen');\n  REACT_LEGACY_HIDDEN_TYPE = symbolFor('react.legacy_hidden');\n}\n\nconst MAYBE_ITERATOR_SYMBOL = typeof Symbol === 'function' && Symbol.iterator;\nconst FAUX_ITERATOR_SYMBOL = '@@iterator';\n\nexport function getIteratorFn(maybeIterable: ?any): ?() => ?Iterator<*> {\n  if (maybeIterable === null || typeof maybeIterable !== 'object') {\n    return null;\n  }\n  const maybeIterator =\n    (MAYBE_ITERATOR_SYMBOL && maybeIterable[MAYBE_ITERATOR_SYMBOL]) ||\n    maybeIterable[FAUX_ITERATOR_SYMBOL];\n  if (typeof maybeIterator === 'function') {\n    return maybeIterator;\n  }\n  return null;\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {Wakeable} from 'shared/ReactTypes';\nimport type {BlockComponent, BlockRenderFunction} from 'react/src/ReactBlock';\nimport type {LazyComponent} from 'react/src/ReactLazy';\n\nimport type {\n  ModuleReference,\n  ModuleMetaData,\n  UninitializedModel,\n  Response,\n} from './ReactFlightClientHostConfig';\n\nimport {\n  resolveModuleReference,\n  preloadModule,\n  requireModule,\n  parseModel,\n} from './ReactFlightClientHostConfig';\n\nimport {\n  REACT_LAZY_TYPE,\n  REACT_BLOCK_TYPE,\n  REACT_ELEMENT_TYPE,\n} from 'shared/ReactSymbols';\n\nexport type JSONValue =\n  | number\n  | null\n  | boolean\n  | string\n  | {+[key: string]: JSONValue}\n  | $ReadOnlyArray<JSONValue>;\n\nconst PENDING = 0;\nconst RESOLVED_MODEL = 1;\nconst INITIALIZED = 2;\nconst ERRORED = 3;\n\ntype PendingChunk = {\n  _status: 0,\n  _value: null | Array<() => mixed>,\n  _response: Response,\n  then(resolve: () => mixed): void,\n};\ntype ResolvedModelChunk = {\n  _status: 1,\n  _value: UninitializedModel,\n  _response: Response,\n  then(resolve: () => mixed): void,\n};\ntype InitializedChunk<T> = {\n  _status: 2,\n  _value: T,\n  _response: Response,\n  then(resolve: () => mixed): void,\n};\ntype ErroredChunk = {\n  _status: 3,\n  _value: Error,\n  _response: Response,\n  then(resolve: () => mixed): void,\n};\ntype SomeChunk<T> =\n  | PendingChunk\n  | ResolvedModelChunk\n  | InitializedChunk<T>\n  | ErroredChunk;\n\nfunction Chunk(status: any, value: any, response: Response) {\n  this._status = status;\n  this._value = value;\n  this._response = response;\n}\nChunk.prototype.then = function<T>(resolve: () => mixed) {\n  const chunk: SomeChunk<T> = this;\n  if (chunk._status === PENDING) {\n    if (chunk._value === null) {\n      chunk._value = [];\n    }\n    chunk._value.push(resolve);\n  } else {\n    resolve();\n  }\n};\n\nexport type ResponseBase = {\n  _chunks: Map<number, SomeChunk<any>>,\n  readRoot<T>(): T,\n  ...\n};\n\nexport type {Response};\n\nfunction readChunk<T>(chunk: SomeChunk<T>): T {\n  switch (chunk._status) {\n    case INITIALIZED:\n      return chunk._value;\n    case RESOLVED_MODEL:\n      return initializeModelChunk(chunk);\n    case PENDING:\n      // eslint-disable-next-line no-throw-literal\n      throw (chunk: Wakeable);\n    default:\n      throw chunk._value;\n  }\n}\n\nfunction readRoot<T>(): T {\n  const response: Response = this;\n  const chunk = getChunk(response, 0);\n  return readChunk(chunk);\n}\n\nfunction createPendingChunk(response: Response): PendingChunk {\n  return new Chunk(PENDING, null, response);\n}\n\nfunction createErrorChunk(response: Response, error: Error): ErroredChunk {\n  return new Chunk(ERRORED, error, response);\n}\n\nfunction wakeChunk(listeners: null | Array<() => mixed>) {\n  if (listeners !== null) {\n    for (let i = 0; i < listeners.length; i++) {\n      const listener = listeners[i];\n      listener();\n    }\n  }\n}\n\nfunction triggerErrorOnChunk<T>(chunk: SomeChunk<T>, error: Error): void {\n  if (chunk._status !== PENDING) {\n    // We already resolved. We didn't expect to see this.\n    return;\n  }\n  const listeners = chunk._value;\n  const erroredChunk: ErroredChunk = (chunk: any);\n  erroredChunk._status = ERRORED;\n  erroredChunk._value = error;\n  wakeChunk(listeners);\n}\n\nfunction createResolvedModelChunk(\n  response: Response,\n  value: UninitializedModel,\n): ResolvedModelChunk {\n  return new Chunk(RESOLVED_MODEL, value, response);\n}\n\nfunction resolveModelChunk<T>(\n  chunk: SomeChunk<T>,\n  value: UninitializedModel,\n): void {\n  if (chunk._status !== PENDING) {\n    // We already resolved. We didn't expect to see this.\n    return;\n  }\n  const listeners = chunk._value;\n  const resolvedChunk: ResolvedModelChunk = (chunk: any);\n  resolvedChunk._status = RESOLVED_MODEL;\n  resolvedChunk._value = value;\n  wakeChunk(listeners);\n}\n\nfunction initializeModelChunk<T>(chunk: ResolvedModelChunk): T {\n  const value: T = parseModel(chunk._response, chunk._value);\n  const initializedChunk: InitializedChunk<T> = (chunk: any);\n  initializedChunk._status = INITIALIZED;\n  initializedChunk._value = value;\n  return value;\n}\n\n// Report that any missing chunks in the model is now going to throw this\n// error upon read. Also notify any pending promises.\nexport function reportGlobalError(response: Response, error: Error): void {\n  response._chunks.forEach(chunk => {\n    // If this chunk was already resolved or errored, it won't\n    // trigger an error but if it wasn't then we need to\n    // because we won't be getting any new data to resolve it.\n    triggerErrorOnChunk(chunk, error);\n  });\n}\n\nfunction readMaybeChunk<T>(maybeChunk: SomeChunk<T> | T): T {\n  if (maybeChunk == null || !(maybeChunk instanceof Chunk)) {\n    // $FlowFixMe\n    return maybeChunk;\n  }\n  const chunk: SomeChunk<T> = (maybeChunk: any);\n  return readChunk(chunk);\n}\n\nfunction createElement(type, key, props): React$Element<any> {\n  const element: any = {\n    // This tag allows us to uniquely identify this as a React Element\n    $$typeof: REACT_ELEMENT_TYPE,\n\n    // Built-in properties that belong on the element\n    type: type,\n    key: key,\n    ref: null,\n    props: props,\n\n    // Record the component responsible for creating this element.\n    _owner: null,\n  };\n  if (__DEV__) {\n    // We don't really need to add any of these but keeping them for good measure.\n    // Unfortunately, _store is enumerable in jest matchers so for equality to\n    // work, I need to keep it or make _store non-enumerable in the other file.\n    element._store = {};\n    Object.defineProperty(element._store, 'validated', {\n      configurable: false,\n      enumerable: false,\n      writable: true,\n      value: true, // This element has already been validated on the server.\n    });\n    Object.defineProperty(element, '_self', {\n      configurable: false,\n      enumerable: false,\n      writable: false,\n      value: null,\n    });\n    Object.defineProperty(element, '_source', {\n      configurable: false,\n      enumerable: false,\n      writable: false,\n      value: null,\n    });\n  }\n  return element;\n}\n\ntype UninitializedBlockPayload<Data> = [\n  mixed,\n  ModuleMetaData | SomeChunk<ModuleMetaData>,\n  Data | SomeChunk<Data>,\n  Response,\n];\n\nfunction initializeBlock<Props, Data>(\n  tuple: UninitializedBlockPayload<Data>,\n): BlockComponent<Props, Data> {\n  // Require module first and then data. The ordering matters.\n  const moduleMetaData: ModuleMetaData = readMaybeChunk(tuple[1]);\n  const moduleReference: ModuleReference<\n    BlockRenderFunction<Props, Data>,\n  > = resolveModuleReference(moduleMetaData);\n  // TODO: Do this earlier, as the chunk is resolved.\n  preloadModule(moduleReference);\n\n  const moduleExport = requireModule(moduleReference);\n\n  // The ordering here is important because this call might suspend.\n  // We don't want that to prevent the module graph for being initialized.\n  const data: Data = readMaybeChunk(tuple[2]);\n\n  return {\n    $$typeof: REACT_BLOCK_TYPE,\n    _status: -1,\n    _data: data,\n    _render: moduleExport,\n  };\n}\n\nfunction createLazyBlock<Props, Data>(\n  tuple: UninitializedBlockPayload<Data>,\n): LazyComponent<BlockComponent<Props, Data>, UninitializedBlockPayload<Data>> {\n  const lazyType: LazyComponent<\n    BlockComponent<Props, Data>,\n    UninitializedBlockPayload<Data>,\n  > = {\n    $$typeof: REACT_LAZY_TYPE,\n    _payload: tuple,\n    _init: initializeBlock,\n  };\n  return lazyType;\n}\n\nfunction getChunk(response: Response, id: number): SomeChunk<any> {\n  const chunks = response._chunks;\n  let chunk = chunks.get(id);\n  if (!chunk) {\n    chunk = createPendingChunk(response);\n    chunks.set(id, chunk);\n  }\n  return chunk;\n}\n\nexport function parseModelString(\n  response: Response,\n  parentObject: Object,\n  value: string,\n): any {\n  if (value[0] === '$') {\n    if (value === '$') {\n      return REACT_ELEMENT_TYPE;\n    } else if (value[1] === '$' || value[1] === '@') {\n      // This was an escaped string value.\n      return value.substring(1);\n    } else {\n      const id = parseInt(value.substring(1), 16);\n      const chunk = getChunk(response, id);\n      if (parentObject[0] === REACT_BLOCK_TYPE) {\n        // Block types know how to deal with lazy values.\n        return chunk;\n      }\n      // For anything else we must Suspend this block if\n      // we don't yet have the value.\n      return readChunk(chunk);\n    }\n  }\n  if (value === '@') {\n    return REACT_BLOCK_TYPE;\n  }\n  return value;\n}\n\nexport function parseModelTuple(\n  response: Response,\n  value: {+[key: string]: JSONValue} | $ReadOnlyArray<JSONValue>,\n): any {\n  const tuple: [mixed, mixed, mixed, mixed] = (value: any);\n  if (tuple[0] === REACT_ELEMENT_TYPE) {\n    // TODO: Consider having React just directly accept these arrays as elements.\n    // Or even change the ReactElement type to be an array.\n    return createElement(tuple[1], tuple[2], tuple[3]);\n  } else if (tuple[0] === REACT_BLOCK_TYPE) {\n    // TODO: Consider having React just directly accept these arrays as blocks.\n    return createLazyBlock((tuple: any));\n  }\n  return value;\n}\n\nexport function createResponse(): ResponseBase {\n  const chunks: Map<number, SomeChunk<any>> = new Map();\n  const response = {\n    _chunks: chunks,\n    readRoot: readRoot,\n  };\n  return response;\n}\n\nexport function resolveModel(\n  response: Response,\n  id: number,\n  model: UninitializedModel,\n): void {\n  const chunks = response._chunks;\n  const chunk = chunks.get(id);\n  if (!chunk) {\n    chunks.set(id, createResolvedModelChunk(response, model));\n  } else {\n    resolveModelChunk(chunk, model);\n  }\n}\n\nexport function resolveError(\n  response: Response,\n  id: number,\n  message: string,\n  stack: string,\n): void {\n  const error = new Error(message);\n  error.stack = stack;\n  const chunks = response._chunks;\n  const chunk = chunks.get(id);\n  if (!chunk) {\n    chunks.set(id, createErrorChunk(response, error));\n  } else {\n    triggerErrorOnChunk(chunk, error);\n  }\n}\n\nexport function close(response: Response): void {\n  // In case there are any remaining unresolved chunks, they won't\n  // be resolved now. So we need to issue an error to those.\n  // Ideally we should be able to early bail out if we kept a\n  // ref count of pending chunks.\n  reportGlobalError(response, new Error('Connection closed.'));\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {Response} from './ReactFlightClientHostConfigStream';\n\nimport {\n  resolveModel,\n  resolveError,\n  createResponse as createResponseBase,\n  parseModelString,\n  parseModelTuple,\n} from './ReactFlightClient';\n\nimport {\n  readPartialStringChunk,\n  readFinalStringChunk,\n  supportsBinaryStreams,\n  createStringDecoder,\n} from './ReactFlightClientHostConfig';\n\nexport type {Response};\n\nfunction processFullRow(response: Response, row: string): void {\n  if (row === '') {\n    return;\n  }\n  const tag = row[0];\n  switch (tag) {\n    case 'J': {\n      const colon = row.indexOf(':', 1);\n      const id = parseInt(row.substring(1, colon), 16);\n      const json = row.substring(colon + 1);\n      resolveModel(response, id, json);\n      return;\n    }\n    case 'E': {\n      const colon = row.indexOf(':', 1);\n      const id = parseInt(row.substring(1, colon), 16);\n      const json = row.substring(colon + 1);\n      const errorInfo = JSON.parse(json);\n      resolveError(response, id, errorInfo.message, errorInfo.stack);\n      return;\n    }\n    default: {\n      // Assume this is the root model.\n      resolveModel(response, 0, row);\n      return;\n    }\n  }\n}\n\nexport function processStringChunk(\n  response: Response,\n  chunk: string,\n  offset: number,\n): void {\n  let linebreak = chunk.indexOf('\\n', offset);\n  while (linebreak > -1) {\n    const fullrow = response._partialRow + chunk.substring(offset, linebreak);\n    processFullRow(response, fullrow);\n    response._partialRow = '';\n    offset = linebreak + 1;\n    linebreak = chunk.indexOf('\\n', offset);\n  }\n  response._partialRow += chunk.substring(offset);\n}\n\nexport function processBinaryChunk(\n  response: Response,\n  chunk: Uint8Array,\n): void {\n  if (!supportsBinaryStreams) {\n    throw new Error(\"This environment don't support binary chunks.\");\n  }\n  const stringDecoder = response._stringDecoder;\n  let linebreak = chunk.indexOf(10); // newline\n  while (linebreak > -1) {\n    const fullrow =\n      response._partialRow +\n      readFinalStringChunk(stringDecoder, chunk.subarray(0, linebreak));\n    processFullRow(response, fullrow);\n    response._partialRow = '';\n    chunk = chunk.subarray(linebreak + 1);\n    linebreak = chunk.indexOf(10); // newline\n  }\n  response._partialRow += readPartialStringChunk(stringDecoder, chunk);\n}\n\nfunction createFromJSONCallback(response: Response) {\n  return function(key: string, value: JSONValue) {\n    if (typeof value === 'string') {\n      // We can't use .bind here because we need the \"this\" value.\n      return parseModelString(response, this, value);\n    }\n    if (typeof value === 'object' && value !== null) {\n      return parseModelTuple(response, value);\n    }\n    return value;\n  };\n}\n\nexport function createResponse(): Response {\n  // NOTE: CHECK THE COMPILER OUTPUT EACH TIME YOU CHANGE THIS.\n  // It should be inlined to one object literal but minor changes can break it.\n  const stringDecoder = supportsBinaryStreams ? createStringDecoder() : null;\n  const response: any = createResponseBase();\n  response._partialRow = '';\n  if (supportsBinaryStreams) {\n    response._stringDecoder = stringDecoder;\n  }\n  // Don't inline this call because it causes closure to outline the call above.\n  response._fromJSON = createFromJSONCallback(response);\n  return response;\n}\n\nexport {reportGlobalError, close} from './ReactFlightClient';\n"],"names":["resolveModuleReference","$$$hostConfig","preloadModule","requireModule","parseModel","supportsBinaryStreams","createStringDecoder","readPartialStringChunk","readFinalStringChunk","REACT_ELEMENT_TYPE","REACT_LAZY_TYPE","REACT_BLOCK_TYPE","Symbol","for","symbolFor","REACT_PORTAL_TYPE","REACT_SERVER_BLOCK_TYPE","PENDING","RESOLVED_MODEL","INITIALIZED","ERRORED","Chunk","status","value","response","_status","_value","_response","prototype","then","resolve","chunk","push","readChunk","initializeModelChunk","readRoot","getChunk","createPendingChunk","createErrorChunk","error","wakeChunk","listeners","i","length","listener","triggerErrorOnChunk","erroredChunk","createResolvedModelChunk","resolveModelChunk","resolvedChunk","initializedChunk","reportGlobalError","_chunks","forEach","readMaybeChunk","maybeChunk","createElement","type","key","props","element","$$typeof","ref","_owner","initializeBlock","tuple","moduleMetaData","moduleReference","moduleExport","data","_data","_render","createLazyBlock","lazyType","_payload","_init","id","chunks","get","set","parseModelString","parentObject","substring","parseInt","parseModelTuple","createResponse","Map","resolveModel","model","resolveError","message","stack","Error","close","processFullRow","row","tag","colon","indexOf","json","errorInfo","JSON","parse","processStringChunk","offset","linebreak","fullrow","_partialRow","processBinaryChunk","stringDecoder","_stringDecoder","subarray","createFromJSONCallback","createResponseBase","_fromJSON"],"mappings":"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"}