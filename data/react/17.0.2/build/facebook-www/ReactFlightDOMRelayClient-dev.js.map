{"version":3,"file":"ReactFlightDOMRelayClient-dev.js","sources":["../../packages/react-transport-dom-relay/src/ReactFlightDOMRelayClientHostConfig.js","../../packages/shared/ReactSymbols.js","../../packages/react-client/src/ReactFlightClient.js"],"sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {JSONValue, ResponseBase} from 'react-client/src/ReactFlightClient';\n\nimport {\n  parseModelString,\n  parseModelTuple,\n} from 'react-client/src/ReactFlightClient';\n\nexport {\n  resolveModuleReference,\n  preloadModule,\n  requireModule,\n} from 'ReactFlightDOMRelayClientIntegration';\n\nexport type {\n  ModuleReference,\n  ModuleMetaData,\n} from 'ReactFlightDOMRelayClientIntegration';\n\nexport opaque type UninitializedModel = JSONValue;\n\nexport type Response = ResponseBase;\n\nfunction parseModelRecursively(response: Response, parentObj, value) {\n  if (typeof value === 'string') {\n    return parseModelString(response, parentObj, value);\n  }\n  if (typeof value === 'object' && value !== null) {\n    if (Array.isArray(value)) {\n      for (let i = 0; i < value.length; i++) {\n        (value: any)[i] = parseModelRecursively(response, value, value[i]);\n      }\n      return parseModelTuple(response, value);\n    } else {\n      for (const innerKey in value) {\n        (value: any)[innerKey] = parseModelRecursively(\n          response,\n          value,\n          value[innerKey],\n        );\n      }\n    }\n  }\n  return value;\n}\n\nconst dummy = {};\n\nexport function parseModel<T>(response: Response, json: UninitializedModel): T {\n  return (parseModelRecursively(response, dummy, json): any);\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n// ATTENTION\n// When adding new symbols to this file,\n// Please consider also adding to 'react-devtools-shared/src/backend/ReactSymbols'\n\n// The Symbol used to tag the ReactElement-like types. If there is no native Symbol\n// nor polyfill, then a plain number is used for performance.\nexport let REACT_ELEMENT_TYPE = 0xeac7;\nexport let REACT_PORTAL_TYPE = 0xeaca;\nexport let REACT_FRAGMENT_TYPE = 0xeacb;\nexport let REACT_STRICT_MODE_TYPE = 0xeacc;\nexport let REACT_PROFILER_TYPE = 0xead2;\nexport let REACT_PROVIDER_TYPE = 0xeacd;\nexport let REACT_CONTEXT_TYPE = 0xeace;\nexport let REACT_FORWARD_REF_TYPE = 0xead0;\nexport let REACT_SUSPENSE_TYPE = 0xead1;\nexport let REACT_SUSPENSE_LIST_TYPE = 0xead8;\nexport let REACT_MEMO_TYPE = 0xead3;\nexport let REACT_LAZY_TYPE = 0xead4;\nexport let REACT_BLOCK_TYPE = 0xead9;\nexport let REACT_SERVER_BLOCK_TYPE = 0xeada;\nexport let REACT_FUNDAMENTAL_TYPE = 0xead5;\nexport let REACT_SCOPE_TYPE = 0xead7;\nexport let REACT_OPAQUE_ID_TYPE = 0xeae0;\nexport let REACT_DEBUG_TRACING_MODE_TYPE = 0xeae1;\nexport let REACT_OFFSCREEN_TYPE = 0xeae2;\nexport let REACT_LEGACY_HIDDEN_TYPE = 0xeae3;\n\nif (typeof Symbol === 'function' && Symbol.for) {\n  const symbolFor = Symbol.for;\n  REACT_ELEMENT_TYPE = symbolFor('react.element');\n  REACT_PORTAL_TYPE = symbolFor('react.portal');\n  REACT_FRAGMENT_TYPE = symbolFor('react.fragment');\n  REACT_STRICT_MODE_TYPE = symbolFor('react.strict_mode');\n  REACT_PROFILER_TYPE = symbolFor('react.profiler');\n  REACT_PROVIDER_TYPE = symbolFor('react.provider');\n  REACT_CONTEXT_TYPE = symbolFor('react.context');\n  REACT_FORWARD_REF_TYPE = symbolFor('react.forward_ref');\n  REACT_SUSPENSE_TYPE = symbolFor('react.suspense');\n  REACT_SUSPENSE_LIST_TYPE = symbolFor('react.suspense_list');\n  REACT_MEMO_TYPE = symbolFor('react.memo');\n  REACT_LAZY_TYPE = symbolFor('react.lazy');\n  REACT_BLOCK_TYPE = symbolFor('react.block');\n  REACT_SERVER_BLOCK_TYPE = symbolFor('react.server.block');\n  REACT_FUNDAMENTAL_TYPE = symbolFor('react.fundamental');\n  REACT_SCOPE_TYPE = symbolFor('react.scope');\n  REACT_OPAQUE_ID_TYPE = symbolFor('react.opaque.id');\n  REACT_DEBUG_TRACING_MODE_TYPE = symbolFor('react.debug_trace_mode');\n  REACT_OFFSCREEN_TYPE = symbolFor('react.offscreen');\n  REACT_LEGACY_HIDDEN_TYPE = symbolFor('react.legacy_hidden');\n}\n\nconst MAYBE_ITERATOR_SYMBOL = typeof Symbol === 'function' && Symbol.iterator;\nconst FAUX_ITERATOR_SYMBOL = '@@iterator';\n\nexport function getIteratorFn(maybeIterable: ?any): ?() => ?Iterator<*> {\n  if (maybeIterable === null || typeof maybeIterable !== 'object') {\n    return null;\n  }\n  const maybeIterator =\n    (MAYBE_ITERATOR_SYMBOL && maybeIterable[MAYBE_ITERATOR_SYMBOL]) ||\n    maybeIterable[FAUX_ITERATOR_SYMBOL];\n  if (typeof maybeIterator === 'function') {\n    return maybeIterator;\n  }\n  return null;\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {Wakeable} from 'shared/ReactTypes';\nimport type {BlockComponent, BlockRenderFunction} from 'react/src/ReactBlock';\nimport type {LazyComponent} from 'react/src/ReactLazy';\n\nimport type {\n  ModuleReference,\n  ModuleMetaData,\n  UninitializedModel,\n  Response,\n} from './ReactFlightClientHostConfig';\n\nimport {\n  resolveModuleReference,\n  preloadModule,\n  requireModule,\n  parseModel,\n} from './ReactFlightClientHostConfig';\n\nimport {\n  REACT_LAZY_TYPE,\n  REACT_BLOCK_TYPE,\n  REACT_ELEMENT_TYPE,\n} from 'shared/ReactSymbols';\n\nexport type JSONValue =\n  | number\n  | null\n  | boolean\n  | string\n  | {+[key: string]: JSONValue}\n  | $ReadOnlyArray<JSONValue>;\n\nconst PENDING = 0;\nconst RESOLVED_MODEL = 1;\nconst INITIALIZED = 2;\nconst ERRORED = 3;\n\ntype PendingChunk = {\n  _status: 0,\n  _value: null | Array<() => mixed>,\n  _response: Response,\n  then(resolve: () => mixed): void,\n};\ntype ResolvedModelChunk = {\n  _status: 1,\n  _value: UninitializedModel,\n  _response: Response,\n  then(resolve: () => mixed): void,\n};\ntype InitializedChunk<T> = {\n  _status: 2,\n  _value: T,\n  _response: Response,\n  then(resolve: () => mixed): void,\n};\ntype ErroredChunk = {\n  _status: 3,\n  _value: Error,\n  _response: Response,\n  then(resolve: () => mixed): void,\n};\ntype SomeChunk<T> =\n  | PendingChunk\n  | ResolvedModelChunk\n  | InitializedChunk<T>\n  | ErroredChunk;\n\nfunction Chunk(status: any, value: any, response: Response) {\n  this._status = status;\n  this._value = value;\n  this._response = response;\n}\nChunk.prototype.then = function<T>(resolve: () => mixed) {\n  const chunk: SomeChunk<T> = this;\n  if (chunk._status === PENDING) {\n    if (chunk._value === null) {\n      chunk._value = [];\n    }\n    chunk._value.push(resolve);\n  } else {\n    resolve();\n  }\n};\n\nexport type ResponseBase = {\n  _chunks: Map<number, SomeChunk<any>>,\n  readRoot<T>(): T,\n  ...\n};\n\nexport type {Response};\n\nfunction readChunk<T>(chunk: SomeChunk<T>): T {\n  switch (chunk._status) {\n    case INITIALIZED:\n      return chunk._value;\n    case RESOLVED_MODEL:\n      return initializeModelChunk(chunk);\n    case PENDING:\n      // eslint-disable-next-line no-throw-literal\n      throw (chunk: Wakeable);\n    default:\n      throw chunk._value;\n  }\n}\n\nfunction readRoot<T>(): T {\n  const response: Response = this;\n  const chunk = getChunk(response, 0);\n  return readChunk(chunk);\n}\n\nfunction createPendingChunk(response: Response): PendingChunk {\n  return new Chunk(PENDING, null, response);\n}\n\nfunction createErrorChunk(response: Response, error: Error): ErroredChunk {\n  return new Chunk(ERRORED, error, response);\n}\n\nfunction wakeChunk(listeners: null | Array<() => mixed>) {\n  if (listeners !== null) {\n    for (let i = 0; i < listeners.length; i++) {\n      const listener = listeners[i];\n      listener();\n    }\n  }\n}\n\nfunction triggerErrorOnChunk<T>(chunk: SomeChunk<T>, error: Error): void {\n  if (chunk._status !== PENDING) {\n    // We already resolved. We didn't expect to see this.\n    return;\n  }\n  const listeners = chunk._value;\n  const erroredChunk: ErroredChunk = (chunk: any);\n  erroredChunk._status = ERRORED;\n  erroredChunk._value = error;\n  wakeChunk(listeners);\n}\n\nfunction createResolvedModelChunk(\n  response: Response,\n  value: UninitializedModel,\n): ResolvedModelChunk {\n  return new Chunk(RESOLVED_MODEL, value, response);\n}\n\nfunction resolveModelChunk<T>(\n  chunk: SomeChunk<T>,\n  value: UninitializedModel,\n): void {\n  if (chunk._status !== PENDING) {\n    // We already resolved. We didn't expect to see this.\n    return;\n  }\n  const listeners = chunk._value;\n  const resolvedChunk: ResolvedModelChunk = (chunk: any);\n  resolvedChunk._status = RESOLVED_MODEL;\n  resolvedChunk._value = value;\n  wakeChunk(listeners);\n}\n\nfunction initializeModelChunk<T>(chunk: ResolvedModelChunk): T {\n  const value: T = parseModel(chunk._response, chunk._value);\n  const initializedChunk: InitializedChunk<T> = (chunk: any);\n  initializedChunk._status = INITIALIZED;\n  initializedChunk._value = value;\n  return value;\n}\n\n// Report that any missing chunks in the model is now going to throw this\n// error upon read. Also notify any pending promises.\nexport function reportGlobalError(response: Response, error: Error): void {\n  response._chunks.forEach(chunk => {\n    // If this chunk was already resolved or errored, it won't\n    // trigger an error but if it wasn't then we need to\n    // because we won't be getting any new data to resolve it.\n    triggerErrorOnChunk(chunk, error);\n  });\n}\n\nfunction readMaybeChunk<T>(maybeChunk: SomeChunk<T> | T): T {\n  if (maybeChunk == null || !(maybeChunk instanceof Chunk)) {\n    // $FlowFixMe\n    return maybeChunk;\n  }\n  const chunk: SomeChunk<T> = (maybeChunk: any);\n  return readChunk(chunk);\n}\n\nfunction createElement(type, key, props): React$Element<any> {\n  const element: any = {\n    // This tag allows us to uniquely identify this as a React Element\n    $$typeof: REACT_ELEMENT_TYPE,\n\n    // Built-in properties that belong on the element\n    type: type,\n    key: key,\n    ref: null,\n    props: props,\n\n    // Record the component responsible for creating this element.\n    _owner: null,\n  };\n  if (__DEV__) {\n    // We don't really need to add any of these but keeping them for good measure.\n    // Unfortunately, _store is enumerable in jest matchers so for equality to\n    // work, I need to keep it or make _store non-enumerable in the other file.\n    element._store = {};\n    Object.defineProperty(element._store, 'validated', {\n      configurable: false,\n      enumerable: false,\n      writable: true,\n      value: true, // This element has already been validated on the server.\n    });\n    Object.defineProperty(element, '_self', {\n      configurable: false,\n      enumerable: false,\n      writable: false,\n      value: null,\n    });\n    Object.defineProperty(element, '_source', {\n      configurable: false,\n      enumerable: false,\n      writable: false,\n      value: null,\n    });\n  }\n  return element;\n}\n\ntype UninitializedBlockPayload<Data> = [\n  mixed,\n  ModuleMetaData | SomeChunk<ModuleMetaData>,\n  Data | SomeChunk<Data>,\n  Response,\n];\n\nfunction initializeBlock<Props, Data>(\n  tuple: UninitializedBlockPayload<Data>,\n): BlockComponent<Props, Data> {\n  // Require module first and then data. The ordering matters.\n  const moduleMetaData: ModuleMetaData = readMaybeChunk(tuple[1]);\n  const moduleReference: ModuleReference<\n    BlockRenderFunction<Props, Data>,\n  > = resolveModuleReference(moduleMetaData);\n  // TODO: Do this earlier, as the chunk is resolved.\n  preloadModule(moduleReference);\n\n  const moduleExport = requireModule(moduleReference);\n\n  // The ordering here is important because this call might suspend.\n  // We don't want that to prevent the module graph for being initialized.\n  const data: Data = readMaybeChunk(tuple[2]);\n\n  return {\n    $$typeof: REACT_BLOCK_TYPE,\n    _status: -1,\n    _data: data,\n    _render: moduleExport,\n  };\n}\n\nfunction createLazyBlock<Props, Data>(\n  tuple: UninitializedBlockPayload<Data>,\n): LazyComponent<BlockComponent<Props, Data>, UninitializedBlockPayload<Data>> {\n  const lazyType: LazyComponent<\n    BlockComponent<Props, Data>,\n    UninitializedBlockPayload<Data>,\n  > = {\n    $$typeof: REACT_LAZY_TYPE,\n    _payload: tuple,\n    _init: initializeBlock,\n  };\n  return lazyType;\n}\n\nfunction getChunk(response: Response, id: number): SomeChunk<any> {\n  const chunks = response._chunks;\n  let chunk = chunks.get(id);\n  if (!chunk) {\n    chunk = createPendingChunk(response);\n    chunks.set(id, chunk);\n  }\n  return chunk;\n}\n\nexport function parseModelString(\n  response: Response,\n  parentObject: Object,\n  value: string,\n): any {\n  if (value[0] === '$') {\n    if (value === '$') {\n      return REACT_ELEMENT_TYPE;\n    } else if (value[1] === '$' || value[1] === '@') {\n      // This was an escaped string value.\n      return value.substring(1);\n    } else {\n      const id = parseInt(value.substring(1), 16);\n      const chunk = getChunk(response, id);\n      if (parentObject[0] === REACT_BLOCK_TYPE) {\n        // Block types know how to deal with lazy values.\n        return chunk;\n      }\n      // For anything else we must Suspend this block if\n      // we don't yet have the value.\n      return readChunk(chunk);\n    }\n  }\n  if (value === '@') {\n    return REACT_BLOCK_TYPE;\n  }\n  return value;\n}\n\nexport function parseModelTuple(\n  response: Response,\n  value: {+[key: string]: JSONValue} | $ReadOnlyArray<JSONValue>,\n): any {\n  const tuple: [mixed, mixed, mixed, mixed] = (value: any);\n  if (tuple[0] === REACT_ELEMENT_TYPE) {\n    // TODO: Consider having React just directly accept these arrays as elements.\n    // Or even change the ReactElement type to be an array.\n    return createElement(tuple[1], tuple[2], tuple[3]);\n  } else if (tuple[0] === REACT_BLOCK_TYPE) {\n    // TODO: Consider having React just directly accept these arrays as blocks.\n    return createLazyBlock((tuple: any));\n  }\n  return value;\n}\n\nexport function createResponse(): ResponseBase {\n  const chunks: Map<number, SomeChunk<any>> = new Map();\n  const response = {\n    _chunks: chunks,\n    readRoot: readRoot,\n  };\n  return response;\n}\n\nexport function resolveModel(\n  response: Response,\n  id: number,\n  model: UninitializedModel,\n): void {\n  const chunks = response._chunks;\n  const chunk = chunks.get(id);\n  if (!chunk) {\n    chunks.set(id, createResolvedModelChunk(response, model));\n  } else {\n    resolveModelChunk(chunk, model);\n  }\n}\n\nexport function resolveError(\n  response: Response,\n  id: number,\n  message: string,\n  stack: string,\n): void {\n  const error = new Error(message);\n  error.stack = stack;\n  const chunks = response._chunks;\n  const chunk = chunks.get(id);\n  if (!chunk) {\n    chunks.set(id, createErrorChunk(response, error));\n  } else {\n    triggerErrorOnChunk(chunk, error);\n  }\n}\n\nexport function close(response: Response): void {\n  // In case there are any remaining unresolved chunks, they won't\n  // be resolved now. So we need to issue an error to those.\n  // Ideally we should be able to early bail out if we kept a\n  // ref count of pending chunks.\n  reportGlobalError(response, new Error('Connection closed.'));\n}\n"],"names":["parseModelRecursively","response","parentObj","value","parseModelString","Array","isArray","i","length","parseModelTuple","innerKey","dummy","parseModel","json","REACT_ELEMENT_TYPE","REACT_PORTAL_TYPE","REACT_FRAGMENT_TYPE","REACT_STRICT_MODE_TYPE","REACT_PROFILER_TYPE","REACT_PROVIDER_TYPE","REACT_CONTEXT_TYPE","REACT_FORWARD_REF_TYPE","REACT_SUSPENSE_TYPE","REACT_SUSPENSE_LIST_TYPE","REACT_MEMO_TYPE","REACT_LAZY_TYPE","REACT_BLOCK_TYPE","REACT_SERVER_BLOCK_TYPE","REACT_FUNDAMENTAL_TYPE","REACT_SCOPE_TYPE","REACT_OPAQUE_ID_TYPE","REACT_DEBUG_TRACING_MODE_TYPE","REACT_OFFSCREEN_TYPE","REACT_LEGACY_HIDDEN_TYPE","Symbol","for","symbolFor","PENDING","RESOLVED_MODEL","INITIALIZED","ERRORED","Chunk","status","_status","_value","_response","prototype","then","resolve","chunk","push","readChunk","initializeModelChunk","readRoot","getChunk","createPendingChunk","createErrorChunk","error","wakeChunk","listeners","listener","triggerErrorOnChunk","erroredChunk","createResolvedModelChunk","resolveModelChunk","resolvedChunk","initializedChunk","reportGlobalError","_chunks","forEach","readMaybeChunk","maybeChunk","createElement","type","key","props","element","$$typeof","ref","_owner","_store","Object","defineProperty","configurable","enumerable","writable","initializeBlock","tuple","moduleMetaData","moduleReference","resolveModuleReference","preloadModule","moduleExport","requireModule","data","_data","_render","createLazyBlock","lazyType","_payload","_init","id","chunks","get","set","parentObject","substring","parseInt","createResponse","Map","resolveModel","model","resolveError","message","stack","Error","close"],"mappings":"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"}