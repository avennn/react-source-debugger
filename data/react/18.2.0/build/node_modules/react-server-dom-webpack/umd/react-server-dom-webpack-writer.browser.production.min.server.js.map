{"version":3,"file":"react-server-dom-webpack-writer.browser.production.min.server.js","sources":["../../../../packages/react-server/src/ReactServerStreamConfigBrowser.js","../../../../packages/react-server/src/ReactFlightServerConfigStream.js","../../../../packages/react-server-dom-webpack/src/ReactFlightServerWebpackBundlerConfig.js","../../../../packages/shared/ReactSymbols.js","../../../../packages/react-dom/src/shared/DOMProperty.js","../../../../packages/react-dom/src/shared/CSSProperty.js","../../../../packages/shared/isArray.js","../../../../packages/react-dom/src/server/ReactDOMServerFormatConfig.js","../../../../packages/react-server/src/ReactFlightNewContext.js","../../../../packages/react-server/src/ReactFlightHooks.js","../../../../packages/shared/ReactSharedInternals.js","../../../../packages/shared/ReactServerContextRegistry.js","../../../../packages/react-server/src/ReactFlightServer.js","../../../../packages/react-server-dom-webpack/src/ReactFlightDOMServerBrowser.js"],"sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nexport type Destination = ReadableStreamController;\n\nexport type PrecomputedChunk = Uint8Array;\nexport type Chunk = Uint8Array;\n\nexport function scheduleWork(callback: () => void) {\n  callback();\n}\n\nexport function flushBuffered(destination: Destination) {\n  // WHATWG Streams do not yet have a way to flush the underlying\n  // transform streams. https://github.com/whatwg/streams/issues/960\n}\n\nconst VIEW_SIZE = 512;\nlet currentView = null;\nlet writtenBytes = 0;\n\nexport function beginWriting(destination: Destination) {\n  currentView = new Uint8Array(VIEW_SIZE);\n  writtenBytes = 0;\n}\n\nexport function writeChunk(\n  destination: Destination,\n  chunk: PrecomputedChunk | Chunk,\n): void {\n  if (chunk.length === 0) {\n    return;\n  }\n\n  if (chunk.length > VIEW_SIZE) {\n    // this chunk may overflow a single view which implies it was not\n    // one that is cached by the streaming renderer. We will enqueu\n    // it directly and expect it is not re-used\n    if (writtenBytes > 0) {\n      destination.enqueue(\n        new Uint8Array(\n          ((currentView: any): Uint8Array).buffer,\n          0,\n          writtenBytes,\n        ),\n      );\n      currentView = new Uint8Array(VIEW_SIZE);\n      writtenBytes = 0;\n    }\n    destination.enqueue(chunk);\n    return;\n  }\n\n  let bytesToWrite = chunk;\n  const allowableBytes = ((currentView: any): Uint8Array).length - writtenBytes;\n  if (allowableBytes < bytesToWrite.length) {\n    // this chunk would overflow the current view. We enqueue a full view\n    // and start a new view with the remaining chunk\n    if (allowableBytes === 0) {\n      // the current view is already full, send it\n      destination.enqueue(currentView);\n    } else {\n      // fill up the current view and apply the remaining chunk bytes\n      // to a new view.\n      ((currentView: any): Uint8Array).set(\n        bytesToWrite.subarray(0, allowableBytes),\n        writtenBytes,\n      );\n      // writtenBytes += allowableBytes; // this can be skipped because we are going to immediately reset the view\n      destination.enqueue(currentView);\n      bytesToWrite = bytesToWrite.subarray(allowableBytes);\n    }\n    currentView = new Uint8Array(VIEW_SIZE);\n    writtenBytes = 0;\n  }\n  ((currentView: any): Uint8Array).set(bytesToWrite, writtenBytes);\n  writtenBytes += bytesToWrite.length;\n}\n\nexport function writeChunkAndReturn(\n  destination: Destination,\n  chunk: PrecomputedChunk | Chunk,\n): boolean {\n  writeChunk(destination, chunk);\n  // in web streams there is no backpressure so we can alwas write more\n  return true;\n}\n\nexport function completeWriting(destination: Destination) {\n  if (currentView && writtenBytes > 0) {\n    destination.enqueue(new Uint8Array(currentView.buffer, 0, writtenBytes));\n    currentView = null;\n    writtenBytes = 0;\n  }\n}\n\nexport function close(destination: Destination) {\n  destination.close();\n}\n\nconst textEncoder = new TextEncoder();\n\nexport function stringToChunk(content: string): Chunk {\n  return textEncoder.encode(content);\n}\n\nexport function stringToPrecomputedChunk(content: string): PrecomputedChunk {\n  return textEncoder.encode(content);\n}\n\nexport function closeWithError(destination: Destination, error: mixed): void {\n  if (typeof destination.error === 'function') {\n    // $FlowFixMe: This is an Error object or the destination accepts other types.\n    destination.error(error);\n  } else {\n    // Earlier implementations doesn't support this method. In that environment you're\n    // supposed to throw from a promise returned but we don't return a promise in our\n    // approach. We could fork this implementation but this is environment is an edge\n    // case to begin with. It's even less common to run this in an older environment.\n    // Even then, this is not where errors are supposed to happen and they get reported\n    // to a global callback in addition to this anyway. So it's fine just to close this.\n    destination.close();\n  }\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n// This file is an intermediate layer to translate between Flight\n// calls to stream output over a binary stream.\n\n/*\nFLIGHT PROTOCOL GRAMMAR\n\nResponse\n- RowSequence\n\nRowSequence\n- Row RowSequence\n- Row\n\nRow\n- \"J\" RowID JSONData\n- \"M\" RowID JSONModuleData\n- \"H\" RowID HTMLData\n- \"B\" RowID BlobData\n- \"U\" RowID URLData\n- \"E\" RowID ErrorData\n\nRowID\n- HexDigits \":\"\n\nHexDigits\n- HexDigit HexDigits\n- HexDigit\n\nHexDigit\n- 0-F\n\nURLData\n- (UTF8 encoded URL) \"\\n\"\n\nErrorData\n- (UTF8 encoded JSON: {message: \"...\", stack: \"...\"}) \"\\n\"\n\nJSONData\n- (UTF8 encoded JSON) \"\\n\"\n  - String values that begin with $ are escaped with a \"$\" prefix.\n  - References to other rows are encoding as JSONReference strings.\n\nJSONReference\n- \"$\" HexDigits\n\nHTMLData\n- ByteSize (UTF8 encoded HTML)\n\nBlobData\n- ByteSize (Binary Data)\n\nByteSize\n- (unsigned 32-bit integer)\n*/\n\n// TODO: Implement HTMLData, BlobData and URLData.\n\nimport type {Request, ReactModel} from 'react-server/src/ReactFlightServer';\n\nimport {stringToChunk} from './ReactServerStreamConfig';\n\nimport type {Chunk} from './ReactServerStreamConfig';\n\nexport type {Destination, Chunk} from './ReactServerStreamConfig';\n\nconst stringify = JSON.stringify;\n\nfunction serializeRowHeader(tag: string, id: number) {\n  return tag + id.toString(16) + ':';\n}\n\nexport function processErrorChunk(\n  request: Request,\n  id: number,\n  message: string,\n  stack: string,\n): Chunk {\n  const errorInfo = {message, stack};\n  const row = serializeRowHeader('E', id) + stringify(errorInfo) + '\\n';\n  return stringToChunk(row);\n}\n\nexport function processModelChunk(\n  request: Request,\n  id: number,\n  model: ReactModel,\n): Chunk {\n  const json = stringify(model, request.toJSON);\n  const row = serializeRowHeader('J', id) + json + '\\n';\n  return stringToChunk(row);\n}\n\nexport function processModuleChunk(\n  request: Request,\n  id: number,\n  moduleMetaData: ReactModel,\n): Chunk {\n  const json = stringify(moduleMetaData);\n  const row = serializeRowHeader('M', id) + json + '\\n';\n  return stringToChunk(row);\n}\n\nexport function processProviderChunk(\n  request: Request,\n  id: number,\n  contextName: string,\n): Chunk {\n  const row = serializeRowHeader('P', id) + contextName + '\\n';\n  return stringToChunk(row);\n}\n\nexport function processSymbolChunk(\n  request: Request,\n  id: number,\n  name: string,\n): Chunk {\n  const json = stringify(name);\n  const row = serializeRowHeader('S', id) + json + '\\n';\n  return stringToChunk(row);\n}\n\nexport {\n  scheduleWork,\n  flushBuffered,\n  beginWriting,\n  writeChunk,\n  writeChunkAndReturn,\n  completeWriting,\n  close,\n  closeWithError,\n} from './ReactServerStreamConfig';\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\ntype WebpackMap = {\n  [filepath: string]: {\n    [name: string]: ModuleMetaData,\n  },\n};\n\nexport type BundlerConfig = WebpackMap;\n\n// eslint-disable-next-line no-unused-vars\nexport type ModuleReference<T> = {\n  $$typeof: Symbol,\n  filepath: string,\n  name: string,\n};\n\nexport type ModuleMetaData = {\n  id: string,\n  chunks: Array<string>,\n  name: string,\n};\n\nexport type ModuleKey = string;\n\nconst MODULE_TAG = Symbol.for('react.module.reference');\n\nexport function getModuleKey(reference: ModuleReference<any>): ModuleKey {\n  return reference.filepath + '#' + reference.name;\n}\n\nexport function isModuleReference(reference: Object): boolean {\n  return reference.$$typeof === MODULE_TAG;\n}\n\nexport function resolveModuleMetaData<T>(\n  config: BundlerConfig,\n  moduleReference: ModuleReference<T>,\n): ModuleMetaData {\n  return config[moduleReference.filepath][moduleReference.name];\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n// ATTENTION\n// When adding new symbols to this file,\n// Please consider also adding to 'react-devtools-shared/src/backend/ReactSymbols'\n\n// The Symbol used to tag the ReactElement-like types.\nexport const REACT_ELEMENT_TYPE = Symbol.for('react.element');\nexport const REACT_PORTAL_TYPE = Symbol.for('react.portal');\nexport const REACT_FRAGMENT_TYPE = Symbol.for('react.fragment');\nexport const REACT_STRICT_MODE_TYPE = Symbol.for('react.strict_mode');\nexport const REACT_PROFILER_TYPE = Symbol.for('react.profiler');\nexport const REACT_PROVIDER_TYPE = Symbol.for('react.provider');\nexport const REACT_CONTEXT_TYPE = Symbol.for('react.context');\nexport const REACT_SERVER_CONTEXT_TYPE = Symbol.for('react.server_context');\nexport const REACT_FORWARD_REF_TYPE = Symbol.for('react.forward_ref');\nexport const REACT_SUSPENSE_TYPE = Symbol.for('react.suspense');\nexport const REACT_SUSPENSE_LIST_TYPE = Symbol.for('react.suspense_list');\nexport const REACT_MEMO_TYPE = Symbol.for('react.memo');\nexport const REACT_LAZY_TYPE = Symbol.for('react.lazy');\nexport const REACT_SCOPE_TYPE = Symbol.for('react.scope');\nexport const REACT_DEBUG_TRACING_MODE_TYPE = Symbol.for(\n  'react.debug_trace_mode',\n);\nexport const REACT_OFFSCREEN_TYPE = Symbol.for('react.offscreen');\nexport const REACT_LEGACY_HIDDEN_TYPE = Symbol.for('react.legacy_hidden');\nexport const REACT_CACHE_TYPE = Symbol.for('react.cache');\nexport const REACT_TRACING_MARKER_TYPE = Symbol.for('react.tracing_marker');\nexport const REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED = Symbol.for(\n  'react.default_value',\n);\n\nconst MAYBE_ITERATOR_SYMBOL = Symbol.iterator;\nconst FAUX_ITERATOR_SYMBOL = '@@iterator';\n\nexport function getIteratorFn(maybeIterable: ?any): ?() => ?Iterator<*> {\n  if (maybeIterable === null || typeof maybeIterable !== 'object') {\n    return null;\n  }\n  const maybeIterator =\n    (MAYBE_ITERATOR_SYMBOL && maybeIterable[MAYBE_ITERATOR_SYMBOL]) ||\n    maybeIterable[FAUX_ITERATOR_SYMBOL];\n  if (typeof maybeIterator === 'function') {\n    return maybeIterator;\n  }\n  return null;\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport {\n  enableFilterEmptyStringAttributesDOM,\n  enableCustomElementPropertySupport,\n} from 'shared/ReactFeatureFlags';\nimport hasOwnProperty from 'shared/hasOwnProperty';\n\ntype PropertyType = 0 | 1 | 2 | 3 | 4 | 5 | 6;\n\n// A reserved attribute.\n// It is handled by React separately and shouldn't be written to the DOM.\nexport const RESERVED = 0;\n\n// A simple string attribute.\n// Attributes that aren't in the filter are presumed to have this type.\nexport const STRING = 1;\n\n// A string attribute that accepts booleans in React. In HTML, these are called\n// \"enumerated\" attributes with \"true\" and \"false\" as possible values.\n// When true, it should be set to a \"true\" string.\n// When false, it should be set to a \"false\" string.\nexport const BOOLEANISH_STRING = 2;\n\n// A real boolean attribute.\n// When true, it should be present (set either to an empty string or its name).\n// When false, it should be omitted.\nexport const BOOLEAN = 3;\n\n// An attribute that can be used as a flag as well as with a value.\n// When true, it should be present (set either to an empty string or its name).\n// When false, it should be omitted.\n// For any other value, should be present with that value.\nexport const OVERLOADED_BOOLEAN = 4;\n\n// An attribute that must be numeric or parse as a numeric.\n// When falsy, it should be removed.\nexport const NUMERIC = 5;\n\n// An attribute that must be positive numeric or parse as a positive numeric.\n// When falsy, it should be removed.\nexport const POSITIVE_NUMERIC = 6;\n\nexport type PropertyInfo = {|\n  +acceptsBooleans: boolean,\n  +attributeName: string,\n  +attributeNamespace: string | null,\n  +mustUseProperty: boolean,\n  +propertyName: string,\n  +type: PropertyType,\n  +sanitizeURL: boolean,\n  +removeEmptyString: boolean,\n|};\n\n/* eslint-disable max-len */\nexport const ATTRIBUTE_NAME_START_CHAR =\n  ':A-Z_a-z\\\\u00C0-\\\\u00D6\\\\u00D8-\\\\u00F6\\\\u00F8-\\\\u02FF\\\\u0370-\\\\u037D\\\\u037F-\\\\u1FFF\\\\u200C-\\\\u200D\\\\u2070-\\\\u218F\\\\u2C00-\\\\u2FEF\\\\u3001-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFFD';\n/* eslint-enable max-len */\nexport const ATTRIBUTE_NAME_CHAR =\n  ATTRIBUTE_NAME_START_CHAR + '\\\\-.0-9\\\\u00B7\\\\u0300-\\\\u036F\\\\u203F-\\\\u2040';\n\nexport const VALID_ATTRIBUTE_NAME_REGEX = new RegExp(\n  '^[' + ATTRIBUTE_NAME_START_CHAR + '][' + ATTRIBUTE_NAME_CHAR + ']*$',\n);\n\nconst illegalAttributeNameCache = {};\nconst validatedAttributeNameCache = {};\n\nexport function isAttributeNameSafe(attributeName: string): boolean {\n  if (hasOwnProperty.call(validatedAttributeNameCache, attributeName)) {\n    return true;\n  }\n  if (hasOwnProperty.call(illegalAttributeNameCache, attributeName)) {\n    return false;\n  }\n  if (VALID_ATTRIBUTE_NAME_REGEX.test(attributeName)) {\n    validatedAttributeNameCache[attributeName] = true;\n    return true;\n  }\n  illegalAttributeNameCache[attributeName] = true;\n  if (__DEV__) {\n    console.error('Invalid attribute name: `%s`', attributeName);\n  }\n  return false;\n}\n\nexport function shouldIgnoreAttribute(\n  name: string,\n  propertyInfo: PropertyInfo | null,\n  isCustomComponentTag: boolean,\n): boolean {\n  if (propertyInfo !== null) {\n    return propertyInfo.type === RESERVED;\n  }\n  if (isCustomComponentTag) {\n    return false;\n  }\n  if (\n    name.length > 2 &&\n    (name[0] === 'o' || name[0] === 'O') &&\n    (name[1] === 'n' || name[1] === 'N')\n  ) {\n    return true;\n  }\n  return false;\n}\n\nexport function shouldRemoveAttributeWithWarning(\n  name: string,\n  value: mixed,\n  propertyInfo: PropertyInfo | null,\n  isCustomComponentTag: boolean,\n): boolean {\n  if (propertyInfo !== null && propertyInfo.type === RESERVED) {\n    return false;\n  }\n  switch (typeof value) {\n    case 'function':\n    // $FlowIssue symbol is perfectly valid here\n    case 'symbol': // eslint-disable-line\n      return true;\n    case 'boolean': {\n      if (isCustomComponentTag) {\n        return false;\n      }\n      if (propertyInfo !== null) {\n        return !propertyInfo.acceptsBooleans;\n      } else {\n        const prefix = name.toLowerCase().slice(0, 5);\n        return prefix !== 'data-' && prefix !== 'aria-';\n      }\n    }\n    default:\n      return false;\n  }\n}\n\nexport function shouldRemoveAttribute(\n  name: string,\n  value: mixed,\n  propertyInfo: PropertyInfo | null,\n  isCustomComponentTag: boolean,\n): boolean {\n  if (value === null || typeof value === 'undefined') {\n    return true;\n  }\n  if (\n    shouldRemoveAttributeWithWarning(\n      name,\n      value,\n      propertyInfo,\n      isCustomComponentTag,\n    )\n  ) {\n    return true;\n  }\n  if (isCustomComponentTag) {\n    if (enableCustomElementPropertySupport) {\n      if (value === false) {\n        return true;\n      }\n    }\n    return false;\n  }\n  if (propertyInfo !== null) {\n    if (enableFilterEmptyStringAttributesDOM) {\n      if (propertyInfo.removeEmptyString && value === '') {\n        if (__DEV__) {\n          if (name === 'src') {\n            console.error(\n              'An empty string (\"\") was passed to the %s attribute. ' +\n                'This may cause the browser to download the whole page again over the network. ' +\n                'To fix this, either do not render the element at all ' +\n                'or pass null to %s instead of an empty string.',\n              name,\n              name,\n            );\n          } else {\n            console.error(\n              'An empty string (\"\") was passed to the %s attribute. ' +\n                'To fix this, either do not render the element at all ' +\n                'or pass null to %s instead of an empty string.',\n              name,\n              name,\n            );\n          }\n        }\n        return true;\n      }\n    }\n\n    switch (propertyInfo.type) {\n      case BOOLEAN:\n        return !value;\n      case OVERLOADED_BOOLEAN:\n        return value === false;\n      case NUMERIC:\n        return isNaN(value);\n      case POSITIVE_NUMERIC:\n        return isNaN(value) || (value: any) < 1;\n    }\n  }\n  return false;\n}\n\nexport function getPropertyInfo(name: string): PropertyInfo | null {\n  return properties.hasOwnProperty(name) ? properties[name] : null;\n}\n\nfunction PropertyInfoRecord(\n  name: string,\n  type: PropertyType,\n  mustUseProperty: boolean,\n  attributeName: string,\n  attributeNamespace: string | null,\n  sanitizeURL: boolean,\n  removeEmptyString: boolean,\n) {\n  this.acceptsBooleans =\n    type === BOOLEANISH_STRING ||\n    type === BOOLEAN ||\n    type === OVERLOADED_BOOLEAN;\n  this.attributeName = attributeName;\n  this.attributeNamespace = attributeNamespace;\n  this.mustUseProperty = mustUseProperty;\n  this.propertyName = name;\n  this.type = type;\n  this.sanitizeURL = sanitizeURL;\n  this.removeEmptyString = removeEmptyString;\n}\n\n// When adding attributes to this list, be sure to also add them to\n// the `possibleStandardNames` module to ensure casing and incorrect\n// name warnings.\nconst properties = {};\n\n// These props are reserved by React. They shouldn't be written to the DOM.\nconst reservedProps = [\n  'children',\n  'dangerouslySetInnerHTML',\n  // TODO: This prevents the assignment of defaultValue to regular\n  // elements (not just inputs). Now that ReactDOMInput assigns to the\n  // defaultValue property -- do we need this?\n  'defaultValue',\n  'defaultChecked',\n  'innerHTML',\n  'suppressContentEditableWarning',\n  'suppressHydrationWarning',\n  'style',\n];\nif (enableCustomElementPropertySupport) {\n  reservedProps.push('innerText', 'textContent');\n}\n\nreservedProps.forEach(name => {\n  properties[name] = new PropertyInfoRecord(\n    name,\n    RESERVED,\n    false, // mustUseProperty\n    name, // attributeName\n    null, // attributeNamespace\n    false, // sanitizeURL\n    false, // removeEmptyString\n  );\n});\n\n// A few React string attributes have a different name.\n// This is a mapping from React prop names to the attribute names.\n[\n  ['acceptCharset', 'accept-charset'],\n  ['className', 'class'],\n  ['htmlFor', 'for'],\n  ['httpEquiv', 'http-equiv'],\n].forEach(([name, attributeName]) => {\n  properties[name] = new PropertyInfoRecord(\n    name,\n    STRING,\n    false, // mustUseProperty\n    attributeName, // attributeName\n    null, // attributeNamespace\n    false, // sanitizeURL\n    false, // removeEmptyString\n  );\n});\n\n// These are \"enumerated\" HTML attributes that accept \"true\" and \"false\".\n// In React, we let users pass `true` and `false` even though technically\n// these aren't boolean attributes (they are coerced to strings).\n['contentEditable', 'draggable', 'spellCheck', 'value'].forEach(name => {\n  properties[name] = new PropertyInfoRecord(\n    name,\n    BOOLEANISH_STRING,\n    false, // mustUseProperty\n    name.toLowerCase(), // attributeName\n    null, // attributeNamespace\n    false, // sanitizeURL\n    false, // removeEmptyString\n  );\n});\n\n// These are \"enumerated\" SVG attributes that accept \"true\" and \"false\".\n// In React, we let users pass `true` and `false` even though technically\n// these aren't boolean attributes (they are coerced to strings).\n// Since these are SVG attributes, their attribute names are case-sensitive.\n[\n  'autoReverse',\n  'externalResourcesRequired',\n  'focusable',\n  'preserveAlpha',\n].forEach(name => {\n  properties[name] = new PropertyInfoRecord(\n    name,\n    BOOLEANISH_STRING,\n    false, // mustUseProperty\n    name, // attributeName\n    null, // attributeNamespace\n    false, // sanitizeURL\n    false, // removeEmptyString\n  );\n});\n\n// These are HTML boolean attributes.\n[\n  'allowFullScreen',\n  'async',\n  // Note: there is a special case that prevents it from being written to the DOM\n  // on the client side because the browsers are inconsistent. Instead we call focus().\n  'autoFocus',\n  'autoPlay',\n  'controls',\n  'default',\n  'defer',\n  'disabled',\n  'disablePictureInPicture',\n  'disableRemotePlayback',\n  'formNoValidate',\n  'hidden',\n  'loop',\n  'noModule',\n  'noValidate',\n  'open',\n  'playsInline',\n  'readOnly',\n  'required',\n  'reversed',\n  'scoped',\n  'seamless',\n  // Microdata\n  'itemScope',\n].forEach(name => {\n  properties[name] = new PropertyInfoRecord(\n    name,\n    BOOLEAN,\n    false, // mustUseProperty\n    name.toLowerCase(), // attributeName\n    null, // attributeNamespace\n    false, // sanitizeURL\n    false, // removeEmptyString\n  );\n});\n\n// These are the few React props that we set as DOM properties\n// rather than attributes. These are all booleans.\n[\n  'checked',\n  // Note: `option.selected` is not updated if `select.multiple` is\n  // disabled with `removeAttribute`. We have special logic for handling this.\n  'multiple',\n  'muted',\n  'selected',\n\n  // NOTE: if you add a camelCased prop to this list,\n  // you'll need to set attributeName to name.toLowerCase()\n  // instead in the assignment below.\n].forEach(name => {\n  properties[name] = new PropertyInfoRecord(\n    name,\n    BOOLEAN,\n    true, // mustUseProperty\n    name, // attributeName\n    null, // attributeNamespace\n    false, // sanitizeURL\n    false, // removeEmptyString\n  );\n});\n\n// These are HTML attributes that are \"overloaded booleans\": they behave like\n// booleans, but can also accept a string value.\n[\n  'capture',\n  'download',\n\n  // NOTE: if you add a camelCased prop to this list,\n  // you'll need to set attributeName to name.toLowerCase()\n  // instead in the assignment below.\n].forEach(name => {\n  properties[name] = new PropertyInfoRecord(\n    name,\n    OVERLOADED_BOOLEAN,\n    false, // mustUseProperty\n    name, // attributeName\n    null, // attributeNamespace\n    false, // sanitizeURL\n    false, // removeEmptyString\n  );\n});\n\n// These are HTML attributes that must be positive numbers.\n[\n  'cols',\n  'rows',\n  'size',\n  'span',\n\n  // NOTE: if you add a camelCased prop to this list,\n  // you'll need to set attributeName to name.toLowerCase()\n  // instead in the assignment below.\n].forEach(name => {\n  properties[name] = new PropertyInfoRecord(\n    name,\n    POSITIVE_NUMERIC,\n    false, // mustUseProperty\n    name, // attributeName\n    null, // attributeNamespace\n    false, // sanitizeURL\n    false, // removeEmptyString\n  );\n});\n\n// These are HTML attributes that must be numbers.\n['rowSpan', 'start'].forEach(name => {\n  properties[name] = new PropertyInfoRecord(\n    name,\n    NUMERIC,\n    false, // mustUseProperty\n    name.toLowerCase(), // attributeName\n    null, // attributeNamespace\n    false, // sanitizeURL\n    false, // removeEmptyString\n  );\n});\n\nconst CAMELIZE = /[\\-\\:]([a-z])/g;\nconst capitalize = token => token[1].toUpperCase();\n\n// This is a list of all SVG attributes that need special casing, namespacing,\n// or boolean value assignment. Regular attributes that just accept strings\n// and have the same names are omitted, just like in the HTML attribute filter.\n// Some of these attributes can be hard to find. This list was created by\n// scraping the MDN documentation.\n[\n  'accent-height',\n  'alignment-baseline',\n  'arabic-form',\n  'baseline-shift',\n  'cap-height',\n  'clip-path',\n  'clip-rule',\n  'color-interpolation',\n  'color-interpolation-filters',\n  'color-profile',\n  'color-rendering',\n  'dominant-baseline',\n  'enable-background',\n  'fill-opacity',\n  'fill-rule',\n  'flood-color',\n  'flood-opacity',\n  'font-family',\n  'font-size',\n  'font-size-adjust',\n  'font-stretch',\n  'font-style',\n  'font-variant',\n  'font-weight',\n  'glyph-name',\n  'glyph-orientation-horizontal',\n  'glyph-orientation-vertical',\n  'horiz-adv-x',\n  'horiz-origin-x',\n  'image-rendering',\n  'letter-spacing',\n  'lighting-color',\n  'marker-end',\n  'marker-mid',\n  'marker-start',\n  'overline-position',\n  'overline-thickness',\n  'paint-order',\n  'panose-1',\n  'pointer-events',\n  'rendering-intent',\n  'shape-rendering',\n  'stop-color',\n  'stop-opacity',\n  'strikethrough-position',\n  'strikethrough-thickness',\n  'stroke-dasharray',\n  'stroke-dashoffset',\n  'stroke-linecap',\n  'stroke-linejoin',\n  'stroke-miterlimit',\n  'stroke-opacity',\n  'stroke-width',\n  'text-anchor',\n  'text-decoration',\n  'text-rendering',\n  'underline-position',\n  'underline-thickness',\n  'unicode-bidi',\n  'unicode-range',\n  'units-per-em',\n  'v-alphabetic',\n  'v-hanging',\n  'v-ideographic',\n  'v-mathematical',\n  'vector-effect',\n  'vert-adv-y',\n  'vert-origin-x',\n  'vert-origin-y',\n  'word-spacing',\n  'writing-mode',\n  'xmlns:xlink',\n  'x-height',\n\n  // NOTE: if you add a camelCased prop to this list,\n  // you'll need to set attributeName to name.toLowerCase()\n  // instead in the assignment below.\n].forEach(attributeName => {\n  const name = attributeName.replace(CAMELIZE, capitalize);\n  properties[name] = new PropertyInfoRecord(\n    name,\n    STRING,\n    false, // mustUseProperty\n    attributeName,\n    null, // attributeNamespace\n    false, // sanitizeURL\n    false, // removeEmptyString\n  );\n});\n\n// String SVG attributes with the xlink namespace.\n[\n  'xlink:actuate',\n  'xlink:arcrole',\n  'xlink:role',\n  'xlink:show',\n  'xlink:title',\n  'xlink:type',\n\n  // NOTE: if you add a camelCased prop to this list,\n  // you'll need to set attributeName to name.toLowerCase()\n  // instead in the assignment below.\n].forEach(attributeName => {\n  const name = attributeName.replace(CAMELIZE, capitalize);\n  properties[name] = new PropertyInfoRecord(\n    name,\n    STRING,\n    false, // mustUseProperty\n    attributeName,\n    'http://www.w3.org/1999/xlink',\n    false, // sanitizeURL\n    false, // removeEmptyString\n  );\n});\n\n// String SVG attributes with the xml namespace.\n[\n  'xml:base',\n  'xml:lang',\n  'xml:space',\n\n  // NOTE: if you add a camelCased prop to this list,\n  // you'll need to set attributeName to name.toLowerCase()\n  // instead in the assignment below.\n].forEach(attributeName => {\n  const name = attributeName.replace(CAMELIZE, capitalize);\n  properties[name] = new PropertyInfoRecord(\n    name,\n    STRING,\n    false, // mustUseProperty\n    attributeName,\n    'http://www.w3.org/XML/1998/namespace',\n    false, // sanitizeURL\n    false, // removeEmptyString\n  );\n});\n\n// These attribute exists both in HTML and SVG.\n// The attribute name is case-sensitive in SVG so we can't just use\n// the React name like we do for attributes that exist only in HTML.\n['tabIndex', 'crossOrigin'].forEach(attributeName => {\n  properties[attributeName] = new PropertyInfoRecord(\n    attributeName,\n    STRING,\n    false, // mustUseProperty\n    attributeName.toLowerCase(), // attributeName\n    null, // attributeNamespace\n    false, // sanitizeURL\n    false, // removeEmptyString\n  );\n});\n\n// These attributes accept URLs. These must not allow javascript: URLS.\n// These will also need to accept Trusted Types object in the future.\nconst xlinkHref = 'xlinkHref';\nproperties[xlinkHref] = new PropertyInfoRecord(\n  'xlinkHref',\n  STRING,\n  false, // mustUseProperty\n  'xlink:href',\n  'http://www.w3.org/1999/xlink',\n  true, // sanitizeURL\n  false, // removeEmptyString\n);\n\n['src', 'href', 'action', 'formAction'].forEach(attributeName => {\n  properties[attributeName] = new PropertyInfoRecord(\n    attributeName,\n    STRING,\n    false, // mustUseProperty\n    attributeName.toLowerCase(), // attributeName\n    null, // attributeNamespace\n    true, // sanitizeURL\n    true, // removeEmptyString\n  );\n});\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n/**\n * CSS properties which accept numbers but are not in units of \"px\".\n */\nexport const isUnitlessNumber = {\n  animationIterationCount: true,\n  aspectRatio: true,\n  borderImageOutset: true,\n  borderImageSlice: true,\n  borderImageWidth: true,\n  boxFlex: true,\n  boxFlexGroup: true,\n  boxOrdinalGroup: true,\n  columnCount: true,\n  columns: true,\n  flex: true,\n  flexGrow: true,\n  flexPositive: true,\n  flexShrink: true,\n  flexNegative: true,\n  flexOrder: true,\n  gridArea: true,\n  gridRow: true,\n  gridRowEnd: true,\n  gridRowSpan: true,\n  gridRowStart: true,\n  gridColumn: true,\n  gridColumnEnd: true,\n  gridColumnSpan: true,\n  gridColumnStart: true,\n  fontWeight: true,\n  lineClamp: true,\n  lineHeight: true,\n  opacity: true,\n  order: true,\n  orphans: true,\n  tabSize: true,\n  widows: true,\n  zIndex: true,\n  zoom: true,\n\n  // SVG-related properties\n  fillOpacity: true,\n  floodOpacity: true,\n  stopOpacity: true,\n  strokeDasharray: true,\n  strokeDashoffset: true,\n  strokeMiterlimit: true,\n  strokeOpacity: true,\n  strokeWidth: true,\n};\n\n/**\n * @param {string} prefix vendor-specific prefix, eg: Webkit\n * @param {string} key style name, eg: transitionDuration\n * @return {string} style name prefixed with `prefix`, properly camelCased, eg:\n * WebkitTransitionDuration\n */\nfunction prefixKey(prefix, key) {\n  return prefix + key.charAt(0).toUpperCase() + key.substring(1);\n}\n\n/**\n * Support style names that may come passed in prefixed by adding permutations\n * of vendor prefixes.\n */\nconst prefixes = ['Webkit', 'ms', 'Moz', 'O'];\n\n// Using Object.keys here, or else the vanilla for-in loop makes IE8 go into an\n// infinite loop, because it iterates over the newly added props too.\nObject.keys(isUnitlessNumber).forEach(function(prop) {\n  prefixes.forEach(function(prefix) {\n    isUnitlessNumber[prefixKey(prefix, prop)] = isUnitlessNumber[prop];\n  });\n});\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\ndeclare function isArray(a: mixed): boolean %checks(Array.isArray(a));\n\nconst isArrayImpl = Array.isArray;\n\n// eslint-disable-next-line no-redeclare\nfunction isArray(a: mixed): boolean {\n  return isArrayImpl(a);\n}\n\nexport default isArray;\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {ReactNodeList} from 'shared/ReactTypes';\n\nimport {\n  checkHtmlStringCoercion,\n  checkCSSPropertyStringCoercion,\n  checkAttributeStringCoercion,\n} from 'shared/CheckStringCoercion';\n\nimport {Children} from 'react';\n\nimport {\n  enableFilterEmptyStringAttributesDOM,\n  enableCustomElementPropertySupport,\n} from 'shared/ReactFeatureFlags';\n\nimport type {\n  Destination,\n  Chunk,\n  PrecomputedChunk,\n} from 'react-server/src/ReactServerStreamConfig';\n\nimport {\n  writeChunk,\n  writeChunkAndReturn,\n  stringToChunk,\n  stringToPrecomputedChunk,\n} from 'react-server/src/ReactServerStreamConfig';\n\nimport {\n  getPropertyInfo,\n  isAttributeNameSafe,\n  BOOLEAN,\n  OVERLOADED_BOOLEAN,\n  NUMERIC,\n  POSITIVE_NUMERIC,\n} from '../shared/DOMProperty';\nimport {isUnitlessNumber} from '../shared/CSSProperty';\n\nimport {checkControlledValueProps} from '../shared/ReactControlledValuePropTypes';\nimport {validateProperties as validateARIAProperties} from '../shared/ReactDOMInvalidARIAHook';\nimport {validateProperties as validateInputProperties} from '../shared/ReactDOMNullInputValuePropHook';\nimport {validateProperties as validateUnknownProperties} from '../shared/ReactDOMUnknownPropertyHook';\nimport warnValidStyle from '../shared/warnValidStyle';\n\nimport escapeTextForBrowser from './escapeTextForBrowser';\nimport hyphenateStyleName from '../shared/hyphenateStyleName';\nimport hasOwnProperty from 'shared/hasOwnProperty';\nimport sanitizeURL from '../shared/sanitizeURL';\nimport isArray from 'shared/isArray';\n\n// Used to distinguish these contexts from ones used in other renderers.\n// E.g. this can be used to distinguish legacy renderers from this modern one.\nexport const isPrimaryRenderer = true;\n\n// Per response, global state that is not contextual to the rendering subtree.\nexport type ResponseState = {\n  bootstrapChunks: Array<Chunk | PrecomputedChunk>,\n  startInlineScript: PrecomputedChunk,\n  placeholderPrefix: PrecomputedChunk,\n  segmentPrefix: PrecomputedChunk,\n  boundaryPrefix: string,\n  idPrefix: string,\n  nextSuspenseID: number,\n  sentCompleteSegmentFunction: boolean,\n  sentCompleteBoundaryFunction: boolean,\n  sentClientRenderFunction: boolean, // We allow the legacy renderer to extend this object.\n  ...\n};\n\nconst startInlineScript = stringToPrecomputedChunk('<script>');\nconst endInlineScript = stringToPrecomputedChunk('</script>');\n\nconst startScriptSrc = stringToPrecomputedChunk('<script src=\"');\nconst startModuleSrc = stringToPrecomputedChunk('<script type=\"module\" src=\"');\nconst endAsyncScript = stringToPrecomputedChunk('\" async=\"\"></script>');\n\n/**\n * This escaping function is designed to work with bootstrapScriptContent only.\n * because we know we are escaping the entire script. We can avoid for instance\n * escaping html comment string sequences that are valid javascript as well because\n * if there are no sebsequent <script sequences the html parser will never enter\n * script data double escaped state (see: https://www.w3.org/TR/html53/syntax.html#script-data-double-escaped-state)\n *\n * While untrusted script content should be made safe before using this api it will\n * ensure that the script cannot be early terminated or never terminated state\n */\nfunction escapeBootstrapScriptContent(scriptText) {\n  if (__DEV__) {\n    checkHtmlStringCoercion(scriptText);\n  }\n  return ('' + scriptText).replace(scriptRegex, scriptReplacer);\n}\nconst scriptRegex = /(<\\/|<)(s)(cript)/gi;\nconst scriptReplacer = (match, prefix, s, suffix) =>\n  `${prefix}${s === 's' ? '\\\\u0073' : '\\\\u0053'}${suffix}`;\n\n// Allows us to keep track of what we've already written so we can refer back to it.\nexport function createResponseState(\n  identifierPrefix: string | void,\n  nonce: string | void,\n  bootstrapScriptContent: string | void,\n  bootstrapScripts: Array<string> | void,\n  bootstrapModules: Array<string> | void,\n): ResponseState {\n  const idPrefix = identifierPrefix === undefined ? '' : identifierPrefix;\n  const inlineScriptWithNonce =\n    nonce === undefined\n      ? startInlineScript\n      : stringToPrecomputedChunk(\n          '<script nonce=\"' + escapeTextForBrowser(nonce) + '\">',\n        );\n  const bootstrapChunks = [];\n  if (bootstrapScriptContent !== undefined) {\n    bootstrapChunks.push(\n      inlineScriptWithNonce,\n      stringToChunk(escapeBootstrapScriptContent(bootstrapScriptContent)),\n      endInlineScript,\n    );\n  }\n  if (bootstrapScripts !== undefined) {\n    for (let i = 0; i < bootstrapScripts.length; i++) {\n      bootstrapChunks.push(\n        startScriptSrc,\n        stringToChunk(escapeTextForBrowser(bootstrapScripts[i])),\n        endAsyncScript,\n      );\n    }\n  }\n  if (bootstrapModules !== undefined) {\n    for (let i = 0; i < bootstrapModules.length; i++) {\n      bootstrapChunks.push(\n        startModuleSrc,\n        stringToChunk(escapeTextForBrowser(bootstrapModules[i])),\n        endAsyncScript,\n      );\n    }\n  }\n  return {\n    bootstrapChunks: bootstrapChunks,\n    startInlineScript: inlineScriptWithNonce,\n    placeholderPrefix: stringToPrecomputedChunk(idPrefix + 'P:'),\n    segmentPrefix: stringToPrecomputedChunk(idPrefix + 'S:'),\n    boundaryPrefix: idPrefix + 'B:',\n    idPrefix: idPrefix,\n    nextSuspenseID: 0,\n    sentCompleteSegmentFunction: false,\n    sentCompleteBoundaryFunction: false,\n    sentClientRenderFunction: false,\n  };\n}\n\n// Constants for the insertion mode we're currently writing in. We don't encode all HTML5 insertion\n// modes. We only include the variants as they matter for the sake of our purposes.\n// We don't actually provide the namespace therefore we use constants instead of the string.\nconst ROOT_HTML_MODE = 0; // Used for the root most element tag.\nexport const HTML_MODE = 1;\nconst SVG_MODE = 2;\nconst MATHML_MODE = 3;\nconst HTML_TABLE_MODE = 4;\nconst HTML_TABLE_BODY_MODE = 5;\nconst HTML_TABLE_ROW_MODE = 6;\nconst HTML_COLGROUP_MODE = 7;\n// We have a greater than HTML_TABLE_MODE check elsewhere. If you add more cases here, make sure it\n// still makes sense\n\ntype InsertionMode = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7;\n\n// Lets us keep track of contextual state and pick it back up after suspending.\nexport type FormatContext = {\n  insertionMode: InsertionMode, // root/svg/html/mathml/table\n  selectedValue: null | string | Array<string>, // the selected value(s) inside a <select>, or null outside <select>\n};\n\nfunction createFormatContext(\n  insertionMode: InsertionMode,\n  selectedValue: null | string,\n): FormatContext {\n  return {\n    insertionMode,\n    selectedValue,\n  };\n}\n\nexport function createRootFormatContext(namespaceURI?: string): FormatContext {\n  const insertionMode =\n    namespaceURI === 'http://www.w3.org/2000/svg'\n      ? SVG_MODE\n      : namespaceURI === 'http://www.w3.org/1998/Math/MathML'\n      ? MATHML_MODE\n      : ROOT_HTML_MODE;\n  return createFormatContext(insertionMode, null);\n}\n\nexport function getChildFormatContext(\n  parentContext: FormatContext,\n  type: string,\n  props: Object,\n): FormatContext {\n  switch (type) {\n    case 'select':\n      return createFormatContext(\n        HTML_MODE,\n        props.value != null ? props.value : props.defaultValue,\n      );\n    case 'svg':\n      return createFormatContext(SVG_MODE, null);\n    case 'math':\n      return createFormatContext(MATHML_MODE, null);\n    case 'foreignObject':\n      return createFormatContext(HTML_MODE, null);\n    // Table parents are special in that their children can only be created at all if they're\n    // wrapped in a table parent. So we need to encode that we're entering this mode.\n    case 'table':\n      return createFormatContext(HTML_TABLE_MODE, null);\n    case 'thead':\n    case 'tbody':\n    case 'tfoot':\n      return createFormatContext(HTML_TABLE_BODY_MODE, null);\n    case 'colgroup':\n      return createFormatContext(HTML_COLGROUP_MODE, null);\n    case 'tr':\n      return createFormatContext(HTML_TABLE_ROW_MODE, null);\n  }\n  if (parentContext.insertionMode >= HTML_TABLE_MODE) {\n    // Whatever tag this was, it wasn't a table parent or other special parent, so we must have\n    // entered plain HTML again.\n    return createFormatContext(HTML_MODE, null);\n  }\n  if (parentContext.insertionMode === ROOT_HTML_MODE) {\n    // We've emitted the root and is now in plain HTML mode.\n    return createFormatContext(HTML_MODE, null);\n  }\n  return parentContext;\n}\n\nexport type SuspenseBoundaryID = null | PrecomputedChunk;\n\nexport const UNINITIALIZED_SUSPENSE_BOUNDARY_ID: SuspenseBoundaryID = null;\n\nexport function assignSuspenseBoundaryID(\n  responseState: ResponseState,\n): SuspenseBoundaryID {\n  const generatedID = responseState.nextSuspenseID++;\n  return stringToPrecomputedChunk(\n    responseState.boundaryPrefix + generatedID.toString(16),\n  );\n}\n\nexport function makeId(\n  responseState: ResponseState,\n  treeId: string,\n  localId: number,\n): string {\n  const idPrefix = responseState.idPrefix;\n\n  let id = ':' + idPrefix + 'R' + treeId;\n\n  // Unless this is the first id at this level, append a number at the end\n  // that represents the position of this useId hook among all the useId\n  // hooks for this fiber.\n  if (localId > 0) {\n    id += 'H' + localId.toString(32);\n  }\n\n  return id + ':';\n}\n\nfunction encodeHTMLTextNode(text: string): string {\n  return escapeTextForBrowser(text);\n}\n\nconst textSeparator = stringToPrecomputedChunk('<!-- -->');\n\nexport function pushTextInstance(\n  target: Array<Chunk | PrecomputedChunk>,\n  text: string,\n  responseState: ResponseState,\n  textEmbedded: boolean,\n): boolean {\n  if (text === '') {\n    // Empty text doesn't have a DOM node representation and the hydration is aware of this.\n    return textEmbedded;\n  }\n  if (textEmbedded) {\n    target.push(textSeparator);\n  }\n  target.push(stringToChunk(encodeHTMLTextNode(text)));\n  return true;\n}\n\n// Called when Fizz is done with a Segment. Currently the only purpose is to conditionally\n// emit a text separator when we don't know for sure it is safe to omit\nexport function pushSegmentFinale(\n  target: Array<Chunk | PrecomputedChunk>,\n  responseState: ResponseState,\n  lastPushedText: boolean,\n  textEmbedded: boolean,\n): void {\n  if (lastPushedText && textEmbedded) {\n    target.push(textSeparator);\n  }\n}\n\nconst styleNameCache: Map<string, PrecomputedChunk> = new Map();\nfunction processStyleName(styleName: string): PrecomputedChunk {\n  const chunk = styleNameCache.get(styleName);\n  if (chunk !== undefined) {\n    return chunk;\n  }\n  const result = stringToPrecomputedChunk(\n    escapeTextForBrowser(hyphenateStyleName(styleName)),\n  );\n  styleNameCache.set(styleName, result);\n  return result;\n}\n\nconst styleAttributeStart = stringToPrecomputedChunk(' style=\"');\nconst styleAssign = stringToPrecomputedChunk(':');\nconst styleSeparator = stringToPrecomputedChunk(';');\n\nfunction pushStyle(\n  target: Array<Chunk | PrecomputedChunk>,\n  responseState: ResponseState,\n  style: Object,\n): void {\n  if (typeof style !== 'object') {\n    throw new Error(\n      'The `style` prop expects a mapping from style properties to values, ' +\n        \"not a string. For example, style={{marginRight: spacing + 'em'}} when \" +\n        'using JSX.',\n    );\n  }\n\n  let isFirst = true;\n  for (const styleName in style) {\n    if (!hasOwnProperty.call(style, styleName)) {\n      continue;\n    }\n    // If you provide unsafe user data here they can inject arbitrary CSS\n    // which may be problematic (I couldn't repro this):\n    // https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet\n    // http://www.thespanner.co.uk/2007/11/26/ultimate-xss-css-injection/\n    // This is not an XSS hole but instead a potential CSS injection issue\n    // which has lead to a greater discussion about how we're going to\n    // trust URLs moving forward. See #2115901\n    const styleValue = style[styleName];\n    if (\n      styleValue == null ||\n      typeof styleValue === 'boolean' ||\n      styleValue === ''\n    ) {\n      // TODO: We used to set empty string as a style with an empty value. Does that ever make sense?\n      continue;\n    }\n\n    let nameChunk;\n    let valueChunk;\n    const isCustomProperty = styleName.indexOf('--') === 0;\n    if (isCustomProperty) {\n      nameChunk = stringToChunk(escapeTextForBrowser(styleName));\n      if (__DEV__) {\n        checkCSSPropertyStringCoercion(styleValue, styleName);\n      }\n      valueChunk = stringToChunk(\n        escapeTextForBrowser(('' + styleValue).trim()),\n      );\n    } else {\n      if (__DEV__) {\n        warnValidStyle(styleName, styleValue);\n      }\n\n      nameChunk = processStyleName(styleName);\n      if (typeof styleValue === 'number') {\n        if (\n          styleValue !== 0 &&\n          !hasOwnProperty.call(isUnitlessNumber, styleName)\n        ) {\n          valueChunk = stringToChunk(styleValue + 'px'); // Presumes implicit 'px' suffix for unitless numbers\n        } else {\n          valueChunk = stringToChunk('' + styleValue);\n        }\n      } else {\n        if (__DEV__) {\n          checkCSSPropertyStringCoercion(styleValue, styleName);\n        }\n        valueChunk = stringToChunk(\n          escapeTextForBrowser(('' + styleValue).trim()),\n        );\n      }\n    }\n    if (isFirst) {\n      isFirst = false;\n      // If it's first, we don't need any separators prefixed.\n      target.push(styleAttributeStart, nameChunk, styleAssign, valueChunk);\n    } else {\n      target.push(styleSeparator, nameChunk, styleAssign, valueChunk);\n    }\n  }\n  if (!isFirst) {\n    target.push(attributeEnd);\n  }\n}\n\nconst attributeSeparator = stringToPrecomputedChunk(' ');\nconst attributeAssign = stringToPrecomputedChunk('=\"');\nconst attributeEnd = stringToPrecomputedChunk('\"');\nconst attributeEmptyString = stringToPrecomputedChunk('=\"\"');\n\nfunction pushAttribute(\n  target: Array<Chunk | PrecomputedChunk>,\n  responseState: ResponseState,\n  name: string,\n  value: string | boolean | number | Function | Object, // not null or undefined\n): void {\n  switch (name) {\n    case 'style': {\n      pushStyle(target, responseState, value);\n      return;\n    }\n    case 'defaultValue':\n    case 'defaultChecked': // These shouldn't be set as attributes on generic HTML elements.\n    case 'innerHTML': // Must use dangerouslySetInnerHTML instead.\n    case 'suppressContentEditableWarning':\n    case 'suppressHydrationWarning':\n      // Ignored. These are built-in to React on the client.\n      return;\n  }\n  if (\n    // shouldIgnoreAttribute\n    // We have already filtered out null/undefined and reserved words.\n    name.length > 2 &&\n    (name[0] === 'o' || name[0] === 'O') &&\n    (name[1] === 'n' || name[1] === 'N')\n  ) {\n    return;\n  }\n\n  const propertyInfo = getPropertyInfo(name);\n  if (propertyInfo !== null) {\n    // shouldRemoveAttribute\n    switch (typeof value) {\n      case 'function':\n      // $FlowIssue symbol is perfectly valid here\n      case 'symbol': // eslint-disable-line\n        return;\n      case 'boolean': {\n        if (!propertyInfo.acceptsBooleans) {\n          return;\n        }\n      }\n    }\n    if (enableFilterEmptyStringAttributesDOM) {\n      if (propertyInfo.removeEmptyString && value === '') {\n        if (__DEV__) {\n          if (name === 'src') {\n            console.error(\n              'An empty string (\"\") was passed to the %s attribute. ' +\n                'This may cause the browser to download the whole page again over the network. ' +\n                'To fix this, either do not render the element at all ' +\n                'or pass null to %s instead of an empty string.',\n              name,\n              name,\n            );\n          } else {\n            console.error(\n              'An empty string (\"\") was passed to the %s attribute. ' +\n                'To fix this, either do not render the element at all ' +\n                'or pass null to %s instead of an empty string.',\n              name,\n              name,\n            );\n          }\n        }\n        return;\n      }\n    }\n\n    const attributeName = propertyInfo.attributeName;\n    const attributeNameChunk = stringToChunk(attributeName); // TODO: If it's known we can cache the chunk.\n\n    switch (propertyInfo.type) {\n      case BOOLEAN:\n        if (value) {\n          target.push(\n            attributeSeparator,\n            attributeNameChunk,\n            attributeEmptyString,\n          );\n        }\n        return;\n      case OVERLOADED_BOOLEAN:\n        if (value === true) {\n          target.push(\n            attributeSeparator,\n            attributeNameChunk,\n            attributeEmptyString,\n          );\n        } else if (value === false) {\n          // Ignored\n        } else {\n          target.push(\n            attributeSeparator,\n            attributeNameChunk,\n            attributeAssign,\n            stringToChunk(escapeTextForBrowser(value)),\n            attributeEnd,\n          );\n        }\n        return;\n      case NUMERIC:\n        if (!isNaN(value)) {\n          target.push(\n            attributeSeparator,\n            attributeNameChunk,\n            attributeAssign,\n            stringToChunk(escapeTextForBrowser(value)),\n            attributeEnd,\n          );\n        }\n        break;\n      case POSITIVE_NUMERIC:\n        if (!isNaN(value) && (value: any) >= 1) {\n          target.push(\n            attributeSeparator,\n            attributeNameChunk,\n            attributeAssign,\n            stringToChunk(escapeTextForBrowser(value)),\n            attributeEnd,\n          );\n        }\n        break;\n      default:\n        if (propertyInfo.sanitizeURL) {\n          if (__DEV__) {\n            checkAttributeStringCoercion(value, attributeName);\n          }\n          value = '' + (value: any);\n          sanitizeURL(value);\n        }\n        target.push(\n          attributeSeparator,\n          attributeNameChunk,\n          attributeAssign,\n          stringToChunk(escapeTextForBrowser(value)),\n          attributeEnd,\n        );\n    }\n  } else if (isAttributeNameSafe(name)) {\n    // shouldRemoveAttribute\n    switch (typeof value) {\n      case 'function':\n      // $FlowIssue symbol is perfectly valid here\n      case 'symbol': // eslint-disable-line\n        return;\n      case 'boolean': {\n        const prefix = name.toLowerCase().slice(0, 5);\n        if (prefix !== 'data-' && prefix !== 'aria-') {\n          return;\n        }\n      }\n    }\n    target.push(\n      attributeSeparator,\n      stringToChunk(name),\n      attributeAssign,\n      stringToChunk(escapeTextForBrowser(value)),\n      attributeEnd,\n    );\n  }\n}\n\nconst endOfStartTag = stringToPrecomputedChunk('>');\nconst endOfStartTagSelfClosing = stringToPrecomputedChunk('/>');\n\nfunction pushInnerHTML(\n  target: Array<Chunk | PrecomputedChunk>,\n  innerHTML,\n  children,\n) {\n  if (innerHTML != null) {\n    if (children != null) {\n      throw new Error(\n        'Can only set one of `children` or `props.dangerouslySetInnerHTML`.',\n      );\n    }\n\n    if (typeof innerHTML !== 'object' || !('__html' in innerHTML)) {\n      throw new Error(\n        '`props.dangerouslySetInnerHTML` must be in the form `{__html: ...}`. ' +\n          'Please visit https://reactjs.org/link/dangerously-set-inner-html ' +\n          'for more information.',\n      );\n    }\n\n    const html = innerHTML.__html;\n    if (html !== null && html !== undefined) {\n      if (__DEV__) {\n        checkHtmlStringCoercion(html);\n      }\n      target.push(stringToChunk('' + html));\n    }\n  }\n}\n\n// TODO: Move these to ResponseState so that we warn for every request.\n// It would help debugging in stateful servers (e.g. service worker).\nlet didWarnDefaultInputValue = false;\nlet didWarnDefaultChecked = false;\nlet didWarnDefaultSelectValue = false;\nlet didWarnDefaultTextareaValue = false;\nlet didWarnInvalidOptionChildren = false;\nlet didWarnInvalidOptionInnerHTML = false;\nlet didWarnSelectedSetOnOption = false;\n\nfunction checkSelectProp(props, propName) {\n  if (__DEV__) {\n    const value = props[propName];\n    if (value != null) {\n      const array = isArray(value);\n      if (props.multiple && !array) {\n        console.error(\n          'The `%s` prop supplied to <select> must be an array if ' +\n            '`multiple` is true.',\n          propName,\n        );\n      } else if (!props.multiple && array) {\n        console.error(\n          'The `%s` prop supplied to <select> must be a scalar ' +\n            'value if `multiple` is false.',\n          propName,\n        );\n      }\n    }\n  }\n}\n\nfunction pushStartSelect(\n  target: Array<Chunk | PrecomputedChunk>,\n  props: Object,\n  responseState: ResponseState,\n): ReactNodeList {\n  if (__DEV__) {\n    checkControlledValueProps('select', props);\n\n    checkSelectProp(props, 'value');\n    checkSelectProp(props, 'defaultValue');\n\n    if (\n      props.value !== undefined &&\n      props.defaultValue !== undefined &&\n      !didWarnDefaultSelectValue\n    ) {\n      console.error(\n        'Select elements must be either controlled or uncontrolled ' +\n          '(specify either the value prop, or the defaultValue prop, but not ' +\n          'both). Decide between using a controlled or uncontrolled select ' +\n          'element and remove one of these props. More info: ' +\n          'https://reactjs.org/link/controlled-components',\n      );\n      didWarnDefaultSelectValue = true;\n    }\n  }\n\n  target.push(startChunkForTag('select'));\n\n  let children = null;\n  let innerHTML = null;\n  for (const propKey in props) {\n    if (hasOwnProperty.call(props, propKey)) {\n      const propValue = props[propKey];\n      if (propValue == null) {\n        continue;\n      }\n      switch (propKey) {\n        case 'children':\n          children = propValue;\n          break;\n        case 'dangerouslySetInnerHTML':\n          // TODO: This doesn't really make sense for select since it can't use the controlled\n          // value in the innerHTML.\n          innerHTML = propValue;\n          break;\n        case 'defaultValue':\n        case 'value':\n          // These are set on the Context instead and applied to the nested options.\n          break;\n        default:\n          pushAttribute(target, responseState, propKey, propValue);\n          break;\n      }\n    }\n  }\n\n  target.push(endOfStartTag);\n  pushInnerHTML(target, innerHTML, children);\n  return children;\n}\n\nfunction flattenOptionChildren(children: mixed): string {\n  let content = '';\n  // Flatten children and warn if they aren't strings or numbers;\n  // invalid types are ignored.\n  Children.forEach((children: any), function(child) {\n    if (child == null) {\n      return;\n    }\n    content += (child: any);\n    if (__DEV__) {\n      if (\n        !didWarnInvalidOptionChildren &&\n        typeof child !== 'string' &&\n        typeof child !== 'number'\n      ) {\n        didWarnInvalidOptionChildren = true;\n        console.error(\n          'Cannot infer the option value of complex children. ' +\n            'Pass a `value` prop or use a plain string as children to <option>.',\n        );\n      }\n    }\n  });\n  return content;\n}\n\nconst selectedMarkerAttribute = stringToPrecomputedChunk(' selected=\"\"');\n\nfunction pushStartOption(\n  target: Array<Chunk | PrecomputedChunk>,\n  props: Object,\n  responseState: ResponseState,\n  formatContext: FormatContext,\n): ReactNodeList {\n  const selectedValue = formatContext.selectedValue;\n\n  target.push(startChunkForTag('option'));\n\n  let children = null;\n  let value = null;\n  let selected = null;\n  let innerHTML = null;\n  for (const propKey in props) {\n    if (hasOwnProperty.call(props, propKey)) {\n      const propValue = props[propKey];\n      if (propValue == null) {\n        continue;\n      }\n      switch (propKey) {\n        case 'children':\n          children = propValue;\n          break;\n        case 'selected':\n          // ignore\n          selected = propValue;\n          if (__DEV__) {\n            // TODO: Remove support for `selected` in <option>.\n            if (!didWarnSelectedSetOnOption) {\n              console.error(\n                'Use the `defaultValue` or `value` props on <select> instead of ' +\n                  'setting `selected` on <option>.',\n              );\n              didWarnSelectedSetOnOption = true;\n            }\n          }\n          break;\n        case 'dangerouslySetInnerHTML':\n          innerHTML = propValue;\n          break;\n        // eslint-disable-next-line-no-fallthrough\n        case 'value':\n          value = propValue;\n        // We intentionally fallthrough to also set the attribute on the node.\n        // eslint-disable-next-line-no-fallthrough\n        default:\n          pushAttribute(target, responseState, propKey, propValue);\n          break;\n      }\n    }\n  }\n\n  if (selectedValue != null) {\n    let stringValue;\n    if (value !== null) {\n      if (__DEV__) {\n        checkAttributeStringCoercion(value, 'value');\n      }\n      stringValue = '' + value;\n    } else {\n      if (__DEV__) {\n        if (innerHTML !== null) {\n          if (!didWarnInvalidOptionInnerHTML) {\n            didWarnInvalidOptionInnerHTML = true;\n            console.error(\n              'Pass a `value` prop if you set dangerouslyInnerHTML so React knows ' +\n                'which value should be selected.',\n            );\n          }\n        }\n      }\n      stringValue = flattenOptionChildren(children);\n    }\n    if (isArray(selectedValue)) {\n      // multiple\n      for (let i = 0; i < selectedValue.length; i++) {\n        if (__DEV__) {\n          checkAttributeStringCoercion(selectedValue[i], 'value');\n        }\n        const v = '' + selectedValue[i];\n        if (v === stringValue) {\n          target.push(selectedMarkerAttribute);\n          break;\n        }\n      }\n    } else {\n      if (__DEV__) {\n        checkAttributeStringCoercion(selectedValue, 'select.value');\n      }\n      if ('' + selectedValue === stringValue) {\n        target.push(selectedMarkerAttribute);\n      }\n    }\n  } else if (selected) {\n    target.push(selectedMarkerAttribute);\n  }\n\n  target.push(endOfStartTag);\n  pushInnerHTML(target, innerHTML, children);\n  return children;\n}\n\nfunction pushInput(\n  target: Array<Chunk | PrecomputedChunk>,\n  props: Object,\n  responseState: ResponseState,\n): ReactNodeList {\n  if (__DEV__) {\n    checkControlledValueProps('input', props);\n\n    if (\n      props.checked !== undefined &&\n      props.defaultChecked !== undefined &&\n      !didWarnDefaultChecked\n    ) {\n      console.error(\n        '%s contains an input of type %s with both checked and defaultChecked props. ' +\n          'Input elements must be either controlled or uncontrolled ' +\n          '(specify either the checked prop, or the defaultChecked prop, but not ' +\n          'both). Decide between using a controlled or uncontrolled input ' +\n          'element and remove one of these props. More info: ' +\n          'https://reactjs.org/link/controlled-components',\n        'A component',\n        props.type,\n      );\n      didWarnDefaultChecked = true;\n    }\n    if (\n      props.value !== undefined &&\n      props.defaultValue !== undefined &&\n      !didWarnDefaultInputValue\n    ) {\n      console.error(\n        '%s contains an input of type %s with both value and defaultValue props. ' +\n          'Input elements must be either controlled or uncontrolled ' +\n          '(specify either the value prop, or the defaultValue prop, but not ' +\n          'both). Decide between using a controlled or uncontrolled input ' +\n          'element and remove one of these props. More info: ' +\n          'https://reactjs.org/link/controlled-components',\n        'A component',\n        props.type,\n      );\n      didWarnDefaultInputValue = true;\n    }\n  }\n\n  target.push(startChunkForTag('input'));\n\n  let value = null;\n  let defaultValue = null;\n  let checked = null;\n  let defaultChecked = null;\n\n  for (const propKey in props) {\n    if (hasOwnProperty.call(props, propKey)) {\n      const propValue = props[propKey];\n      if (propValue == null) {\n        continue;\n      }\n      switch (propKey) {\n        case 'children':\n        case 'dangerouslySetInnerHTML':\n          throw new Error(\n            `${'input'} is a self-closing tag and must neither have \\`children\\` nor ` +\n              'use `dangerouslySetInnerHTML`.',\n          );\n        // eslint-disable-next-line-no-fallthrough\n        case 'defaultChecked':\n          defaultChecked = propValue;\n          break;\n        case 'defaultValue':\n          defaultValue = propValue;\n          break;\n        case 'checked':\n          checked = propValue;\n          break;\n        case 'value':\n          value = propValue;\n          break;\n        default:\n          pushAttribute(target, responseState, propKey, propValue);\n          break;\n      }\n    }\n  }\n\n  if (checked !== null) {\n    pushAttribute(target, responseState, 'checked', checked);\n  } else if (defaultChecked !== null) {\n    pushAttribute(target, responseState, 'checked', defaultChecked);\n  }\n  if (value !== null) {\n    pushAttribute(target, responseState, 'value', value);\n  } else if (defaultValue !== null) {\n    pushAttribute(target, responseState, 'value', defaultValue);\n  }\n\n  target.push(endOfStartTagSelfClosing);\n  return null;\n}\n\nfunction pushStartTextArea(\n  target: Array<Chunk | PrecomputedChunk>,\n  props: Object,\n  responseState: ResponseState,\n): ReactNodeList {\n  if (__DEV__) {\n    checkControlledValueProps('textarea', props);\n    if (\n      props.value !== undefined &&\n      props.defaultValue !== undefined &&\n      !didWarnDefaultTextareaValue\n    ) {\n      console.error(\n        'Textarea elements must be either controlled or uncontrolled ' +\n          '(specify either the value prop, or the defaultValue prop, but not ' +\n          'both). Decide between using a controlled or uncontrolled textarea ' +\n          'and remove one of these props. More info: ' +\n          'https://reactjs.org/link/controlled-components',\n      );\n      didWarnDefaultTextareaValue = true;\n    }\n  }\n\n  target.push(startChunkForTag('textarea'));\n\n  let value = null;\n  let defaultValue = null;\n  let children = null;\n  for (const propKey in props) {\n    if (hasOwnProperty.call(props, propKey)) {\n      const propValue = props[propKey];\n      if (propValue == null) {\n        continue;\n      }\n      switch (propKey) {\n        case 'children':\n          children = propValue;\n          break;\n        case 'value':\n          value = propValue;\n          break;\n        case 'defaultValue':\n          defaultValue = propValue;\n          break;\n        case 'dangerouslySetInnerHTML':\n          throw new Error(\n            '`dangerouslySetInnerHTML` does not make sense on <textarea>.',\n          );\n        // eslint-disable-next-line-no-fallthrough\n        default:\n          pushAttribute(target, responseState, propKey, propValue);\n          break;\n      }\n    }\n  }\n  if (value === null && defaultValue !== null) {\n    value = defaultValue;\n  }\n\n  target.push(endOfStartTag);\n\n  // TODO (yungsters): Remove support for children content in <textarea>.\n  if (children != null) {\n    if (__DEV__) {\n      console.error(\n        'Use the `defaultValue` or `value` props instead of setting ' +\n          'children on <textarea>.',\n      );\n    }\n\n    if (value != null) {\n      throw new Error(\n        'If you supply `defaultValue` on a <textarea>, do not pass children.',\n      );\n    }\n\n    if (isArray(children)) {\n      if (children.length > 1) {\n        throw new Error('<textarea> can only have at most one child.');\n      }\n\n      // TODO: remove the coercion and the DEV check below because it will\n      // always be overwritten by the coercion several lines below it. #22309\n      if (__DEV__) {\n        checkHtmlStringCoercion(children[0]);\n      }\n      value = '' + children[0];\n    }\n    if (__DEV__) {\n      checkHtmlStringCoercion(children);\n    }\n    value = '' + children;\n  }\n\n  if (typeof value === 'string' && value[0] === '\\n') {\n    // text/html ignores the first character in these tags if it's a newline\n    // Prefer to break application/xml over text/html (for now) by adding\n    // a newline specifically to get eaten by the parser. (Alternately for\n    // textareas, replacing \"^\\n\" with \"\\r\\n\" doesn't get eaten, and the first\n    // \\r is normalized out by HTMLTextAreaElement#value.)\n    // See: <http://www.w3.org/TR/html-polyglot/#newlines-in-textarea-and-pre>\n    // See: <http://www.w3.org/TR/html5/syntax.html#element-restrictions>\n    // See: <http://www.w3.org/TR/html5/syntax.html#newlines>\n    // See: Parsing of \"textarea\" \"listing\" and \"pre\" elements\n    //  from <http://www.w3.org/TR/html5/syntax.html#parsing-main-inbody>\n    target.push(leadingNewline);\n  }\n\n  // ToString and push directly instead of recurse over children.\n  // We don't really support complex children in the value anyway.\n  // This also currently avoids a trailing comment node which breaks textarea.\n  if (value !== null) {\n    if (__DEV__) {\n      checkAttributeStringCoercion(value, 'value');\n    }\n    target.push(stringToChunk(encodeHTMLTextNode('' + value)));\n  }\n\n  return null;\n}\n\nfunction pushSelfClosing(\n  target: Array<Chunk | PrecomputedChunk>,\n  props: Object,\n  tag: string,\n  responseState: ResponseState,\n): ReactNodeList {\n  target.push(startChunkForTag(tag));\n\n  for (const propKey in props) {\n    if (hasOwnProperty.call(props, propKey)) {\n      const propValue = props[propKey];\n      if (propValue == null) {\n        continue;\n      }\n      switch (propKey) {\n        case 'children':\n        case 'dangerouslySetInnerHTML':\n          throw new Error(\n            `${tag} is a self-closing tag and must neither have \\`children\\` nor ` +\n              'use `dangerouslySetInnerHTML`.',\n          );\n        // eslint-disable-next-line-no-fallthrough\n        default:\n          pushAttribute(target, responseState, propKey, propValue);\n          break;\n      }\n    }\n  }\n\n  target.push(endOfStartTagSelfClosing);\n  return null;\n}\n\nfunction pushStartMenuItem(\n  target: Array<Chunk | PrecomputedChunk>,\n  props: Object,\n  responseState: ResponseState,\n): ReactNodeList {\n  target.push(startChunkForTag('menuitem'));\n\n  for (const propKey in props) {\n    if (hasOwnProperty.call(props, propKey)) {\n      const propValue = props[propKey];\n      if (propValue == null) {\n        continue;\n      }\n      switch (propKey) {\n        case 'children':\n        case 'dangerouslySetInnerHTML':\n          throw new Error(\n            'menuitems cannot have `children` nor `dangerouslySetInnerHTML`.',\n          );\n        // eslint-disable-next-line-no-fallthrough\n        default:\n          pushAttribute(target, responseState, propKey, propValue);\n          break;\n      }\n    }\n  }\n\n  target.push(endOfStartTag);\n  return null;\n}\n\nfunction pushStartTitle(\n  target: Array<Chunk | PrecomputedChunk>,\n  props: Object,\n  responseState: ResponseState,\n): ReactNodeList {\n  target.push(startChunkForTag('title'));\n\n  let children = null;\n  for (const propKey in props) {\n    if (hasOwnProperty.call(props, propKey)) {\n      const propValue = props[propKey];\n      if (propValue == null) {\n        continue;\n      }\n      switch (propKey) {\n        case 'children':\n          children = propValue;\n          break;\n        case 'dangerouslySetInnerHTML':\n          throw new Error(\n            '`dangerouslySetInnerHTML` does not make sense on <title>.',\n          );\n        // eslint-disable-next-line-no-fallthrough\n        default:\n          pushAttribute(target, responseState, propKey, propValue);\n          break;\n      }\n    }\n  }\n  target.push(endOfStartTag);\n\n  if (__DEV__) {\n    const child =\n      Array.isArray(children) && children.length < 2\n        ? children[0] || null\n        : children;\n    if (Array.isArray(children) && children.length > 1) {\n      console.error(\n        'A title element received an array with more than 1 element as children. ' +\n          'In browsers title Elements can only have Text Nodes as children. If ' +\n          'the children being rendered output more than a single text node in aggregate the browser ' +\n          'will display markup and comments as text in the title and hydration will likely fail and ' +\n          'fall back to client rendering',\n      );\n    } else if (child != null && child.$$typeof != null) {\n      console.error(\n        'A title element received a React element for children. ' +\n          'In the browser title Elements can only have Text Nodes as children. If ' +\n          'the children being rendered output more than a single text node in aggregate the browser ' +\n          'will display markup and comments as text in the title and hydration will likely fail and ' +\n          'fall back to client rendering',\n      );\n    } else if (\n      child != null &&\n      typeof child !== 'string' &&\n      typeof child !== 'number'\n    ) {\n      console.error(\n        'A title element received a value that was not a string or number for children. ' +\n          'In the browser title Elements can only have Text Nodes as children. If ' +\n          'the children being rendered output more than a single text node in aggregate the browser ' +\n          'will display markup and comments as text in the title and hydration will likely fail and ' +\n          'fall back to client rendering',\n      );\n    }\n  }\n  return children;\n}\n\nfunction pushStartGenericElement(\n  target: Array<Chunk | PrecomputedChunk>,\n  props: Object,\n  tag: string,\n  responseState: ResponseState,\n): ReactNodeList {\n  target.push(startChunkForTag(tag));\n\n  let children = null;\n  let innerHTML = null;\n  for (const propKey in props) {\n    if (hasOwnProperty.call(props, propKey)) {\n      const propValue = props[propKey];\n      if (propValue == null) {\n        continue;\n      }\n      switch (propKey) {\n        case 'children':\n          children = propValue;\n          break;\n        case 'dangerouslySetInnerHTML':\n          innerHTML = propValue;\n          break;\n        default:\n          pushAttribute(target, responseState, propKey, propValue);\n          break;\n      }\n    }\n  }\n\n  target.push(endOfStartTag);\n  pushInnerHTML(target, innerHTML, children);\n  if (typeof children === 'string') {\n    // Special case children as a string to avoid the unnecessary comment.\n    // TODO: Remove this special case after the general optimization is in place.\n    target.push(stringToChunk(encodeHTMLTextNode(children)));\n    return null;\n  }\n  return children;\n}\n\nfunction pushStartCustomElement(\n  target: Array<Chunk | PrecomputedChunk>,\n  props: Object,\n  tag: string,\n  responseState: ResponseState,\n): ReactNodeList {\n  target.push(startChunkForTag(tag));\n\n  let children = null;\n  let innerHTML = null;\n  for (let propKey in props) {\n    if (hasOwnProperty.call(props, propKey)) {\n      let propValue = props[propKey];\n      if (propValue == null) {\n        continue;\n      }\n      if (\n        enableCustomElementPropertySupport &&\n        (typeof propValue === 'function' || typeof propValue === 'object')\n      ) {\n        // It is normal to render functions and objects on custom elements when\n        // client rendering, but when server rendering the output isn't useful,\n        // so skip it.\n        continue;\n      }\n      if (enableCustomElementPropertySupport && propValue === false) {\n        continue;\n      }\n      if (enableCustomElementPropertySupport && propValue === true) {\n        propValue = '';\n      }\n      if (enableCustomElementPropertySupport && propKey === 'className') {\n        // className gets rendered as class on the client, so it should be\n        // rendered as class on the server.\n        propKey = 'class';\n      }\n      switch (propKey) {\n        case 'children':\n          children = propValue;\n          break;\n        case 'dangerouslySetInnerHTML':\n          innerHTML = propValue;\n          break;\n        case 'style':\n          pushStyle(target, responseState, propValue);\n          break;\n        case 'suppressContentEditableWarning':\n        case 'suppressHydrationWarning':\n          // Ignored. These are built-in to React on the client.\n          break;\n        default:\n          if (\n            isAttributeNameSafe(propKey) &&\n            typeof propValue !== 'function' &&\n            typeof propValue !== 'symbol'\n          ) {\n            target.push(\n              attributeSeparator,\n              stringToChunk(propKey),\n              attributeAssign,\n              stringToChunk(escapeTextForBrowser(propValue)),\n              attributeEnd,\n            );\n          }\n          break;\n      }\n    }\n  }\n\n  target.push(endOfStartTag);\n  pushInnerHTML(target, innerHTML, children);\n  return children;\n}\n\nconst leadingNewline = stringToPrecomputedChunk('\\n');\n\nfunction pushStartPreformattedElement(\n  target: Array<Chunk | PrecomputedChunk>,\n  props: Object,\n  tag: string,\n  responseState: ResponseState,\n): ReactNodeList {\n  target.push(startChunkForTag(tag));\n\n  let children = null;\n  let innerHTML = null;\n  for (const propKey in props) {\n    if (hasOwnProperty.call(props, propKey)) {\n      const propValue = props[propKey];\n      if (propValue == null) {\n        continue;\n      }\n      switch (propKey) {\n        case 'children':\n          children = propValue;\n          break;\n        case 'dangerouslySetInnerHTML':\n          innerHTML = propValue;\n          break;\n        default:\n          pushAttribute(target, responseState, propKey, propValue);\n          break;\n      }\n    }\n  }\n\n  target.push(endOfStartTag);\n\n  // text/html ignores the first character in these tags if it's a newline\n  // Prefer to break application/xml over text/html (for now) by adding\n  // a newline specifically to get eaten by the parser. (Alternately for\n  // textareas, replacing \"^\\n\" with \"\\r\\n\" doesn't get eaten, and the first\n  // \\r is normalized out by HTMLTextAreaElement#value.)\n  // See: <http://www.w3.org/TR/html-polyglot/#newlines-in-textarea-and-pre>\n  // See: <http://www.w3.org/TR/html5/syntax.html#element-restrictions>\n  // See: <http://www.w3.org/TR/html5/syntax.html#newlines>\n  // See: Parsing of \"textarea\" \"listing\" and \"pre\" elements\n  //  from <http://www.w3.org/TR/html5/syntax.html#parsing-main-inbody>\n  // TODO: This doesn't deal with the case where the child is an array\n  // or component that returns a string.\n  if (innerHTML != null) {\n    if (children != null) {\n      throw new Error(\n        'Can only set one of `children` or `props.dangerouslySetInnerHTML`.',\n      );\n    }\n\n    if (typeof innerHTML !== 'object' || !('__html' in innerHTML)) {\n      throw new Error(\n        '`props.dangerouslySetInnerHTML` must be in the form `{__html: ...}`. ' +\n          'Please visit https://reactjs.org/link/dangerously-set-inner-html ' +\n          'for more information.',\n      );\n    }\n\n    const html = innerHTML.__html;\n    if (html !== null && html !== undefined) {\n      if (typeof html === 'string' && html.length > 0 && html[0] === '\\n') {\n        target.push(leadingNewline, stringToChunk(html));\n      } else {\n        if (__DEV__) {\n          checkHtmlStringCoercion(html);\n        }\n        target.push(stringToChunk('' + html));\n      }\n    }\n  }\n  if (typeof children === 'string' && children[0] === '\\n') {\n    target.push(leadingNewline);\n  }\n  return children;\n}\n\n// We accept any tag to be rendered but since this gets injected into arbitrary\n// HTML, we want to make sure that it's a safe tag.\n// http://www.w3.org/TR/REC-xml/#NT-Name\nconst VALID_TAG_REGEX = /^[a-zA-Z][a-zA-Z:_\\.\\-\\d]*$/; // Simplified subset\nconst validatedTagCache = new Map();\nfunction startChunkForTag(tag: string): PrecomputedChunk {\n  let tagStartChunk = validatedTagCache.get(tag);\n  if (tagStartChunk === undefined) {\n    if (!VALID_TAG_REGEX.test(tag)) {\n      throw new Error(`Invalid tag: ${tag}`);\n    }\n\n    tagStartChunk = stringToPrecomputedChunk('<' + tag);\n    validatedTagCache.set(tag, tagStartChunk);\n  }\n  return tagStartChunk;\n}\n\nconst DOCTYPE: PrecomputedChunk = stringToPrecomputedChunk('<!DOCTYPE html>');\n\nexport function pushStartInstance(\n  target: Array<Chunk | PrecomputedChunk>,\n  type: string,\n  props: Object,\n  responseState: ResponseState,\n  formatContext: FormatContext,\n): ReactNodeList {\n  if (__DEV__) {\n    validateARIAProperties(type, props);\n    validateInputProperties(type, props);\n    validateUnknownProperties(type, props, null);\n\n    if (\n      !props.suppressContentEditableWarning &&\n      props.contentEditable &&\n      props.children != null\n    ) {\n      console.error(\n        'A component is `contentEditable` and contains `children` managed by ' +\n          'React. It is now your responsibility to guarantee that none of ' +\n          'those nodes are unexpectedly modified or duplicated. This is ' +\n          'probably not intentional.',\n      );\n    }\n\n    if (\n      formatContext.insertionMode !== SVG_MODE &&\n      formatContext.insertionMode !== MATHML_MODE\n    ) {\n      if (\n        type.indexOf('-') === -1 &&\n        typeof props.is !== 'string' &&\n        type.toLowerCase() !== type\n      ) {\n        console.error(\n          '<%s /> is using incorrect casing. ' +\n            'Use PascalCase for React components, ' +\n            'or lowercase for HTML elements.',\n          type,\n        );\n      }\n    }\n  }\n\n  switch (type) {\n    // Special tags\n    case 'select':\n      return pushStartSelect(target, props, responseState);\n    case 'option':\n      return pushStartOption(target, props, responseState, formatContext);\n    case 'textarea':\n      return pushStartTextArea(target, props, responseState);\n    case 'input':\n      return pushInput(target, props, responseState);\n    case 'menuitem':\n      return pushStartMenuItem(target, props, responseState);\n    case 'title':\n      return pushStartTitle(target, props, responseState);\n    // Newline eating tags\n    case 'listing':\n    case 'pre': {\n      return pushStartPreformattedElement(target, props, type, responseState);\n    }\n    // Omitted close tags\n    case 'area':\n    case 'base':\n    case 'br':\n    case 'col':\n    case 'embed':\n    case 'hr':\n    case 'img':\n    case 'keygen':\n    case 'link':\n    case 'meta':\n    case 'param':\n    case 'source':\n    case 'track':\n    case 'wbr': {\n      return pushSelfClosing(target, props, type, responseState);\n    }\n    // These are reserved SVG and MathML elements, that are never custom elements.\n    // https://w3c.github.io/webcomponents/spec/custom/#custom-elements-core-concepts\n    case 'annotation-xml':\n    case 'color-profile':\n    case 'font-face':\n    case 'font-face-src':\n    case 'font-face-uri':\n    case 'font-face-format':\n    case 'font-face-name':\n    case 'missing-glyph': {\n      return pushStartGenericElement(target, props, type, responseState);\n    }\n    case 'html': {\n      if (formatContext.insertionMode === ROOT_HTML_MODE) {\n        // If we're rendering the html tag and we're at the root (i.e. not in foreignObject)\n        // then we also emit the DOCTYPE as part of the root content as a convenience for\n        // rendering the whole document.\n        target.push(DOCTYPE);\n      }\n      return pushStartGenericElement(target, props, type, responseState);\n    }\n    default: {\n      if (type.indexOf('-') === -1 && typeof props.is !== 'string') {\n        // Generic element\n        return pushStartGenericElement(target, props, type, responseState);\n      } else {\n        // Custom element\n        return pushStartCustomElement(target, props, type, responseState);\n      }\n    }\n  }\n}\n\nconst endTag1 = stringToPrecomputedChunk('</');\nconst endTag2 = stringToPrecomputedChunk('>');\n\nexport function pushEndInstance(\n  target: Array<Chunk | PrecomputedChunk>,\n  type: string,\n  props: Object,\n): void {\n  switch (type) {\n    // Omitted close tags\n    // TODO: Instead of repeating this switch we could try to pass a flag from above.\n    // That would require returning a tuple. Which might be ok if it gets inlined.\n    case 'area':\n    case 'base':\n    case 'br':\n    case 'col':\n    case 'embed':\n    case 'hr':\n    case 'img':\n    case 'input':\n    case 'keygen':\n    case 'link':\n    case 'meta':\n    case 'param':\n    case 'source':\n    case 'track':\n    case 'wbr': {\n      // No close tag needed.\n      break;\n    }\n    default: {\n      target.push(endTag1, stringToChunk(type), endTag2);\n    }\n  }\n}\n\nexport function writeCompletedRoot(\n  destination: Destination,\n  responseState: ResponseState,\n): boolean {\n  const bootstrapChunks = responseState.bootstrapChunks;\n  let i = 0;\n  for (; i < bootstrapChunks.length - 1; i++) {\n    writeChunk(destination, bootstrapChunks[i]);\n  }\n  if (i < bootstrapChunks.length) {\n    return writeChunkAndReturn(destination, bootstrapChunks[i]);\n  }\n  return true;\n}\n\n// Structural Nodes\n\n// A placeholder is a node inside a hidden partial tree that can be filled in later, but before\n// display. It's never visible to users. We use the template tag because it can be used in every\n// type of parent. <script> tags also work in every other tag except <colgroup>.\nconst placeholder1 = stringToPrecomputedChunk('<template id=\"');\nconst placeholder2 = stringToPrecomputedChunk('\"></template>');\nexport function writePlaceholder(\n  destination: Destination,\n  responseState: ResponseState,\n  id: number,\n): boolean {\n  writeChunk(destination, placeholder1);\n  writeChunk(destination, responseState.placeholderPrefix);\n  const formattedID = stringToChunk(id.toString(16));\n  writeChunk(destination, formattedID);\n  return writeChunkAndReturn(destination, placeholder2);\n}\n\n// Suspense boundaries are encoded as comments.\nconst startCompletedSuspenseBoundary = stringToPrecomputedChunk('<!--$-->');\nconst startPendingSuspenseBoundary1 = stringToPrecomputedChunk(\n  '<!--$?--><template id=\"',\n);\nconst startPendingSuspenseBoundary2 = stringToPrecomputedChunk('\"></template>');\nconst startClientRenderedSuspenseBoundary = stringToPrecomputedChunk(\n  '<!--$!-->',\n);\nconst endSuspenseBoundary = stringToPrecomputedChunk('<!--/$-->');\n\nconst clientRenderedSuspenseBoundaryError1 = stringToPrecomputedChunk(\n  '<template',\n);\nconst clientRenderedSuspenseBoundaryErrorAttrInterstitial = stringToPrecomputedChunk(\n  '\"',\n);\nconst clientRenderedSuspenseBoundaryError1A = stringToPrecomputedChunk(\n  ' data-dgst=\"',\n);\nconst clientRenderedSuspenseBoundaryError1B = stringToPrecomputedChunk(\n  ' data-msg=\"',\n);\nconst clientRenderedSuspenseBoundaryError1C = stringToPrecomputedChunk(\n  ' data-stck=\"',\n);\nconst clientRenderedSuspenseBoundaryError2 = stringToPrecomputedChunk(\n  '></template>',\n);\n\nexport function pushStartCompletedSuspenseBoundary(\n  target: Array<Chunk | PrecomputedChunk>,\n) {\n  target.push(startCompletedSuspenseBoundary);\n}\n\nexport function pushEndCompletedSuspenseBoundary(\n  target: Array<Chunk | PrecomputedChunk>,\n) {\n  target.push(endSuspenseBoundary);\n}\n\nexport function writeStartCompletedSuspenseBoundary(\n  destination: Destination,\n  responseState: ResponseState,\n): boolean {\n  return writeChunkAndReturn(destination, startCompletedSuspenseBoundary);\n}\nexport function writeStartPendingSuspenseBoundary(\n  destination: Destination,\n  responseState: ResponseState,\n  id: SuspenseBoundaryID,\n): boolean {\n  writeChunk(destination, startPendingSuspenseBoundary1);\n\n  if (id === null) {\n    throw new Error(\n      'An ID must have been assigned before we can complete the boundary.',\n    );\n  }\n\n  writeChunk(destination, id);\n  return writeChunkAndReturn(destination, startPendingSuspenseBoundary2);\n}\nexport function writeStartClientRenderedSuspenseBoundary(\n  destination: Destination,\n  responseState: ResponseState,\n  errorDigest: ?string,\n  errorMesssage: ?string,\n  errorComponentStack: ?string,\n): boolean {\n  let result;\n  result = writeChunkAndReturn(\n    destination,\n    startClientRenderedSuspenseBoundary,\n  );\n  writeChunk(destination, clientRenderedSuspenseBoundaryError1);\n  if (errorDigest) {\n    writeChunk(destination, clientRenderedSuspenseBoundaryError1A);\n    writeChunk(destination, stringToChunk(escapeTextForBrowser(errorDigest)));\n    writeChunk(\n      destination,\n      clientRenderedSuspenseBoundaryErrorAttrInterstitial,\n    );\n  }\n  if (__DEV__) {\n    if (errorMesssage) {\n      writeChunk(destination, clientRenderedSuspenseBoundaryError1B);\n      writeChunk(\n        destination,\n        stringToChunk(escapeTextForBrowser(errorMesssage)),\n      );\n      writeChunk(\n        destination,\n        clientRenderedSuspenseBoundaryErrorAttrInterstitial,\n      );\n    }\n    if (errorComponentStack) {\n      writeChunk(destination, clientRenderedSuspenseBoundaryError1C);\n      writeChunk(\n        destination,\n        stringToChunk(escapeTextForBrowser(errorComponentStack)),\n      );\n      writeChunk(\n        destination,\n        clientRenderedSuspenseBoundaryErrorAttrInterstitial,\n      );\n    }\n  }\n  result = writeChunkAndReturn(\n    destination,\n    clientRenderedSuspenseBoundaryError2,\n  );\n  return result;\n}\nexport function writeEndCompletedSuspenseBoundary(\n  destination: Destination,\n  responseState: ResponseState,\n): boolean {\n  return writeChunkAndReturn(destination, endSuspenseBoundary);\n}\nexport function writeEndPendingSuspenseBoundary(\n  destination: Destination,\n  responseState: ResponseState,\n): boolean {\n  return writeChunkAndReturn(destination, endSuspenseBoundary);\n}\nexport function writeEndClientRenderedSuspenseBoundary(\n  destination: Destination,\n  responseState: ResponseState,\n): boolean {\n  return writeChunkAndReturn(destination, endSuspenseBoundary);\n}\n\nconst startSegmentHTML = stringToPrecomputedChunk('<div hidden id=\"');\nconst startSegmentHTML2 = stringToPrecomputedChunk('\">');\nconst endSegmentHTML = stringToPrecomputedChunk('</div>');\n\nconst startSegmentSVG = stringToPrecomputedChunk(\n  '<svg aria-hidden=\"true\" style=\"display:none\" id=\"',\n);\nconst startSegmentSVG2 = stringToPrecomputedChunk('\">');\nconst endSegmentSVG = stringToPrecomputedChunk('</svg>');\n\nconst startSegmentMathML = stringToPrecomputedChunk(\n  '<math aria-hidden=\"true\" style=\"display:none\" id=\"',\n);\nconst startSegmentMathML2 = stringToPrecomputedChunk('\">');\nconst endSegmentMathML = stringToPrecomputedChunk('</math>');\n\nconst startSegmentTable = stringToPrecomputedChunk('<table hidden id=\"');\nconst startSegmentTable2 = stringToPrecomputedChunk('\">');\nconst endSegmentTable = stringToPrecomputedChunk('</table>');\n\nconst startSegmentTableBody = stringToPrecomputedChunk(\n  '<table hidden><tbody id=\"',\n);\nconst startSegmentTableBody2 = stringToPrecomputedChunk('\">');\nconst endSegmentTableBody = stringToPrecomputedChunk('</tbody></table>');\n\nconst startSegmentTableRow = stringToPrecomputedChunk('<table hidden><tr id=\"');\nconst startSegmentTableRow2 = stringToPrecomputedChunk('\">');\nconst endSegmentTableRow = stringToPrecomputedChunk('</tr></table>');\n\nconst startSegmentColGroup = stringToPrecomputedChunk(\n  '<table hidden><colgroup id=\"',\n);\nconst startSegmentColGroup2 = stringToPrecomputedChunk('\">');\nconst endSegmentColGroup = stringToPrecomputedChunk('</colgroup></table>');\n\nexport function writeStartSegment(\n  destination: Destination,\n  responseState: ResponseState,\n  formatContext: FormatContext,\n  id: number,\n): boolean {\n  switch (formatContext.insertionMode) {\n    case ROOT_HTML_MODE:\n    case HTML_MODE: {\n      writeChunk(destination, startSegmentHTML);\n      writeChunk(destination, responseState.segmentPrefix);\n      writeChunk(destination, stringToChunk(id.toString(16)));\n      return writeChunkAndReturn(destination, startSegmentHTML2);\n    }\n    case SVG_MODE: {\n      writeChunk(destination, startSegmentSVG);\n      writeChunk(destination, responseState.segmentPrefix);\n      writeChunk(destination, stringToChunk(id.toString(16)));\n      return writeChunkAndReturn(destination, startSegmentSVG2);\n    }\n    case MATHML_MODE: {\n      writeChunk(destination, startSegmentMathML);\n      writeChunk(destination, responseState.segmentPrefix);\n      writeChunk(destination, stringToChunk(id.toString(16)));\n      return writeChunkAndReturn(destination, startSegmentMathML2);\n    }\n    case HTML_TABLE_MODE: {\n      writeChunk(destination, startSegmentTable);\n      writeChunk(destination, responseState.segmentPrefix);\n      writeChunk(destination, stringToChunk(id.toString(16)));\n      return writeChunkAndReturn(destination, startSegmentTable2);\n    }\n    // TODO: For the rest of these, there will be extra wrapper nodes that never\n    // get deleted from the document. We need to delete the table too as part\n    // of the injected scripts. They are invisible though so it's not too terrible\n    // and it's kind of an edge case to suspend in a table. Totally supported though.\n    case HTML_TABLE_BODY_MODE: {\n      writeChunk(destination, startSegmentTableBody);\n      writeChunk(destination, responseState.segmentPrefix);\n      writeChunk(destination, stringToChunk(id.toString(16)));\n      return writeChunkAndReturn(destination, startSegmentTableBody2);\n    }\n    case HTML_TABLE_ROW_MODE: {\n      writeChunk(destination, startSegmentTableRow);\n      writeChunk(destination, responseState.segmentPrefix);\n      writeChunk(destination, stringToChunk(id.toString(16)));\n      return writeChunkAndReturn(destination, startSegmentTableRow2);\n    }\n    case HTML_COLGROUP_MODE: {\n      writeChunk(destination, startSegmentColGroup);\n      writeChunk(destination, responseState.segmentPrefix);\n      writeChunk(destination, stringToChunk(id.toString(16)));\n      return writeChunkAndReturn(destination, startSegmentColGroup2);\n    }\n    default: {\n      throw new Error('Unknown insertion mode. This is a bug in React.');\n    }\n  }\n}\nexport function writeEndSegment(\n  destination: Destination,\n  formatContext: FormatContext,\n): boolean {\n  switch (formatContext.insertionMode) {\n    case ROOT_HTML_MODE:\n    case HTML_MODE: {\n      return writeChunkAndReturn(destination, endSegmentHTML);\n    }\n    case SVG_MODE: {\n      return writeChunkAndReturn(destination, endSegmentSVG);\n    }\n    case MATHML_MODE: {\n      return writeChunkAndReturn(destination, endSegmentMathML);\n    }\n    case HTML_TABLE_MODE: {\n      return writeChunkAndReturn(destination, endSegmentTable);\n    }\n    case HTML_TABLE_BODY_MODE: {\n      return writeChunkAndReturn(destination, endSegmentTableBody);\n    }\n    case HTML_TABLE_ROW_MODE: {\n      return writeChunkAndReturn(destination, endSegmentTableRow);\n    }\n    case HTML_COLGROUP_MODE: {\n      return writeChunkAndReturn(destination, endSegmentColGroup);\n    }\n    default: {\n      throw new Error('Unknown insertion mode. This is a bug in React.');\n    }\n  }\n}\n\n// Instruction Set\n\n// The following code is the source scripts that we then minify and inline below,\n// with renamed function names that we hope don't collide:\n\n// const COMMENT_NODE = 8;\n// const SUSPENSE_START_DATA = '$';\n// const SUSPENSE_END_DATA = '/$';\n// const SUSPENSE_PENDING_START_DATA = '$?';\n// const SUSPENSE_FALLBACK_START_DATA = '$!';\n//\n// function clientRenderBoundary(suspenseBoundaryID, errorDigest, errorMsg, errorComponentStack) {\n//   // Find the fallback's first element.\n//   const suspenseIdNode = document.getElementById(suspenseBoundaryID);\n//   if (!suspenseIdNode) {\n//     // The user must have already navigated away from this tree.\n//     // E.g. because the parent was hydrated.\n//     return;\n//   }\n//   // Find the boundary around the fallback. This is always the previous node.\n//   const suspenseNode = suspenseIdNode.previousSibling;\n//   // Tag it to be client rendered.\n//   suspenseNode.data = SUSPENSE_FALLBACK_START_DATA;\n//   // assign error metadata to first sibling\n//   let dataset = suspenseIdNode.dataset;\n//   if (errorDigest) dataset.dgst = errorDigest;\n//   if (errorMsg) dataset.msg = errorMsg;\n//   if (errorComponentStack) dataset.stck = errorComponentStack;\n//   // Tell React to retry it if the parent already hydrated.\n//   if (suspenseNode._reactRetry) {\n//     suspenseNode._reactRetry();\n//   }\n// }\n//\n// function completeBoundary(suspenseBoundaryID, contentID) {\n//   // Find the fallback's first element.\n//   const suspenseIdNode = document.getElementById(suspenseBoundaryID);\n//   const contentNode = document.getElementById(contentID);\n//   // We'll detach the content node so that regardless of what happens next we don't leave in the tree.\n//   // This might also help by not causing recalcing each time we move a child from here to the target.\n//   contentNode.parentNode.removeChild(contentNode);\n//   if (!suspenseIdNode) {\n//     // The user must have already navigated away from this tree.\n//     // E.g. because the parent was hydrated. That's fine there's nothing to do\n//     // but we have to make sure that we already deleted the container node.\n//     return;\n//   }\n//   // Find the boundary around the fallback. This is always the previous node.\n//   const suspenseNode = suspenseIdNode.previousSibling;\n//\n//   // Clear all the existing children. This is complicated because\n//   // there can be embedded Suspense boundaries in the fallback.\n//   // This is similar to clearSuspenseBoundary in ReactDOMHostConfig.\n//   // TODO: We could avoid this if we never emitted suspense boundaries in fallback trees.\n//   // They never hydrate anyway. However, currently we support incrementally loading the fallback.\n//   const parentInstance = suspenseNode.parentNode;\n//   let node = suspenseNode.nextSibling;\n//   let depth = 0;\n//   do {\n//     if (node && node.nodeType === COMMENT_NODE) {\n//       const data = node.data;\n//       if (data === SUSPENSE_END_DATA) {\n//         if (depth === 0) {\n//           break;\n//         } else {\n//           depth--;\n//         }\n//       } else if (\n//         data === SUSPENSE_START_DATA ||\n//         data === SUSPENSE_PENDING_START_DATA ||\n//         data === SUSPENSE_FALLBACK_START_DATA\n//       ) {\n//         depth++;\n//       }\n//     }\n//\n//     const nextNode = node.nextSibling;\n//     parentInstance.removeChild(node);\n//     node = nextNode;\n//   } while (node);\n//\n//   const endOfBoundary = node;\n//\n//   // Insert all the children from the contentNode between the start and end of suspense boundary.\n//   while (contentNode.firstChild) {\n//     parentInstance.insertBefore(contentNode.firstChild, endOfBoundary);\n//   }\n\n//   suspenseNode.data = SUSPENSE_START_DATA;\n//   if (suspenseNode._reactRetry) {\n//     suspenseNode._reactRetry();\n//   }\n// }\n//\n// function completeSegment(containerID, placeholderID) {\n//   const segmentContainer = document.getElementById(containerID);\n//   const placeholderNode = document.getElementById(placeholderID);\n//   // We always expect both nodes to exist here because, while we might\n//   // have navigated away from the main tree, we still expect the detached\n//   // tree to exist.\n//   segmentContainer.parentNode.removeChild(segmentContainer);\n//   while (segmentContainer.firstChild) {\n//     placeholderNode.parentNode.insertBefore(\n//       segmentContainer.firstChild,\n//       placeholderNode,\n//     );\n//   }\n//   placeholderNode.parentNode.removeChild(placeholderNode);\n// }\n\nconst completeSegmentFunction =\n  'function $RS(a,b){a=document.getElementById(a);b=document.getElementById(b);for(a.parentNode.removeChild(a);a.firstChild;)b.parentNode.insertBefore(a.firstChild,b);b.parentNode.removeChild(b)}';\nconst completeBoundaryFunction =\n  'function $RC(a,b){a=document.getElementById(a);b=document.getElementById(b);b.parentNode.removeChild(b);if(a){a=a.previousSibling;var f=a.parentNode,c=a.nextSibling,e=0;do{if(c&&8===c.nodeType){var d=c.data;if(\"/$\"===d)if(0===e)break;else e--;else\"$\"!==d&&\"$?\"!==d&&\"$!\"!==d||e++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;b.firstChild;)f.insertBefore(b.firstChild,c);a.data=\"$\";a._reactRetry&&a._reactRetry()}}';\nconst clientRenderFunction =\n  'function $RX(b,c,d,e){var a=document.getElementById(b);a&&(b=a.previousSibling,b.data=\"$!\",a=a.dataset,c&&(a.dgst=c),d&&(a.msg=d),e&&(a.stck=e),b._reactRetry&&b._reactRetry())}';\n\nconst completeSegmentScript1Full = stringToPrecomputedChunk(\n  completeSegmentFunction + ';$RS(\"',\n);\nconst completeSegmentScript1Partial = stringToPrecomputedChunk('$RS(\"');\nconst completeSegmentScript2 = stringToPrecomputedChunk('\",\"');\nconst completeSegmentScript3 = stringToPrecomputedChunk('\")</script>');\n\nexport function writeCompletedSegmentInstruction(\n  destination: Destination,\n  responseState: ResponseState,\n  contentSegmentID: number,\n): boolean {\n  writeChunk(destination, responseState.startInlineScript);\n  if (!responseState.sentCompleteSegmentFunction) {\n    // The first time we write this, we'll need to include the full implementation.\n    responseState.sentCompleteSegmentFunction = true;\n    writeChunk(destination, completeSegmentScript1Full);\n  } else {\n    // Future calls can just reuse the same function.\n    writeChunk(destination, completeSegmentScript1Partial);\n  }\n  writeChunk(destination, responseState.segmentPrefix);\n  const formattedID = stringToChunk(contentSegmentID.toString(16));\n  writeChunk(destination, formattedID);\n  writeChunk(destination, completeSegmentScript2);\n  writeChunk(destination, responseState.placeholderPrefix);\n  writeChunk(destination, formattedID);\n  return writeChunkAndReturn(destination, completeSegmentScript3);\n}\n\nconst completeBoundaryScript1Full = stringToPrecomputedChunk(\n  completeBoundaryFunction + ';$RC(\"',\n);\nconst completeBoundaryScript1Partial = stringToPrecomputedChunk('$RC(\"');\nconst completeBoundaryScript2 = stringToPrecomputedChunk('\",\"');\nconst completeBoundaryScript3 = stringToPrecomputedChunk('\")</script>');\n\nexport function writeCompletedBoundaryInstruction(\n  destination: Destination,\n  responseState: ResponseState,\n  boundaryID: SuspenseBoundaryID,\n  contentSegmentID: number,\n): boolean {\n  writeChunk(destination, responseState.startInlineScript);\n  if (!responseState.sentCompleteBoundaryFunction) {\n    // The first time we write this, we'll need to include the full implementation.\n    responseState.sentCompleteBoundaryFunction = true;\n    writeChunk(destination, completeBoundaryScript1Full);\n  } else {\n    // Future calls can just reuse the same function.\n    writeChunk(destination, completeBoundaryScript1Partial);\n  }\n\n  if (boundaryID === null) {\n    throw new Error(\n      'An ID must have been assigned before we can complete the boundary.',\n    );\n  }\n\n  const formattedContentID = stringToChunk(contentSegmentID.toString(16));\n  writeChunk(destination, boundaryID);\n  writeChunk(destination, completeBoundaryScript2);\n  writeChunk(destination, responseState.segmentPrefix);\n  writeChunk(destination, formattedContentID);\n  return writeChunkAndReturn(destination, completeBoundaryScript3);\n}\n\nconst clientRenderScript1Full = stringToPrecomputedChunk(\n  clientRenderFunction + ';$RX(\"',\n);\nconst clientRenderScript1Partial = stringToPrecomputedChunk('$RX(\"');\nconst clientRenderScript1A = stringToPrecomputedChunk('\"');\nconst clientRenderScript2 = stringToPrecomputedChunk(')</script>');\nconst clientRenderErrorScriptArgInterstitial = stringToPrecomputedChunk(',');\n\nexport function writeClientRenderBoundaryInstruction(\n  destination: Destination,\n  responseState: ResponseState,\n  boundaryID: SuspenseBoundaryID,\n  errorDigest: ?string,\n  errorMessage?: string,\n  errorComponentStack?: string,\n): boolean {\n  writeChunk(destination, responseState.startInlineScript);\n  if (!responseState.sentClientRenderFunction) {\n    // The first time we write this, we'll need to include the full implementation.\n    responseState.sentClientRenderFunction = true;\n    writeChunk(destination, clientRenderScript1Full);\n  } else {\n    // Future calls can just reuse the same function.\n    writeChunk(destination, clientRenderScript1Partial);\n  }\n\n  if (boundaryID === null) {\n    throw new Error(\n      'An ID must have been assigned before we can complete the boundary.',\n    );\n  }\n\n  writeChunk(destination, boundaryID);\n  writeChunk(destination, clientRenderScript1A);\n  if (errorDigest || errorMessage || errorComponentStack) {\n    writeChunk(destination, clientRenderErrorScriptArgInterstitial);\n    writeChunk(\n      destination,\n      stringToChunk(escapeJSStringsForInstructionScripts(errorDigest || '')),\n    );\n  }\n  if (errorMessage || errorComponentStack) {\n    writeChunk(destination, clientRenderErrorScriptArgInterstitial);\n    writeChunk(\n      destination,\n      stringToChunk(escapeJSStringsForInstructionScripts(errorMessage || '')),\n    );\n  }\n  if (errorComponentStack) {\n    writeChunk(destination, clientRenderErrorScriptArgInterstitial);\n    writeChunk(\n      destination,\n      stringToChunk(escapeJSStringsForInstructionScripts(errorComponentStack)),\n    );\n  }\n  return writeChunkAndReturn(destination, clientRenderScript2);\n}\n\nconst regexForJSStringsInScripts = /[<\\u2028\\u2029]/g;\nfunction escapeJSStringsForInstructionScripts(input: string): string {\n  const escaped = JSON.stringify(input);\n  return escaped.replace(regexForJSStringsInScripts, match => {\n    switch (match) {\n      // santizing breaking out of strings and script tags\n      case '<':\n        return '\\\\u003c';\n      case '\\u2028':\n        return '\\\\u2028';\n      case '\\u2029':\n        return '\\\\u2029';\n      default: {\n        // eslint-disable-next-line react-internal/prod-error-codes\n        throw new Error(\n          'escapeJSStringsForInstructionScripts encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React',\n        );\n      }\n    }\n  });\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {\n  ReactServerContext,\n  ServerContextJSONValue,\n} from 'shared/ReactTypes';\n\nimport {REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED} from 'shared/ReactSymbols';\nimport {isPrimaryRenderer} from './ReactServerFormatConfig';\n\nlet rendererSigil;\nif (__DEV__) {\n  // Use this to detect multiple renderers using the same context\n  rendererSigil = {};\n}\n\n// Used to store the parent path of all context overrides in a shared linked list.\n// Forming a reverse tree.\ntype ContextNode<T: ServerContextJSONValue> = {\n  parent: null | ContextNode<any>,\n  depth: number, // Short hand to compute the depth of the tree at this node.\n  context: ReactServerContext<T>,\n  parentValue: T,\n  value: T,\n};\n\n// The structure of a context snapshot is an implementation of this file.\n// Currently, it's implemented as tracking the current active node.\nexport opaque type ContextSnapshot = null | ContextNode<any>;\n\nexport const rootContextSnapshot: ContextSnapshot = null;\n\n// We assume that this runtime owns the \"current\" field on all ReactContext instances.\n// This global (actually thread local) state represents what state all those \"current\",\n// fields are currently in.\nlet currentActiveSnapshot: ContextSnapshot = null;\n\nfunction popNode(prev: ContextNode<any>): void {\n  if (isPrimaryRenderer) {\n    prev.context._currentValue = prev.parentValue;\n  } else {\n    prev.context._currentValue2 = prev.parentValue;\n  }\n}\n\nfunction pushNode(next: ContextNode<any>): void {\n  if (isPrimaryRenderer) {\n    next.context._currentValue = next.value;\n  } else {\n    next.context._currentValue2 = next.value;\n  }\n}\n\nfunction popToNearestCommonAncestor(\n  prev: ContextNode<any>,\n  next: ContextNode<any>,\n): void {\n  if (prev === next) {\n    // We've found a shared ancestor. We don't need to pop nor reapply this one or anything above.\n  } else {\n    popNode(prev);\n    const parentPrev = prev.parent;\n    const parentNext = next.parent;\n    if (parentPrev === null) {\n      if (parentNext !== null) {\n        throw new Error(\n          'The stacks must reach the root at the same time. This is a bug in React.',\n        );\n      }\n    } else {\n      if (parentNext === null) {\n        throw new Error(\n          'The stacks must reach the root at the same time. This is a bug in React.',\n        );\n      }\n\n      popToNearestCommonAncestor(parentPrev, parentNext);\n      // On the way back, we push the new ones that weren't common.\n      pushNode(next);\n    }\n  }\n}\n\nfunction popAllPrevious(prev: ContextNode<any>): void {\n  popNode(prev);\n  const parentPrev = prev.parent;\n  if (parentPrev !== null) {\n    popAllPrevious(parentPrev);\n  }\n}\n\nfunction pushAllNext(next: ContextNode<any>): void {\n  const parentNext = next.parent;\n  if (parentNext !== null) {\n    pushAllNext(parentNext);\n  }\n  pushNode(next);\n}\n\nfunction popPreviousToCommonLevel(\n  prev: ContextNode<any>,\n  next: ContextNode<any>,\n): void {\n  popNode(prev);\n  const parentPrev = prev.parent;\n\n  if (parentPrev === null) {\n    throw new Error(\n      'The depth must equal at least at zero before reaching the root. This is a bug in React.',\n    );\n  }\n\n  if (parentPrev.depth === next.depth) {\n    // We found the same level. Now we just need to find a shared ancestor.\n    popToNearestCommonAncestor(parentPrev, next);\n  } else {\n    // We must still be deeper.\n    popPreviousToCommonLevel(parentPrev, next);\n  }\n}\n\nfunction popNextToCommonLevel(\n  prev: ContextNode<any>,\n  next: ContextNode<any>,\n): void {\n  const parentNext = next.parent;\n\n  if (parentNext === null) {\n    throw new Error(\n      'The depth must equal at least at zero before reaching the root. This is a bug in React.',\n    );\n  }\n\n  if (prev.depth === parentNext.depth) {\n    // We found the same level. Now we just need to find a shared ancestor.\n    popToNearestCommonAncestor(prev, parentNext);\n  } else {\n    // We must still be deeper.\n    popNextToCommonLevel(prev, parentNext);\n  }\n  pushNode(next);\n}\n\n// Perform context switching to the new snapshot.\n// To make it cheap to read many contexts, while not suspending, we make the switch eagerly by\n// updating all the context's current values. That way reads, always just read the current value.\n// At the cost of updating contexts even if they're never read by this subtree.\nexport function switchContext(newSnapshot: ContextSnapshot): void {\n  // The basic algorithm we need to do is to pop back any contexts that are no longer on the stack.\n  // We also need to update any new contexts that are now on the stack with the deepest value.\n  // The easiest way to update new contexts is to just reapply them in reverse order from the\n  // perspective of the backpointers. To avoid allocating a lot when switching, we use the stack\n  // for that. Therefore this algorithm is recursive.\n  // 1) First we pop which ever snapshot tree was deepest. Popping old contexts as we go.\n  // 2) Then we find the nearest common ancestor from there. Popping old contexts as we go.\n  // 3) Then we reapply new contexts on the way back up the stack.\n  const prev = currentActiveSnapshot;\n  const next = newSnapshot;\n  if (prev !== next) {\n    if (prev === null) {\n      // $FlowFixMe: This has to be non-null since it's not equal to prev.\n      pushAllNext(next);\n    } else if (next === null) {\n      popAllPrevious(prev);\n    } else if (prev.depth === next.depth) {\n      popToNearestCommonAncestor(prev, next);\n    } else if (prev.depth > next.depth) {\n      popPreviousToCommonLevel(prev, next);\n    } else {\n      popNextToCommonLevel(prev, next);\n    }\n    currentActiveSnapshot = next;\n  }\n}\n\nexport function pushProvider<T: ServerContextJSONValue>(\n  context: ReactServerContext<T>,\n  nextValue: T,\n): ContextSnapshot {\n  let prevValue;\n  if (isPrimaryRenderer) {\n    prevValue = context._currentValue;\n    context._currentValue = nextValue;\n    if (__DEV__) {\n      if (\n        context._currentRenderer !== undefined &&\n        context._currentRenderer !== null &&\n        context._currentRenderer !== rendererSigil\n      ) {\n        console.error(\n          'Detected multiple renderers concurrently rendering the ' +\n            'same context provider. This is currently unsupported.',\n        );\n      }\n      context._currentRenderer = rendererSigil;\n    }\n  } else {\n    prevValue = context._currentValue2;\n    context._currentValue2 = nextValue;\n    if (__DEV__) {\n      if (\n        context._currentRenderer2 !== undefined &&\n        context._currentRenderer2 !== null &&\n        context._currentRenderer2 !== rendererSigil\n      ) {\n        console.error(\n          'Detected multiple renderers concurrently rendering the ' +\n            'same context provider. This is currently unsupported.',\n        );\n      }\n      context._currentRenderer2 = rendererSigil;\n    }\n  }\n  const prevNode = currentActiveSnapshot;\n  const newNode: ContextNode<T> = {\n    parent: prevNode,\n    depth: prevNode === null ? 0 : prevNode.depth + 1,\n    context: context,\n    parentValue: prevValue,\n    value: nextValue,\n  };\n  currentActiveSnapshot = newNode;\n  return newNode;\n}\n\nexport function popProvider(): ContextSnapshot {\n  const prevSnapshot = currentActiveSnapshot;\n\n  if (prevSnapshot === null) {\n    throw new Error(\n      'Tried to pop a Context at the root of the app. This is a bug in React.',\n    );\n  }\n\n  if (isPrimaryRenderer) {\n    const value = prevSnapshot.parentValue;\n    if (value === REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED) {\n      prevSnapshot.context._currentValue = prevSnapshot.context._defaultValue;\n    } else {\n      prevSnapshot.context._currentValue = value;\n    }\n  } else {\n    const value = prevSnapshot.parentValue;\n    if (value === REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED) {\n      prevSnapshot.context._currentValue2 = prevSnapshot.context._defaultValue;\n    } else {\n      prevSnapshot.context._currentValue2 = value;\n    }\n  }\n  return (currentActiveSnapshot = prevSnapshot.parent);\n}\n\nexport function getActiveContext(): ContextSnapshot {\n  return currentActiveSnapshot;\n}\n\nexport function readContext<T>(context: ReactServerContext<T>): T {\n  const value = isPrimaryRenderer\n    ? context._currentValue\n    : context._currentValue2;\n  return value;\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {Dispatcher as DispatcherType} from 'react-reconciler/src/ReactInternalTypes';\nimport type {Request} from './ReactFlightServer';\nimport type {ReactServerContext} from 'shared/ReactTypes';\nimport {REACT_SERVER_CONTEXT_TYPE} from 'shared/ReactSymbols';\nimport {readContext as readContextImpl} from './ReactFlightNewContext';\n\nlet currentRequest = null;\n\nexport function prepareToUseHooksForRequest(request: Request) {\n  currentRequest = request;\n}\n\nexport function resetHooksForRequest() {\n  currentRequest = null;\n}\n\nfunction readContext<T>(context: ReactServerContext<T>): T {\n  if (__DEV__) {\n    if (context.$$typeof !== REACT_SERVER_CONTEXT_TYPE) {\n      console.error('Only ServerContext is supported in Flight');\n    }\n    if (currentCache === null) {\n      console.error(\n        'Context can only be read while React is rendering. ' +\n          'In classes, you can read it in the render method or getDerivedStateFromProps. ' +\n          'In function components, you can read it directly in the function body, but not ' +\n          'inside Hooks like useReducer() or useMemo().',\n      );\n    }\n  }\n  return readContextImpl(context);\n}\n\nexport const Dispatcher: DispatcherType = {\n  useMemo<T>(nextCreate: () => T): T {\n    return nextCreate();\n  },\n  useCallback<T>(callback: T): T {\n    return callback;\n  },\n  useDebugValue(): void {},\n  useDeferredValue: (unsupportedHook: any),\n  useTransition: (unsupportedHook: any),\n  getCacheForType<T>(resourceType: () => T): T {\n    if (!currentCache) {\n      throw new Error('Reading the cache is only supported while rendering.');\n    }\n\n    let entry: T | void = (currentCache.get(resourceType): any);\n    if (entry === undefined) {\n      entry = resourceType();\n      // TODO: Warn if undefined?\n      currentCache.set(resourceType, entry);\n    }\n    return entry;\n  },\n  readContext,\n  useContext: readContext,\n  useReducer: (unsupportedHook: any),\n  useRef: (unsupportedHook: any),\n  useState: (unsupportedHook: any),\n  useInsertionEffect: (unsupportedHook: any),\n  useLayoutEffect: (unsupportedHook: any),\n  useImperativeHandle: (unsupportedHook: any),\n  useEffect: (unsupportedHook: any),\n  useId,\n  useMutableSource: (unsupportedHook: any),\n  useSyncExternalStore: (unsupportedHook: any),\n  useCacheRefresh(): <T>(?() => T, ?T) => void {\n    return unsupportedRefresh;\n  },\n};\n\nfunction unsupportedHook(): void {\n  throw new Error('This Hook is not supported in Server Components.');\n}\n\nfunction unsupportedRefresh(): void {\n  if (!currentCache) {\n    throw new Error(\n      'Refreshing the cache is not supported in Server Components.',\n    );\n  }\n}\n\nlet currentCache: Map<Function, mixed> | null = null;\n\nexport function setCurrentCache(cache: Map<Function, mixed> | null) {\n  currentCache = cache;\n  return currentCache;\n}\n\nexport function getCurrentCache() {\n  return currentCache;\n}\n\nfunction useId(): string {\n  if (currentRequest === null) {\n    throw new Error('useId can only be used while React is rendering');\n  }\n  const id = currentRequest.identifierCount++;\n  // use 'S' for Flight components to distinguish from 'R' and 'r' in Fizz/Client\n  return ':' + currentRequest.identifierPrefix + 'S' + id.toString(32) + ':';\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\n\nconst ReactSharedInternals =\n  React.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n\nexport default ReactSharedInternals;\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport {REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED} from 'shared/ReactSymbols';\nimport ReactSharedInternals from 'shared/ReactSharedInternals';\nimport {createServerContext} from 'react';\n\nconst ContextRegistry = ReactSharedInternals.ContextRegistry;\n\nexport function getOrCreateServerContext(globalName: string) {\n  if (!ContextRegistry[globalName]) {\n    ContextRegistry[globalName] = createServerContext(\n      globalName,\n      REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED,\n    );\n  }\n  return ContextRegistry[globalName];\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {\n  Destination,\n  Chunk,\n  BundlerConfig,\n  ModuleMetaData,\n  ModuleReference,\n  ModuleKey,\n} from './ReactFlightServerConfig';\nimport type {ContextSnapshot} from './ReactFlightNewContext';\nimport type {\n  ReactProviderType,\n  ServerContextJSONValue,\n} from 'shared/ReactTypes';\n\nimport {\n  scheduleWork,\n  beginWriting,\n  writeChunkAndReturn,\n  completeWriting,\n  flushBuffered,\n  close,\n  closeWithError,\n  processModelChunk,\n  processModuleChunk,\n  processProviderChunk,\n  processSymbolChunk,\n  processErrorChunk,\n  resolveModuleMetaData,\n  getModuleKey,\n  isModuleReference,\n} from './ReactFlightServerConfig';\n\nimport {\n  Dispatcher,\n  getCurrentCache,\n  prepareToUseHooksForRequest,\n  resetHooksForRequest,\n  setCurrentCache,\n} from './ReactFlightHooks';\nimport {\n  pushProvider,\n  popProvider,\n  switchContext,\n  getActiveContext,\n  rootContextSnapshot,\n} from './ReactFlightNewContext';\n\nimport {\n  REACT_ELEMENT_TYPE,\n  REACT_FORWARD_REF_TYPE,\n  REACT_FRAGMENT_TYPE,\n  REACT_LAZY_TYPE,\n  REACT_MEMO_TYPE,\n  REACT_PROVIDER_TYPE,\n} from 'shared/ReactSymbols';\n\nimport {getOrCreateServerContext} from 'shared/ReactServerContextRegistry';\nimport ReactSharedInternals from 'shared/ReactSharedInternals';\nimport isArray from 'shared/isArray';\n\ntype ReactJSONValue =\n  | string\n  | boolean\n  | number\n  | null\n  | $ReadOnlyArray<ReactJSONValue>\n  | ReactModelObject;\n\nexport type ReactModel =\n  | React$Element<any>\n  | string\n  | boolean\n  | number\n  | null\n  | Iterable<ReactModel>\n  | ReactModelObject;\n\ntype ReactModelObject = {+[key: string]: ReactModel};\n\ntype Segment = {\n  id: number,\n  model: ReactModel,\n  ping: () => void,\n  context: ContextSnapshot,\n};\n\nexport type Request = {\n  status: 0 | 1 | 2,\n  fatalError: mixed,\n  destination: null | Destination,\n  bundlerConfig: BundlerConfig,\n  cache: Map<Function, mixed>,\n  nextChunkId: number,\n  pendingChunks: number,\n  pingedSegments: Array<Segment>,\n  completedModuleChunks: Array<Chunk>,\n  completedJSONChunks: Array<Chunk>,\n  completedErrorChunks: Array<Chunk>,\n  writtenSymbols: Map<Symbol, number>,\n  writtenModules: Map<ModuleKey, number>,\n  writtenProviders: Map<string, number>,\n  identifierPrefix: string,\n  identifierCount: number,\n  onError: (error: mixed) => void,\n  toJSON: (key: string, value: ReactModel) => ReactJSONValue,\n};\n\nconst ReactCurrentDispatcher = ReactSharedInternals.ReactCurrentDispatcher;\n\nfunction defaultErrorHandler(error: mixed) {\n  console['error'](error);\n  // Don't transform to our wrapper\n}\n\nconst OPEN = 0;\nconst CLOSING = 1;\nconst CLOSED = 2;\n\nexport function createRequest(\n  model: ReactModel,\n  bundlerConfig: BundlerConfig,\n  onError: void | ((error: mixed) => void),\n  context?: Array<[string, ServerContextJSONValue]>,\n  identifierPrefix?: string,\n): Request {\n  const pingedSegments = [];\n  const request = {\n    status: OPEN,\n    fatalError: null,\n    destination: null,\n    bundlerConfig,\n    cache: new Map(),\n    nextChunkId: 0,\n    pendingChunks: 0,\n    pingedSegments: pingedSegments,\n    completedModuleChunks: [],\n    completedJSONChunks: [],\n    completedErrorChunks: [],\n    writtenSymbols: new Map(),\n    writtenModules: new Map(),\n    writtenProviders: new Map(),\n    identifierPrefix: identifierPrefix || '',\n    identifierCount: 1,\n    onError: onError === undefined ? defaultErrorHandler : onError,\n    toJSON: function(key: string, value: ReactModel): ReactJSONValue {\n      return resolveModelToJSON(request, this, key, value);\n    },\n  };\n  request.pendingChunks++;\n  const rootContext = createRootContext(context);\n  const rootSegment = createSegment(request, model, rootContext);\n  pingedSegments.push(rootSegment);\n  return request;\n}\n\nfunction createRootContext(\n  reqContext?: Array<[string, ServerContextJSONValue]>,\n) {\n  return importServerContexts(reqContext);\n}\n\nconst POP = {};\n\nfunction attemptResolveElement(\n  type: any,\n  key: null | React$Key,\n  ref: mixed,\n  props: any,\n): ReactModel {\n  if (ref !== null && ref !== undefined) {\n    // When the ref moves to the regular props object this will implicitly\n    // throw for functions. We could probably relax it to a DEV warning for other\n    // cases.\n    throw new Error(\n      'Refs cannot be used in server components, nor passed to client components.',\n    );\n  }\n  if (typeof type === 'function') {\n    // This is a server-side component.\n    return type(props);\n  } else if (typeof type === 'string') {\n    // This is a host element. E.g. HTML.\n    return [REACT_ELEMENT_TYPE, type, key, props];\n  } else if (typeof type === 'symbol') {\n    if (type === REACT_FRAGMENT_TYPE) {\n      // For key-less fragments, we add a small optimization to avoid serializing\n      // it as a wrapper.\n      // TODO: If a key is specified, we should propagate its key to any children.\n      // Same as if a server component has a key.\n      return props.children;\n    }\n    // This might be a built-in React component. We'll let the client decide.\n    // Any built-in works as long as its props are serializable.\n    return [REACT_ELEMENT_TYPE, type, key, props];\n  } else if (type != null && typeof type === 'object') {\n    if (isModuleReference(type)) {\n      // This is a reference to a client component.\n      return [REACT_ELEMENT_TYPE, type, key, props];\n    }\n    switch (type.$$typeof) {\n      case REACT_LAZY_TYPE: {\n        const payload = type._payload;\n        const init = type._init;\n        const wrappedType = init(payload);\n        return attemptResolveElement(wrappedType, key, ref, props);\n      }\n      case REACT_FORWARD_REF_TYPE: {\n        const render = type.render;\n        return render(props, undefined);\n      }\n      case REACT_MEMO_TYPE: {\n        return attemptResolveElement(type.type, key, ref, props);\n      }\n      case REACT_PROVIDER_TYPE: {\n        pushProvider(type._context, props.value);\n        if (__DEV__) {\n          const extraKeys = Object.keys(props).filter(value => {\n            if (value === 'children' || value === 'value') {\n              return false;\n            }\n            return true;\n          });\n          if (extraKeys.length !== 0) {\n            console.error(\n              'ServerContext can only have a value prop and children. Found: %s',\n              JSON.stringify(extraKeys),\n            );\n          }\n        }\n        return [\n          REACT_ELEMENT_TYPE,\n          type,\n          key,\n          // Rely on __popProvider being serialized last to pop the provider.\n          {value: props.value, children: props.children, __pop: POP},\n        ];\n      }\n    }\n  }\n  throw new Error(\n    `Unsupported server component type: ${describeValueForErrorMessage(type)}`,\n  );\n}\n\nfunction pingSegment(request: Request, segment: Segment): void {\n  const pingedSegments = request.pingedSegments;\n  pingedSegments.push(segment);\n  if (pingedSegments.length === 1) {\n    scheduleWork(() => performWork(request));\n  }\n}\n\nfunction createSegment(\n  request: Request,\n  model: ReactModel,\n  context: ContextSnapshot,\n): Segment {\n  const id = request.nextChunkId++;\n  const segment = {\n    id,\n    model,\n    context,\n    ping: () => pingSegment(request, segment),\n  };\n  return segment;\n}\n\nfunction serializeByValueID(id: number): string {\n  return '$' + id.toString(16);\n}\n\nfunction serializeByRefID(id: number): string {\n  return '@' + id.toString(16);\n}\n\nfunction escapeStringValue(value: string): string {\n  if (value[0] === '$' || value[0] === '@') {\n    // We need to escape $ or @ prefixed strings since we use those to encode\n    // references to IDs and as special symbol values.\n    return '$' + value;\n  } else {\n    return value;\n  }\n}\n\nfunction isObjectPrototype(object): boolean {\n  if (!object) {\n    return false;\n  }\n  const ObjectPrototype = Object.prototype;\n  if (object === ObjectPrototype) {\n    return true;\n  }\n  // It might be an object from a different Realm which is\n  // still just a plain simple object.\n  if (Object.getPrototypeOf(object)) {\n    return false;\n  }\n  const names = Object.getOwnPropertyNames(object);\n  for (let i = 0; i < names.length; i++) {\n    if (!(names[i] in ObjectPrototype)) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction isSimpleObject(object): boolean {\n  if (!isObjectPrototype(Object.getPrototypeOf(object))) {\n    return false;\n  }\n  const names = Object.getOwnPropertyNames(object);\n  for (let i = 0; i < names.length; i++) {\n    const descriptor = Object.getOwnPropertyDescriptor(object, names[i]);\n    if (!descriptor) {\n      return false;\n    }\n    if (!descriptor.enumerable) {\n      if (\n        (names[i] === 'key' || names[i] === 'ref') &&\n        typeof descriptor.get === 'function'\n      ) {\n        // React adds key and ref getters to props objects to issue warnings.\n        // Those getters will not be transferred to the client, but that's ok,\n        // so we'll special case them.\n        continue;\n      }\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction objectName(object): string {\n  const name = Object.prototype.toString.call(object);\n  return name.replace(/^\\[object (.*)\\]$/, function(m, p0) {\n    return p0;\n  });\n}\n\nfunction describeKeyForErrorMessage(key: string): string {\n  const encodedKey = JSON.stringify(key);\n  return '\"' + key + '\"' === encodedKey ? key : encodedKey;\n}\n\nfunction describeValueForErrorMessage(value: ReactModel): string {\n  switch (typeof value) {\n    case 'string': {\n      return JSON.stringify(\n        value.length <= 10 ? value : value.substr(0, 10) + '...',\n      );\n    }\n    case 'object': {\n      if (isArray(value)) {\n        return '[...]';\n      }\n      const name = objectName(value);\n      if (name === 'Object') {\n        return '{...}';\n      }\n      return name;\n    }\n    case 'function':\n      return 'function';\n    default:\n      // eslint-disable-next-line react-internal/safe-string-coercion\n      return String(value);\n  }\n}\n\nfunction describeObjectForErrorMessage(\n  objectOrArray:\n    | {+[key: string | number]: ReactModel}\n    | $ReadOnlyArray<ReactModel>,\n  expandedName?: string,\n): string {\n  if (isArray(objectOrArray)) {\n    let str = '[';\n    const array: $ReadOnlyArray<ReactModel> = objectOrArray;\n    for (let i = 0; i < array.length; i++) {\n      if (i > 0) {\n        str += ', ';\n      }\n      if (i > 6) {\n        str += '...';\n        break;\n      }\n      const value = array[i];\n      if (\n        '' + i === expandedName &&\n        typeof value === 'object' &&\n        value !== null\n      ) {\n        str += describeObjectForErrorMessage(value);\n      } else {\n        str += describeValueForErrorMessage(value);\n      }\n    }\n    str += ']';\n    return str;\n  } else {\n    let str = '{';\n    const object: {+[key: string | number]: ReactModel} = objectOrArray;\n    const names = Object.keys(object);\n    for (let i = 0; i < names.length; i++) {\n      if (i > 0) {\n        str += ', ';\n      }\n      if (i > 6) {\n        str += '...';\n        break;\n      }\n      const name = names[i];\n      str += describeKeyForErrorMessage(name) + ': ';\n      const value = object[name];\n      if (\n        name === expandedName &&\n        typeof value === 'object' &&\n        value !== null\n      ) {\n        str += describeObjectForErrorMessage(value);\n      } else {\n        str += describeValueForErrorMessage(value);\n      }\n    }\n    str += '}';\n    return str;\n  }\n}\n\nlet insideContextProps = null;\nlet isInsideContextValue = false;\n\nexport function resolveModelToJSON(\n  request: Request,\n  parent: {+[key: string | number]: ReactModel} | $ReadOnlyArray<ReactModel>,\n  key: string,\n  value: ReactModel,\n): ReactJSONValue {\n  if (__DEV__) {\n    // $FlowFixMe\n    const originalValue = parent[key];\n    if (typeof originalValue === 'object' && originalValue !== value) {\n      console.error(\n        'Only plain objects can be passed to client components from server components. ' +\n          'Objects with toJSON methods are not supported. Convert it manually ' +\n          'to a simple value before passing it to props. ' +\n          'Remove %s from these props: %s',\n        describeKeyForErrorMessage(key),\n        describeObjectForErrorMessage(parent),\n      );\n    }\n  }\n\n  // Special Symbols\n  switch (value) {\n    case REACT_ELEMENT_TYPE:\n      return '$';\n  }\n\n  if (__DEV__) {\n    if (\n      parent[0] === REACT_ELEMENT_TYPE &&\n      parent[1] &&\n      parent[1].$$typeof === REACT_PROVIDER_TYPE &&\n      key === '3'\n    ) {\n      insideContextProps = value;\n    } else if (insideContextProps === parent && key === 'value') {\n      isInsideContextValue = true;\n    } else if (insideContextProps === parent && key === 'children') {\n      isInsideContextValue = false;\n    }\n  }\n\n  // Resolve server components.\n  while (\n    typeof value === 'object' &&\n    value !== null &&\n    ((value: any).$$typeof === REACT_ELEMENT_TYPE ||\n      (value: any).$$typeof === REACT_LAZY_TYPE)\n  ) {\n    if (__DEV__) {\n      if (isInsideContextValue) {\n        console.error('React elements are not allowed in ServerContext');\n      }\n    }\n\n    try {\n      switch ((value: any).$$typeof) {\n        case REACT_ELEMENT_TYPE: {\n          // TODO: Concatenate keys of parents onto children.\n          const element: React$Element<any> = (value: any);\n          // Attempt to render the server component.\n          value = attemptResolveElement(\n            element.type,\n            element.key,\n            element.ref,\n            element.props,\n          );\n          break;\n        }\n        case REACT_LAZY_TYPE: {\n          const payload = (value: any)._payload;\n          const init = (value: any)._init;\n          value = init(payload);\n          break;\n        }\n      }\n    } catch (x) {\n      if (typeof x === 'object' && x !== null && typeof x.then === 'function') {\n        // Something suspended, we'll need to create a new segment and resolve it later.\n        request.pendingChunks++;\n        const newSegment = createSegment(request, value, getActiveContext());\n        const ping = newSegment.ping;\n        x.then(ping, ping);\n        return serializeByRefID(newSegment.id);\n      } else {\n        logRecoverableError(request, x);\n        // Something errored. We'll still send everything we have up until this point.\n        // We'll replace this element with a lazy reference that throws on the client\n        // once it gets rendered.\n        request.pendingChunks++;\n        const errorId = request.nextChunkId++;\n        emitErrorChunk(request, errorId, x);\n        return serializeByRefID(errorId);\n      }\n    }\n  }\n\n  if (value === null) {\n    return null;\n  }\n\n  if (typeof value === 'object') {\n    if (isModuleReference(value)) {\n      const moduleReference: ModuleReference<any> = (value: any);\n      const moduleKey: ModuleKey = getModuleKey(moduleReference);\n      const writtenModules = request.writtenModules;\n      const existingId = writtenModules.get(moduleKey);\n      if (existingId !== undefined) {\n        if (parent[0] === REACT_ELEMENT_TYPE && key === '1') {\n          // If we're encoding the \"type\" of an element, we can refer\n          // to that by a lazy reference instead of directly since React\n          // knows how to deal with lazy values. This lets us suspend\n          // on this component rather than its parent until the code has\n          // loaded.\n          return serializeByRefID(existingId);\n        }\n        return serializeByValueID(existingId);\n      }\n      try {\n        const moduleMetaData: ModuleMetaData = resolveModuleMetaData(\n          request.bundlerConfig,\n          moduleReference,\n        );\n        request.pendingChunks++;\n        const moduleId = request.nextChunkId++;\n        emitModuleChunk(request, moduleId, moduleMetaData);\n        writtenModules.set(moduleKey, moduleId);\n        if (parent[0] === REACT_ELEMENT_TYPE && key === '1') {\n          // If we're encoding the \"type\" of an element, we can refer\n          // to that by a lazy reference instead of directly since React\n          // knows how to deal with lazy values. This lets us suspend\n          // on this component rather than its parent until the code has\n          // loaded.\n          return serializeByRefID(moduleId);\n        }\n        return serializeByValueID(moduleId);\n      } catch (x) {\n        request.pendingChunks++;\n        const errorId = request.nextChunkId++;\n        emitErrorChunk(request, errorId, x);\n        return serializeByValueID(errorId);\n      }\n    } else if ((value: any).$$typeof === REACT_PROVIDER_TYPE) {\n      const providerKey = ((value: any): ReactProviderType<any>)._context\n        ._globalName;\n      const writtenProviders = request.writtenProviders;\n      let providerId = writtenProviders.get(key);\n      if (providerId === undefined) {\n        request.pendingChunks++;\n        providerId = request.nextChunkId++;\n        writtenProviders.set(providerKey, providerId);\n        emitProviderChunk(request, providerId, providerKey);\n      }\n      return serializeByValueID(providerId);\n    } else if (value === POP) {\n      popProvider();\n      if (__DEV__) {\n        insideContextProps = null;\n        isInsideContextValue = false;\n      }\n      return (undefined: any);\n    }\n\n    if (__DEV__) {\n      if (value !== null && !isArray(value)) {\n        // Verify that this is a simple plain object.\n        if (objectName(value) !== 'Object') {\n          console.error(\n            'Only plain objects can be passed to client components from server components. ' +\n              'Built-ins like %s are not supported. ' +\n              'Remove %s from these props: %s',\n            objectName(value),\n            describeKeyForErrorMessage(key),\n            describeObjectForErrorMessage(parent),\n          );\n        } else if (!isSimpleObject(value)) {\n          console.error(\n            'Only plain objects can be passed to client components from server components. ' +\n              'Classes or other objects with methods are not supported. ' +\n              'Remove %s from these props: %s',\n            describeKeyForErrorMessage(key),\n            describeObjectForErrorMessage(parent, key),\n          );\n        } else if (Object.getOwnPropertySymbols) {\n          const symbols = Object.getOwnPropertySymbols(value);\n          if (symbols.length > 0) {\n            console.error(\n              'Only plain objects can be passed to client components from server components. ' +\n                'Objects with symbol properties like %s are not supported. ' +\n                'Remove %s from these props: %s',\n              symbols[0].description,\n              describeKeyForErrorMessage(key),\n              describeObjectForErrorMessage(parent, key),\n            );\n          }\n        }\n      }\n    }\n\n    return value;\n  }\n\n  if (typeof value === 'string') {\n    return escapeStringValue(value);\n  }\n\n  if (\n    typeof value === 'boolean' ||\n    typeof value === 'number' ||\n    typeof value === 'undefined'\n  ) {\n    return value;\n  }\n\n  if (typeof value === 'function') {\n    if (/^on[A-Z]/.test(key)) {\n      throw new Error(\n        'Event handlers cannot be passed to client component props. ' +\n          `Remove ${describeKeyForErrorMessage(\n            key,\n          )} from these props if possible: ${describeObjectForErrorMessage(\n            parent,\n          )}\n` +\n          'If you need interactivity, consider converting part of this to a client component.',\n      );\n    } else {\n      throw new Error(\n        'Functions cannot be passed directly to client components ' +\n          \"because they're not serializable. \" +\n          `Remove ${describeKeyForErrorMessage(key)} (${value.displayName ||\n            value.name ||\n            'function'}) from this object, or avoid the entire object: ${describeObjectForErrorMessage(\n            parent,\n          )}`,\n      );\n    }\n  }\n\n  if (typeof value === 'symbol') {\n    const writtenSymbols = request.writtenSymbols;\n    const existingId = writtenSymbols.get(value);\n    if (existingId !== undefined) {\n      return serializeByValueID(existingId);\n    }\n    const name = value.description;\n\n    if (Symbol.for(name) !== value) {\n      throw new Error(\n        'Only global symbols received from Symbol.for(...) can be passed to client components. ' +\n          `The symbol Symbol.for(${value.description}) cannot be found among global symbols. ` +\n          `Remove ${describeKeyForErrorMessage(\n            key,\n          )} from this object, or avoid the entire object: ${describeObjectForErrorMessage(\n            parent,\n          )}`,\n      );\n    }\n\n    request.pendingChunks++;\n    const symbolId = request.nextChunkId++;\n    emitSymbolChunk(request, symbolId, name);\n    writtenSymbols.set(value, symbolId);\n    return serializeByValueID(symbolId);\n  }\n\n  // $FlowFixMe: bigint isn't added to Flow yet.\n  if (typeof value === 'bigint') {\n    throw new Error(\n      `BigInt (${value}) is not yet supported in client component props. ` +\n        `Remove ${describeKeyForErrorMessage(\n          key,\n        )} from this object or use a plain number instead: ${describeObjectForErrorMessage(\n          parent,\n        )}`,\n    );\n  }\n\n  throw new Error(\n    `Type ${typeof value} is not supported in client component props. ` +\n      `Remove ${describeKeyForErrorMessage(\n        key,\n      )} from this object, or avoid the entire object: ${describeObjectForErrorMessage(\n        parent,\n      )}`,\n  );\n}\n\nfunction logRecoverableError(request: Request, error: mixed): void {\n  const onError = request.onError;\n  onError(error);\n}\n\nfunction fatalError(request: Request, error: mixed): void {\n  // This is called outside error handling code such as if an error happens in React internals.\n  if (request.destination !== null) {\n    request.status = CLOSED;\n    closeWithError(request.destination, error);\n  } else {\n    request.status = CLOSING;\n    request.fatalError = error;\n  }\n}\n\nfunction emitErrorChunk(request: Request, id: number, error: mixed): void {\n  // TODO: We should not leak error messages to the client in prod.\n  // Give this an error code instead and log on the server.\n  // We can serialize the error in DEV as a convenience.\n  let message;\n  let stack = '';\n  try {\n    if (error instanceof Error) {\n      // eslint-disable-next-line react-internal/safe-string-coercion\n      message = String(error.message);\n      // eslint-disable-next-line react-internal/safe-string-coercion\n      stack = String(error.stack);\n    } else {\n      message = 'Error: ' + (error: any);\n    }\n  } catch (x) {\n    message = 'An error occurred but serializing the error message failed.';\n  }\n\n  const processedChunk = processErrorChunk(request, id, message, stack);\n  request.completedErrorChunks.push(processedChunk);\n}\n\nfunction emitModuleChunk(\n  request: Request,\n  id: number,\n  moduleMetaData: ModuleMetaData,\n): void {\n  const processedChunk = processModuleChunk(request, id, moduleMetaData);\n  request.completedModuleChunks.push(processedChunk);\n}\n\nfunction emitSymbolChunk(request: Request, id: number, name: string): void {\n  const processedChunk = processSymbolChunk(request, id, name);\n  request.completedModuleChunks.push(processedChunk);\n}\n\nfunction emitProviderChunk(\n  request: Request,\n  id: number,\n  contextName: string,\n): void {\n  const processedChunk = processProviderChunk(request, id, contextName);\n  request.completedJSONChunks.push(processedChunk);\n}\n\nfunction retrySegment(request: Request, segment: Segment): void {\n  switchContext(segment.context);\n  try {\n    let value = segment.model;\n    while (\n      typeof value === 'object' &&\n      value !== null &&\n      (value: any).$$typeof === REACT_ELEMENT_TYPE\n    ) {\n      // TODO: Concatenate keys of parents onto children.\n      const element: React$Element<any> = (value: any);\n      // Attempt to render the server component.\n      // Doing this here lets us reuse this same segment if the next component\n      // also suspends.\n      segment.model = value;\n      value = attemptResolveElement(\n        element.type,\n        element.key,\n        element.ref,\n        element.props,\n      );\n    }\n    const processedChunk = processModelChunk(request, segment.id, value);\n    request.completedJSONChunks.push(processedChunk);\n  } catch (x) {\n    if (typeof x === 'object' && x !== null && typeof x.then === 'function') {\n      // Something suspended again, let's pick it back up later.\n      const ping = segment.ping;\n      x.then(ping, ping);\n      return;\n    } else {\n      logRecoverableError(request, x);\n      // This errored, we need to serialize this error to the\n      emitErrorChunk(request, segment.id, x);\n    }\n  }\n}\n\nfunction performWork(request: Request): void {\n  const prevDispatcher = ReactCurrentDispatcher.current;\n  const prevCache = getCurrentCache();\n  ReactCurrentDispatcher.current = Dispatcher;\n  setCurrentCache(request.cache);\n  prepareToUseHooksForRequest(request);\n\n  try {\n    const pingedSegments = request.pingedSegments;\n    request.pingedSegments = [];\n    for (let i = 0; i < pingedSegments.length; i++) {\n      const segment = pingedSegments[i];\n      retrySegment(request, segment);\n    }\n    if (request.destination !== null) {\n      flushCompletedChunks(request, request.destination);\n    }\n  } catch (error) {\n    logRecoverableError(request, error);\n    fatalError(request, error);\n  } finally {\n    ReactCurrentDispatcher.current = prevDispatcher;\n    setCurrentCache(prevCache);\n    resetHooksForRequest();\n  }\n}\n\nfunction flushCompletedChunks(\n  request: Request,\n  destination: Destination,\n): void {\n  beginWriting(destination);\n  try {\n    // We emit module chunks first in the stream so that\n    // they can be preloaded as early as possible.\n    const moduleChunks = request.completedModuleChunks;\n    let i = 0;\n    for (; i < moduleChunks.length; i++) {\n      request.pendingChunks--;\n      const chunk = moduleChunks[i];\n      const keepWriting: boolean = writeChunkAndReturn(destination, chunk);\n      if (!keepWriting) {\n        request.destination = null;\n        i++;\n        break;\n      }\n    }\n    moduleChunks.splice(0, i);\n    // Next comes model data.\n    const jsonChunks = request.completedJSONChunks;\n    i = 0;\n    for (; i < jsonChunks.length; i++) {\n      request.pendingChunks--;\n      const chunk = jsonChunks[i];\n      const keepWriting: boolean = writeChunkAndReturn(destination, chunk);\n      if (!keepWriting) {\n        request.destination = null;\n        i++;\n        break;\n      }\n    }\n    jsonChunks.splice(0, i);\n    // Finally, errors are sent. The idea is that it's ok to delay\n    // any error messages and prioritize display of other parts of\n    // the page.\n    const errorChunks = request.completedErrorChunks;\n    i = 0;\n    for (; i < errorChunks.length; i++) {\n      request.pendingChunks--;\n      const chunk = errorChunks[i];\n      const keepWriting: boolean = writeChunkAndReturn(destination, chunk);\n      if (!keepWriting) {\n        request.destination = null;\n        i++;\n        break;\n      }\n    }\n    errorChunks.splice(0, i);\n  } finally {\n    completeWriting(destination);\n  }\n  flushBuffered(destination);\n  if (request.pendingChunks === 0) {\n    // We're done.\n    close(destination);\n  }\n}\n\nexport function startWork(request: Request): void {\n  scheduleWork(() => performWork(request));\n}\n\nexport function startFlowing(request: Request, destination: Destination): void {\n  if (request.status === CLOSING) {\n    request.status = CLOSED;\n    closeWithError(destination, request.fatalError);\n    return;\n  }\n  if (request.status === CLOSED) {\n    return;\n  }\n  if (request.destination !== null) {\n    // We're already flowing.\n    return;\n  }\n  request.destination = destination;\n  try {\n    flushCompletedChunks(request, destination);\n  } catch (error) {\n    logRecoverableError(request, error);\n    fatalError(request, error);\n  }\n}\n\nfunction importServerContexts(\n  contexts?: Array<[string, ServerContextJSONValue]>,\n) {\n  if (contexts) {\n    const prevContext = getActiveContext();\n    switchContext(rootContextSnapshot);\n    for (let i = 0; i < contexts.length; i++) {\n      const [name, value] = contexts[i];\n      const context = getOrCreateServerContext(name);\n      pushProvider(context, value);\n    }\n    const importedContext = getActiveContext();\n    switchContext(prevContext);\n    return importedContext;\n  }\n  return rootContextSnapshot;\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {ReactModel} from 'react-server/src/ReactFlightServer';\nimport type {ServerContextJSONValue} from 'shared/ReactTypes';\nimport type {BundlerConfig} from './ReactFlightServerWebpackBundlerConfig';\n\nimport {\n  createRequest,\n  startWork,\n  startFlowing,\n} from 'react-server/src/ReactFlightServer';\n\ntype Options = {\n  onError?: (error: mixed) => void,\n  context?: Array<[string, ServerContextJSONValue]>,\n  identifierPrefix?: string,\n};\n\nfunction renderToReadableStream(\n  model: ReactModel,\n  webpackMap: BundlerConfig,\n  options?: Options,\n): ReadableStream {\n  const request = createRequest(\n    model,\n    webpackMap,\n    options ? options.onError : undefined,\n    options ? options.context : undefined,\n    options ? options.identifierPrefix : undefined,\n  );\n  const stream = new ReadableStream(\n    {\n      type: 'bytes',\n      start(controller) {\n        startWork(request);\n      },\n      pull(controller) {\n        startFlowing(request, controller);\n      },\n      cancel(reason) {},\n    },\n    // $FlowFixMe size() methods are not allowed on byte streams.\n    {highWaterMark: 0},\n  );\n  return stream;\n}\n\nexport {renderToReadableStream};\n"],"names":["scheduleWork","callback","VIEW_SIZE","currentView","writtenBytes","beginWriting","destination","Uint8Array","writeChunk","chunk","length","enqueue","buffer","bytesToWrite","allowableBytes","set","subarray","writeChunkAndReturn","completeWriting","close","textEncoder","TextEncoder","stringToChunk","content","encode","stringToPrecomputedChunk","closeWithError","error","stringify","JSON","serializeRowHeader","tag","id","toString","processErrorChunk","request","message","stack","errorInfo","row","processModelChunk","model","json","toJSON","processModuleChunk","moduleMetaData","processProviderChunk","contextName","processSymbolChunk","name","MODULE_TAG","Symbol","for","getModuleKey","reference","filepath","isModuleReference","$$typeof","resolveModuleMetaData","config","moduleReference","REACT_ELEMENT_TYPE","REACT_FRAGMENT_TYPE","REACT_PROVIDER_TYPE","REACT_FORWARD_REF_TYPE","REACT_MEMO_TYPE","REACT_LAZY_TYPE","REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED","RESERVED","STRING","BOOLEANISH_STRING","BOOLEAN","OVERLOADED_BOOLEAN","NUMERIC","POSITIVE_NUMERIC","PropertyInfoRecord","type","mustUseProperty","attributeName","attributeNamespace","sanitizeURL","removeEmptyString","acceptsBooleans","propertyName","properties","reservedProps","push","forEach","toLowerCase","CAMELIZE","capitalize","token","toUpperCase","replace","xlinkHref","isUnitlessNumber","animationIterationCount","aspectRatio","borderImageOutset","borderImageSlice","borderImageWidth","boxFlex","boxFlexGroup","boxOrdinalGroup","columnCount","columns","flex","flexGrow","flexPositive","flexShrink","flexNegative","flexOrder","gridArea","gridRow","gridRowEnd","gridRowSpan","gridRowStart","gridColumn","gridColumnEnd","gridColumnSpan","gridColumnStart","fontWeight","lineClamp","lineHeight","opacity","order","orphans","tabSize","widows","zIndex","zoom","fillOpacity","floodOpacity","stopOpacity","strokeDasharray","strokeDashoffset","strokeMiterlimit","strokeOpacity","strokeWidth","prefixKey","prefix","key","charAt","substring","prefixes","Object","keys","prop","isArrayImpl","Array","isArray","a","startInlineScript","endInlineScript","startScriptSrc","startModuleSrc","endAsyncScript","textSeparator","styleAttributeStart","styleAssign","styleSeparator","attributeSeparator","attributeAssign","attributeEnd","attributeEmptyString","endOfStartTag","endOfStartTagSelfClosing","selectedMarkerAttribute","leadingNewline","DOCTYPE","endTag1","endTag2","placeholder1","placeholder2","startCompletedSuspenseBoundary","startPendingSuspenseBoundary1","startPendingSuspenseBoundary2","startClientRenderedSuspenseBoundary","endSuspenseBoundary","clientRenderedSuspenseBoundaryError1","clientRenderedSuspenseBoundaryErrorAttrInterstitial","clientRenderedSuspenseBoundaryError1A","clientRenderedSuspenseBoundaryError1B","clientRenderedSuspenseBoundaryError1C","clientRenderedSuspenseBoundaryError2","startSegmentHTML","startSegmentHTML2","endSegmentHTML","startSegmentSVG","startSegmentSVG2","endSegmentSVG","startSegmentMathML","startSegmentMathML2","endSegmentMathML","startSegmentTable","startSegmentTable2","endSegmentTable","startSegmentTableBody","startSegmentTableBody2","endSegmentTableBody","startSegmentTableRow","startSegmentTableRow2","endSegmentTableRow","startSegmentColGroup","startSegmentColGroup2","endSegmentColGroup","completeSegmentFunction","completeBoundaryFunction","clientRenderFunction","completeSegmentScript1Full","completeSegmentScript1Partial","completeSegmentScript2","completeSegmentScript3","completeBoundaryScript1Full","completeBoundaryScript1Partial","completeBoundaryScript2","completeBoundaryScript3","clientRenderScript1Full","clientRenderScript1Partial","clientRenderScript1A","clientRenderScript2","clientRenderErrorScriptArgInterstitial","rootContextSnapshot","currentActiveSnapshot","popNode","prev","context","_currentValue","parentValue","pushNode","next","value","popToNearestCommonAncestor","parentPrev","parent","parentNext","Error","popAllPrevious","pushAllNext","popPreviousToCommonLevel","depth","popNextToCommonLevel","switchContext","newSnapshot","pushProvider","nextValue","prevValue","prevNode","newNode","popProvider","prevSnapshot","_defaultValue","getActiveContext","readContext","isPrimaryRenderer","currentRequest","prepareToUseHooksForRequest","resetHooksForRequest","readContextImpl","Dispatcher","useMemo","nextCreate","useCallback","useDebugValue","useDeferredValue","unsupportedHook","useTransition","getCacheForType","resourceType","currentCache","entry","get","undefined","useContext","useReducer","useRef","useState","useInsertionEffect","useLayoutEffect","useImperativeHandle","useEffect","useId","useMutableSource","useSyncExternalStore","useCacheRefresh","unsupportedRefresh","setCurrentCache","cache","getCurrentCache","identifierCount","identifierPrefix","ReactSharedInternals","React","ContextRegistry","getOrCreateServerContext","globalName","createServerContext","ReactCurrentDispatcher","defaultErrorHandler","console","OPEN","CLOSING","CLOSED","createRequest","bundlerConfig","onError","pingedSegments","status","fatalError","Map","nextChunkId","pendingChunks","completedModuleChunks","completedJSONChunks","completedErrorChunks","writtenSymbols","writtenModules","writtenProviders","resolveModelToJSON","rootContext","createRootContext","rootSegment","createSegment","reqContext","importServerContexts","POP","attemptResolveElement","ref","props","children","payload","_payload","init","_init","wrappedType","render","_context","__pop","describeValueForErrorMessage","pingSegment","segment","performWork","ping","serializeByValueID","serializeByRefID","escapeStringValue","objectName","object","prototype","call","m","p0","describeKeyForErrorMessage","encodedKey","substr","String","describeObjectForErrorMessage","objectOrArray","expandedName","str","array","i","names","element","x","then","newSegment","logRecoverableError","errorId","emitErrorChunk","moduleKey","existingId","moduleId","emitModuleChunk","providerKey","_globalName","providerId","emitProviderChunk","test","displayName","description","symbolId","emitSymbolChunk","processedChunk","retrySegment","prevDispatcher","current","prevCache","flushCompletedChunks","moduleChunks","keepWriting","splice","jsonChunks","errorChunks","startWork","startFlowing","contexts","prevContext","importedContext","renderToReadableStream","webpackMap","options","stream","ReadableStream","start","controller","pull","cancel","reason","highWaterMark"],"mappings":"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"}