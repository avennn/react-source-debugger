{"version":3,"file":"react-dom-unstable-fizz.node.production.min.js","sources":["../../../../packages/react-server/src/ReactServerStreamConfigNode.js","../../../../packages/react-server/src/ReactDOMServerFormatConfig.js","../../../../packages/shared/ReactSymbols.js","../../../../packages/react-server/src/ReactFizzServer.js","../../../../packages/react-dom/src/server/ReactDOMFizzServerNode.js"],"sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {Writable} from 'stream';\n\ntype MightBeFlushable = {\n  flush?: () => void,\n  // Legacy\n  flushHeaders?: () => void,\n  ...\n};\n\nexport type Destination = Writable & MightBeFlushable;\n\nexport function scheduleWork(callback: () => void) {\n  setImmediate(callback);\n}\n\nexport function flushBuffered(destination: Destination) {\n  // If we don't have any more data to send right now.\n  // Flush whatever is in the buffer to the wire.\n  if (typeof destination.flush === 'function') {\n    // http.createServer response have flush(), but it has a different meaning and\n    // is deprecated in favor of flushHeaders(). Detect to avoid a warning.\n    if (typeof destination.flushHeaders !== 'function') {\n      // By convention the Zlib streams provide a flush function for this purpose.\n      destination.flush();\n    }\n  }\n}\n\nexport function beginWriting(destination: Destination) {\n  // Older Node streams like http.createServer don't have this.\n  if (typeof destination.cork === 'function') {\n    destination.cork();\n  }\n}\n\nexport function writeChunk(\n  destination: Destination,\n  buffer: Uint8Array,\n): boolean {\n  const nodeBuffer = ((buffer: any): Buffer); // close enough\n  return destination.write(nodeBuffer);\n}\n\nexport function completeWriting(destination: Destination) {\n  // Older Node streams like http.createServer don't have this.\n  if (typeof destination.uncork === 'function') {\n    destination.uncork();\n  }\n}\n\nexport function close(destination: Destination) {\n  destination.end();\n}\n\nexport function convertStringToBuffer(content: string): Uint8Array {\n  return Buffer.from(content, 'utf8');\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport {convertStringToBuffer} from 'react-server/src/ReactServerStreamConfig';\n\nexport function formatChunkAsString(type: string, props: Object): string {\n  let str = '<' + type + '>';\n  if (typeof props.children === 'string') {\n    str += props.children;\n  }\n  str += '</' + type + '>';\n  return str;\n}\n\nexport function formatChunk(type: string, props: Object): Uint8Array {\n  return convertStringToBuffer(formatChunkAsString(type, props));\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n// ATTENTION\n// When adding new symbols to this file,\n// Please consider also adding to 'react-devtools-shared/src/backend/ReactSymbols'\n\n// The Symbol used to tag the ReactElement-like types. If there is no native Symbol\n// nor polyfill, then a plain number is used for performance.\nexport let REACT_ELEMENT_TYPE = 0xeac7;\nexport let REACT_PORTAL_TYPE = 0xeaca;\nexport let REACT_FRAGMENT_TYPE = 0xeacb;\nexport let REACT_STRICT_MODE_TYPE = 0xeacc;\nexport let REACT_PROFILER_TYPE = 0xead2;\nexport let REACT_PROVIDER_TYPE = 0xeacd;\nexport let REACT_CONTEXT_TYPE = 0xeace;\nexport let REACT_FORWARD_REF_TYPE = 0xead0;\nexport let REACT_SUSPENSE_TYPE = 0xead1;\nexport let REACT_SUSPENSE_LIST_TYPE = 0xead8;\nexport let REACT_MEMO_TYPE = 0xead3;\nexport let REACT_LAZY_TYPE = 0xead4;\nexport let REACT_BLOCK_TYPE = 0xead9;\nexport let REACT_SERVER_BLOCK_TYPE = 0xeada;\nexport let REACT_FUNDAMENTAL_TYPE = 0xead5;\nexport let REACT_SCOPE_TYPE = 0xead7;\nexport let REACT_OPAQUE_ID_TYPE = 0xeae0;\nexport let REACT_DEBUG_TRACING_MODE_TYPE = 0xeae1;\nexport let REACT_OFFSCREEN_TYPE = 0xeae2;\nexport let REACT_LEGACY_HIDDEN_TYPE = 0xeae3;\n\nif (typeof Symbol === 'function' && Symbol.for) {\n  const symbolFor = Symbol.for;\n  REACT_ELEMENT_TYPE = symbolFor('react.element');\n  REACT_PORTAL_TYPE = symbolFor('react.portal');\n  REACT_FRAGMENT_TYPE = symbolFor('react.fragment');\n  REACT_STRICT_MODE_TYPE = symbolFor('react.strict_mode');\n  REACT_PROFILER_TYPE = symbolFor('react.profiler');\n  REACT_PROVIDER_TYPE = symbolFor('react.provider');\n  REACT_CONTEXT_TYPE = symbolFor('react.context');\n  REACT_FORWARD_REF_TYPE = symbolFor('react.forward_ref');\n  REACT_SUSPENSE_TYPE = symbolFor('react.suspense');\n  REACT_SUSPENSE_LIST_TYPE = symbolFor('react.suspense_list');\n  REACT_MEMO_TYPE = symbolFor('react.memo');\n  REACT_LAZY_TYPE = symbolFor('react.lazy');\n  REACT_BLOCK_TYPE = symbolFor('react.block');\n  REACT_SERVER_BLOCK_TYPE = symbolFor('react.server.block');\n  REACT_FUNDAMENTAL_TYPE = symbolFor('react.fundamental');\n  REACT_SCOPE_TYPE = symbolFor('react.scope');\n  REACT_OPAQUE_ID_TYPE = symbolFor('react.opaque.id');\n  REACT_DEBUG_TRACING_MODE_TYPE = symbolFor('react.debug_trace_mode');\n  REACT_OFFSCREEN_TYPE = symbolFor('react.offscreen');\n  REACT_LEGACY_HIDDEN_TYPE = symbolFor('react.legacy_hidden');\n}\n\nconst MAYBE_ITERATOR_SYMBOL = typeof Symbol === 'function' && Symbol.iterator;\nconst FAUX_ITERATOR_SYMBOL = '@@iterator';\n\nexport function getIteratorFn(maybeIterable: ?any): ?() => ?Iterator<*> {\n  if (maybeIterable === null || typeof maybeIterable !== 'object') {\n    return null;\n  }\n  const maybeIterator =\n    (MAYBE_ITERATOR_SYMBOL && maybeIterable[MAYBE_ITERATOR_SYMBOL]) ||\n    maybeIterable[FAUX_ITERATOR_SYMBOL];\n  if (typeof maybeIterator === 'function') {\n    return maybeIterator;\n  }\n  return null;\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {Destination} from './ReactServerStreamConfig';\nimport type {ReactNodeList} from 'shared/ReactTypes';\n\nimport {\n  scheduleWork,\n  beginWriting,\n  writeChunk,\n  completeWriting,\n  flushBuffered,\n  close,\n} from './ReactServerStreamConfig';\nimport {formatChunk} from './ReactServerFormatConfig';\nimport {REACT_ELEMENT_TYPE} from 'shared/ReactSymbols';\n\ntype OpaqueRequest = {\n  destination: Destination,\n  children: ReactNodeList,\n  completedChunks: Array<Uint8Array>,\n  flowing: boolean,\n  ...\n};\n\nexport function createRequest(\n  children: ReactNodeList,\n  destination: Destination,\n): OpaqueRequest {\n  return {destination, children, completedChunks: [], flowing: false};\n}\n\nfunction performWork(request: OpaqueRequest): void {\n  const element = (request.children: any);\n  request.children = null;\n  if (element && element.$$typeof !== REACT_ELEMENT_TYPE) {\n    return;\n  }\n  const type = element.type;\n  const props = element.props;\n  if (typeof type !== 'string') {\n    return;\n  }\n  request.completedChunks.push(formatChunk(type, props));\n  if (request.flowing) {\n    flushCompletedChunks(request);\n  }\n\n  flushBuffered(request.destination);\n}\n\nfunction flushCompletedChunks(request: OpaqueRequest) {\n  const destination = request.destination;\n  const chunks = request.completedChunks;\n  request.completedChunks = [];\n\n  beginWriting(destination);\n  try {\n    for (let i = 0; i < chunks.length; i++) {\n      const chunk = chunks[i];\n      writeChunk(destination, chunk);\n    }\n  } finally {\n    completeWriting(destination);\n  }\n  close(destination);\n}\n\nexport function startWork(request: OpaqueRequest): void {\n  request.flowing = true;\n  scheduleWork(() => performWork(request));\n}\n\nexport function startFlowing(request: OpaqueRequest): void {\n  request.flowing = false;\n  flushCompletedChunks(request);\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {ReactNodeList} from 'shared/ReactTypes';\nimport type {Writable} from 'stream';\n\nimport {\n  createRequest,\n  startWork,\n  startFlowing,\n} from 'react-server/src/ReactFizzServer';\n\nfunction createDrainHandler(destination, request) {\n  return () => startFlowing(request);\n}\n\nfunction pipeToNodeWritable(\n  children: ReactNodeList,\n  destination: Writable,\n): void {\n  const request = createRequest(children, destination);\n  destination.on('drain', createDrainHandler(destination, request));\n  startWork(request);\n}\n\nexport {pipeToNodeWritable};\n"],"names":["scheduleWork","callback","setImmediate","flushBuffered","destination","flush","flushHeaders","beginWriting","cork","writeChunk","buffer","nodeBuffer","write","completeWriting","uncork","close","end","convertStringToBuffer","content","Buffer","from","formatChunkAsString","type","props","str","children","formatChunk","REACT_ELEMENT_TYPE","Symbol","for","symbolFor","REACT_PORTAL_TYPE","createRequest","completedChunks","flowing","performWork","request","element","$$typeof","push","flushCompletedChunks","chunks","i","length","chunk","startWork","startFlowing","createDrainHandler","pipeToNodeWritable","on"],"mappings":"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"}