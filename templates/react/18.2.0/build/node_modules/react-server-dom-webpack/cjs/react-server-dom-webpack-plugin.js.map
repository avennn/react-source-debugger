{"version":3,"file":"react-server-dom-webpack-plugin.js","sources":["../../../../packages/shared/isArray.js","../../../../packages/react-server-dom-webpack/src/ReactFlightWebpackPlugin.js"],"sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\ndeclare function isArray(a: mixed): boolean %checks(Array.isArray(a));\n\nconst isArrayImpl = Array.isArray;\n\n// eslint-disable-next-line no-redeclare\nfunction isArray(a: mixed): boolean {\n  return isArrayImpl(a);\n}\n\nexport default isArray;\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport {join} from 'path';\nimport {pathToFileURL} from 'url';\n\nimport asyncLib from 'neo-async';\n\nimport ModuleDependency from 'webpack/lib/dependencies/ModuleDependency';\nimport NullDependency from 'webpack/lib/dependencies/NullDependency';\nimport Template from 'webpack/lib/Template';\nimport {\n  sources,\n  WebpackError,\n  Compilation,\n  AsyncDependenciesBlock,\n} from 'webpack';\n\nimport isArray from 'shared/isArray';\n\nclass ClientReferenceDependency extends ModuleDependency {\n  constructor(request) {\n    super(request);\n  }\n\n  get type() {\n    return 'client-reference';\n  }\n}\n\n// This is the module that will be used to anchor all client references to.\n// I.e. it will have all the client files as async deps from this point on.\n// We use the Flight client implementation because you can't get to these\n// without the client runtime so it's the first time in the loading sequence\n// you might want them.\nconst clientImportName = 'react-server-dom-webpack';\nconst clientFileName = require.resolve('../');\n\ntype ClientReferenceSearchPath = {\n  directory: string,\n  recursive?: boolean,\n  include: RegExp,\n  exclude?: RegExp,\n};\n\ntype ClientReferencePath = string | ClientReferenceSearchPath;\n\ntype Options = {\n  isServer: boolean,\n  clientReferences?: ClientReferencePath | $ReadOnlyArray<ClientReferencePath>,\n  chunkName?: string,\n  manifestFilename?: string,\n};\n\nconst PLUGIN_NAME = 'React Server Plugin';\n\nexport default class ReactFlightWebpackPlugin {\n  clientReferences: $ReadOnlyArray<ClientReferencePath>;\n  chunkName: string;\n  manifestFilename: string;\n\n  constructor(options: Options) {\n    if (!options || typeof options.isServer !== 'boolean') {\n      throw new Error(\n        PLUGIN_NAME + ': You must specify the isServer option as a boolean.',\n      );\n    }\n    if (options.isServer) {\n      throw new Error('TODO: Implement the server compiler.');\n    }\n    if (!options.clientReferences) {\n      this.clientReferences = [\n        {\n          directory: '.',\n          recursive: true,\n          include: /\\.client\\.(js|ts|jsx|tsx)$/,\n        },\n      ];\n    } else if (\n      typeof options.clientReferences === 'string' ||\n      !isArray(options.clientReferences)\n    ) {\n      this.clientReferences = [(options.clientReferences: $FlowFixMe)];\n    } else {\n      this.clientReferences = options.clientReferences;\n    }\n    if (typeof options.chunkName === 'string') {\n      this.chunkName = options.chunkName;\n      if (!/\\[(index|request)\\]/.test(this.chunkName)) {\n        this.chunkName += '[index]';\n      }\n    } else {\n      this.chunkName = 'client[index]';\n    }\n    this.manifestFilename =\n      options.manifestFilename || 'react-client-manifest.json';\n  }\n\n  apply(compiler: any) {\n    const _this = this;\n    let resolvedClientReferences;\n    let clientFileNameFound = false;\n\n    // Find all client files on the file system\n    compiler.hooks.beforeCompile.tapAsync(\n      PLUGIN_NAME,\n      ({contextModuleFactory}, callback) => {\n        const contextResolver = compiler.resolverFactory.get('context', {});\n\n        _this.resolveAllClientFiles(\n          compiler.context,\n          contextResolver,\n          compiler.inputFileSystem,\n          contextModuleFactory,\n          function(err, resolvedClientRefs) {\n            if (err) {\n              callback(err);\n              return;\n            }\n\n            resolvedClientReferences = resolvedClientRefs;\n            callback();\n          },\n        );\n      },\n    );\n\n    compiler.hooks.thisCompilation.tap(\n      PLUGIN_NAME,\n      (compilation, {normalModuleFactory}) => {\n        compilation.dependencyFactories.set(\n          ClientReferenceDependency,\n          normalModuleFactory,\n        );\n        compilation.dependencyTemplates.set(\n          ClientReferenceDependency,\n          new NullDependency.Template(),\n        );\n\n        const handler = parser => {\n          // We need to add all client references as dependency of something in the graph so\n          // Webpack knows which entries need to know about the relevant chunks and include the\n          // map in their runtime. The things that actually resolves the dependency is the Flight\n          // client runtime. So we add them as a dependency of the Flight client runtime.\n          // Anything that imports the runtime will be made aware of these chunks.\n          parser.hooks.program.tap(PLUGIN_NAME, () => {\n            const module = parser.state.module;\n\n            if (module.resource !== clientFileName) {\n              return;\n            }\n\n            clientFileNameFound = true;\n\n            if (resolvedClientReferences) {\n              for (let i = 0; i < resolvedClientReferences.length; i++) {\n                const dep = resolvedClientReferences[i];\n\n                const chunkName = _this.chunkName\n                  .replace(/\\[index\\]/g, '' + i)\n                  .replace(/\\[request\\]/g, Template.toPath(dep.userRequest));\n\n                const block = new AsyncDependenciesBlock(\n                  {\n                    name: chunkName,\n                  },\n                  null,\n                  dep.request,\n                );\n\n                block.addDependency(dep);\n                module.addBlock(block);\n              }\n            }\n          });\n        };\n\n        normalModuleFactory.hooks.parser\n          .for('javascript/auto')\n          .tap('HarmonyModulesPlugin', handler);\n\n        normalModuleFactory.hooks.parser\n          .for('javascript/esm')\n          .tap('HarmonyModulesPlugin', handler);\n\n        normalModuleFactory.hooks.parser\n          .for('javascript/dynamic')\n          .tap('HarmonyModulesPlugin', handler);\n      },\n    );\n\n    compiler.hooks.make.tap(PLUGIN_NAME, compilation => {\n      compilation.hooks.processAssets.tap(\n        {\n          name: PLUGIN_NAME,\n          stage: Compilation.PROCESS_ASSETS_STAGE_REPORT,\n        },\n        function() {\n          if (clientFileNameFound === false) {\n            compilation.warnings.push(\n              new WebpackError(\n                `Client runtime at ${clientImportName} was not found. React Server Components module map file ${_this.manifestFilename} was not created.`,\n              ),\n            );\n            return;\n          }\n\n          const json = {};\n          compilation.chunkGroups.forEach(function(chunkGroup) {\n            const chunkIds = chunkGroup.chunks.map(function(c) {\n              return c.id;\n            });\n\n            function recordModule(id, module) {\n              // TODO: Hook into deps instead of the target module.\n              // That way we know by the type of dep whether to include.\n              // It also resolves conflicts when the same module is in multiple chunks.\n\n              if (!/\\.client\\.(js|ts)x?$/.test(module.resource)) {\n                return;\n              }\n\n              const moduleProvidedExports = compilation.moduleGraph\n                .getExportsInfo(module)\n                .getProvidedExports();\n\n              const moduleExports = {};\n              ['', '*']\n                .concat(\n                  Array.isArray(moduleProvidedExports)\n                    ? moduleProvidedExports\n                    : [],\n                )\n                .forEach(function(name) {\n                  moduleExports[name] = {\n                    id,\n                    chunks: chunkIds,\n                    name: name,\n                  };\n                });\n              const href = pathToFileURL(module.resource).href;\n\n              if (href !== undefined) {\n                json[href] = moduleExports;\n              }\n            }\n\n            chunkGroup.chunks.forEach(function(chunk) {\n              const chunkModules = compilation.chunkGraph.getChunkModulesIterable(\n                chunk,\n              );\n\n              Array.from(chunkModules).forEach(function(module) {\n                const moduleId = compilation.chunkGraph.getModuleId(module);\n\n                recordModule(moduleId, module);\n                // If this is a concatenation, register each child to the parent ID.\n                if (module.modules) {\n                  module.modules.forEach(concatenatedMod => {\n                    recordModule(moduleId, concatenatedMod);\n                  });\n                }\n              });\n            });\n          });\n\n          const output = JSON.stringify(json, null, 2);\n          compilation.emitAsset(\n            _this.manifestFilename,\n            new sources.RawSource(output, false),\n          );\n        },\n      );\n    });\n  }\n\n  // This attempts to replicate the dynamic file path resolution used for other wildcard\n  // resolution in Webpack is using.\n  resolveAllClientFiles(\n    context: string,\n    contextResolver: any,\n    fs: any,\n    contextModuleFactory: any,\n    callback: (\n      err: null | Error,\n      result?: $ReadOnlyArray<ClientReferenceDependency>,\n    ) => void,\n  ) {\n    asyncLib.map(\n      this.clientReferences,\n      (\n        clientReferencePath: string | ClientReferenceSearchPath,\n        cb: (\n          err: null | Error,\n          result?: $ReadOnlyArray<ClientReferenceDependency>,\n        ) => void,\n      ): void => {\n        if (typeof clientReferencePath === 'string') {\n          cb(null, [new ClientReferenceDependency(clientReferencePath)]);\n          return;\n        }\n        const clientReferenceSearch: ClientReferenceSearchPath = clientReferencePath;\n        contextResolver.resolve(\n          {},\n          context,\n          clientReferencePath.directory,\n          {},\n          (err, resolvedDirectory) => {\n            if (err) return cb(err);\n            const options = {\n              resource: resolvedDirectory,\n              resourceQuery: '',\n              recursive:\n                clientReferenceSearch.recursive === undefined\n                  ? true\n                  : clientReferenceSearch.recursive,\n              regExp: clientReferenceSearch.include,\n              include: undefined,\n              exclude: clientReferenceSearch.exclude,\n            };\n            contextModuleFactory.resolveDependencies(\n              fs,\n              options,\n              (err2: null | Error, deps: Array<ModuleDependency>) => {\n                if (err2) return cb(err2);\n                const clientRefDeps = deps.map(dep => {\n                  // use userRequest instead of request. request always end with undefined which is wrong\n                  const request = join(resolvedDirectory, dep.userRequest);\n                  const clientRefDep = new ClientReferenceDependency(request);\n                  clientRefDep.userRequest = dep.userRequest;\n                  return clientRefDep;\n                });\n                cb(null, clientRefDeps);\n              },\n            );\n          },\n        );\n      },\n      (\n        err: null | Error,\n        result: $ReadOnlyArray<$ReadOnlyArray<ClientReferenceDependency>>,\n      ): void => {\n        if (err) return callback(err);\n        const flat = [];\n        for (let i = 0; i < result.length; i++) {\n          flat.push.apply(flat, result[i]);\n        }\n        callback(null, flat);\n      },\n    );\n  }\n}\n"],"names":["isArrayImpl","Array","isArray","a","ClientReferenceDependency","ModuleDependency","constructor","request","type","clientImportName","clientFileName","require","resolve","PLUGIN_NAME","ReactFlightWebpackPlugin","options","isServer","Error","clientReferences","directory","recursive","include","chunkName","test","manifestFilename","apply","compiler","_this","resolvedClientReferences","clientFileNameFound","hooks","beforeCompile","tapAsync","callback","contextModuleFactory","contextResolver","resolverFactory","get","resolveAllClientFiles","context","inputFileSystem","err","resolvedClientRefs","thisCompilation","tap","compilation","normalModuleFactory","dependencyFactories","set","dependencyTemplates","NullDependency","Template","handler","parser","program","module","state","resource","i","length","dep","replace","toPath","userRequest","block","AsyncDependenciesBlock","name","addDependency","addBlock","for","make","processAssets","stage","Compilation","PROCESS_ASSETS_STAGE_REPORT","warnings","push","WebpackError","json","chunkGroups","forEach","chunkGroup","chunkIds","chunks","map","c","id","recordModule","moduleProvidedExports","moduleGraph","getExportsInfo","getProvidedExports","moduleExports","concat","href","pathToFileURL","undefined","chunk","chunkModules","chunkGraph","getChunkModulesIterable","from","moduleId","getModuleId","modules","concatenatedMod","output","JSON","stringify","emitAsset","sources","RawSource","fs","asyncLib","clientReferencePath","cb","clientReferenceSearch","resolvedDirectory","resourceQuery","regExp","exclude","resolveDependencies","err2","deps","clientRefDeps","join","clientRefDep","result","flat"],"mappings":"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"}