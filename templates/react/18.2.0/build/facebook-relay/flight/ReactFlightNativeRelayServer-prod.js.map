{"version":3,"file":"ReactFlightNativeRelayServer-prod.js","sources":["../../../packages/shared/hasOwnProperty.js","../../../packages/shared/isArray.js","../../../packages/react-server-native-relay/src/ReactFlightNativeRelayServerHostConfig.js","../../../packages/shared/ReactSymbols.js","../../../packages/react-server/src/ReactServerStreamConfigNode.js","../../../packages/react-native-renderer/src/server/ReactNativeServerFormatConfig.js","../../../packages/react-server/src/ReactFlightNewContext.js","../../../packages/react-server/src/ReactFlightHooks.js","../../../packages/shared/ReactSharedInternals.js","../../../packages/shared/ReactServerContextRegistry.js","../../../packages/react-server/src/ReactFlightServer.js","../../../packages/react-server-native-relay/src/ReactFlightNativeRelayServer.js"],"sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\n\nexport default hasOwnProperty;\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\ndeclare function isArray(a: mixed): boolean %checks(Array.isArray(a));\n\nconst isArrayImpl = Array.isArray;\n\n// eslint-disable-next-line no-redeclare\nfunction isArray(a: mixed): boolean {\n  return isArrayImpl(a);\n}\n\nexport default isArray;\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {RowEncoding, JSONValue} from './ReactFlightNativeRelayProtocol';\nimport type {Request, ReactModel} from 'react-server/src/ReactFlightServer';\nimport hasOwnProperty from 'shared/hasOwnProperty';\nimport isArray from 'shared/isArray';\nimport type {JSResourceReference} from 'JSResourceReference';\nimport JSResourceReferenceImpl from 'JSResourceReferenceImpl';\n\nexport type ModuleReference<T> = JSResourceReference<T>;\n\nimport type {\n  Destination,\n  BundlerConfig,\n  ModuleMetaData,\n} from 'ReactFlightNativeRelayServerIntegration';\n\nimport {resolveModelToJSON} from 'react-server/src/ReactFlightServer';\n\nimport {\n  emitRow,\n  close,\n  resolveModuleMetaData as resolveModuleMetaDataImpl,\n} from 'ReactFlightNativeRelayServerIntegration';\n\nexport type {\n  Destination,\n  BundlerConfig,\n  ModuleMetaData,\n} from 'ReactFlightNativeRelayServerIntegration';\n\nexport function isModuleReference(reference: Object): boolean {\n  return reference instanceof JSResourceReferenceImpl;\n}\n\nexport type ModuleKey = ModuleReference<any>;\n\nexport function getModuleKey(reference: ModuleReference<any>): ModuleKey {\n  // We use the reference object itself as the key because we assume the\n  // object will be cached by the bundler runtime.\n  return reference;\n}\n\nexport function resolveModuleMetaData<T>(\n  config: BundlerConfig,\n  resource: ModuleReference<T>,\n): ModuleMetaData {\n  return resolveModuleMetaDataImpl(config, resource);\n}\n\nexport type Chunk = RowEncoding;\n\nexport function processErrorChunk(\n  request: Request,\n  id: number,\n  message: string,\n  stack: string,\n): Chunk {\n  return [\n    'E',\n    id,\n    {\n      message,\n      stack,\n    },\n  ];\n}\n\nfunction convertModelToJSON(\n  request: Request,\n  parent: {+[key: string]: ReactModel} | $ReadOnlyArray<ReactModel>,\n  key: string,\n  model: ReactModel,\n): JSONValue {\n  const json = resolveModelToJSON(request, parent, key, model);\n  if (typeof json === 'object' && json !== null) {\n    if (isArray(json)) {\n      const jsonArray: Array<JSONValue> = [];\n      for (let i = 0; i < json.length; i++) {\n        jsonArray[i] = convertModelToJSON(request, json, '' + i, json[i]);\n      }\n      return jsonArray;\n    } else {\n      const jsonObj: {[key: string]: JSONValue} = {};\n      for (const nextKey in json) {\n        if (hasOwnProperty.call(json, nextKey)) {\n          jsonObj[nextKey] = convertModelToJSON(\n            request,\n            json,\n            nextKey,\n            json[nextKey],\n          );\n        }\n      }\n      return jsonObj;\n    }\n  }\n  return json;\n}\n\nexport function processModelChunk(\n  request: Request,\n  id: number,\n  model: ReactModel,\n): Chunk {\n  const json = convertModelToJSON(request, {}, '', model);\n  return ['J', id, json];\n}\n\nexport function processModuleChunk(\n  request: Request,\n  id: number,\n  moduleMetaData: ModuleMetaData,\n): Chunk {\n  // The moduleMetaData is already a JSON serializable value.\n  return ['M', id, moduleMetaData];\n}\n\nexport function processProviderChunk(\n  request: Request,\n  id: number,\n  contextName: string,\n): Chunk {\n  return ['P', id, contextName];\n}\n\nexport function processSymbolChunk(\n  request: Request,\n  id: number,\n  name: string,\n): Chunk {\n  return ['S', id, name];\n}\n\nexport function scheduleWork(callback: () => void) {\n  callback();\n}\n\nexport function flushBuffered(destination: Destination) {}\n\nexport function beginWriting(destination: Destination) {}\n\nexport function writeChunk(destination: Destination, chunk: Chunk): void {\n  emitRow(destination, chunk);\n}\n\nexport function writeChunkAndReturn(\n  destination: Destination,\n  chunk: Chunk,\n): boolean {\n  emitRow(destination, chunk);\n  return true;\n}\n\nexport function completeWriting(destination: Destination) {}\n\nexport {close};\n\nexport function closeWithError(destination: Destination, error: mixed): void {\n  close(destination);\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n// ATTENTION\n// When adding new symbols to this file,\n// Please consider also adding to 'react-devtools-shared/src/backend/ReactSymbols'\n\n// The Symbol used to tag the ReactElement-like types.\nexport const REACT_ELEMENT_TYPE = Symbol.for('react.element');\nexport const REACT_PORTAL_TYPE = Symbol.for('react.portal');\nexport const REACT_FRAGMENT_TYPE = Symbol.for('react.fragment');\nexport const REACT_STRICT_MODE_TYPE = Symbol.for('react.strict_mode');\nexport const REACT_PROFILER_TYPE = Symbol.for('react.profiler');\nexport const REACT_PROVIDER_TYPE = Symbol.for('react.provider');\nexport const REACT_CONTEXT_TYPE = Symbol.for('react.context');\nexport const REACT_SERVER_CONTEXT_TYPE = Symbol.for('react.server_context');\nexport const REACT_FORWARD_REF_TYPE = Symbol.for('react.forward_ref');\nexport const REACT_SUSPENSE_TYPE = Symbol.for('react.suspense');\nexport const REACT_SUSPENSE_LIST_TYPE = Symbol.for('react.suspense_list');\nexport const REACT_MEMO_TYPE = Symbol.for('react.memo');\nexport const REACT_LAZY_TYPE = Symbol.for('react.lazy');\nexport const REACT_SCOPE_TYPE = Symbol.for('react.scope');\nexport const REACT_DEBUG_TRACING_MODE_TYPE = Symbol.for(\n  'react.debug_trace_mode',\n);\nexport const REACT_OFFSCREEN_TYPE = Symbol.for('react.offscreen');\nexport const REACT_LEGACY_HIDDEN_TYPE = Symbol.for('react.legacy_hidden');\nexport const REACT_CACHE_TYPE = Symbol.for('react.cache');\nexport const REACT_TRACING_MARKER_TYPE = Symbol.for('react.tracing_marker');\nexport const REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED = Symbol.for(\n  'react.default_value',\n);\n\nconst MAYBE_ITERATOR_SYMBOL = Symbol.iterator;\nconst FAUX_ITERATOR_SYMBOL = '@@iterator';\n\nexport function getIteratorFn(maybeIterable: ?any): ?() => ?Iterator<*> {\n  if (maybeIterable === null || typeof maybeIterable !== 'object') {\n    return null;\n  }\n  const maybeIterator =\n    (MAYBE_ITERATOR_SYMBOL && maybeIterable[MAYBE_ITERATOR_SYMBOL]) ||\n    maybeIterable[FAUX_ITERATOR_SYMBOL];\n  if (typeof maybeIterator === 'function') {\n    return maybeIterator;\n  }\n  return null;\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {Writable} from 'stream';\nimport {TextEncoder} from 'util';\n\ntype MightBeFlushable = {\n  flush?: () => void,\n  ...\n};\n\nexport type Destination = Writable & MightBeFlushable;\n\nexport type PrecomputedChunk = Uint8Array;\nexport type Chunk = string;\n\nexport function scheduleWork(callback: () => void) {\n  setImmediate(callback);\n}\n\nexport function flushBuffered(destination: Destination) {\n  // If we don't have any more data to send right now.\n  // Flush whatever is in the buffer to the wire.\n  if (typeof destination.flush === 'function') {\n    // By convention the Zlib streams provide a flush function for this purpose.\n    // For Express, compression middleware adds this method.\n    destination.flush();\n  }\n}\n\nconst VIEW_SIZE = 2048;\nlet currentView = null;\nlet writtenBytes = 0;\nlet destinationHasCapacity = true;\n\nexport function beginWriting(destination: Destination) {\n  currentView = new Uint8Array(VIEW_SIZE);\n  writtenBytes = 0;\n  destinationHasCapacity = true;\n}\n\nfunction writeStringChunk(destination: Destination, stringChunk: string) {\n  if (stringChunk.length === 0) {\n    return;\n  }\n  // maximum possible view needed to encode entire string\n  if (stringChunk.length * 3 > VIEW_SIZE) {\n    if (writtenBytes > 0) {\n      writeToDestination(\n        destination,\n        ((currentView: any): Uint8Array).subarray(0, writtenBytes),\n      );\n      currentView = new Uint8Array(VIEW_SIZE);\n      writtenBytes = 0;\n    }\n    writeToDestination(destination, textEncoder.encode(stringChunk));\n    return;\n  }\n\n  let target: Uint8Array = (currentView: any);\n  if (writtenBytes > 0) {\n    target = ((currentView: any): Uint8Array).subarray(writtenBytes);\n  }\n  const {read, written} = textEncoder.encodeInto(stringChunk, target);\n  writtenBytes += written;\n\n  if (read < stringChunk.length) {\n    writeToDestination(destination, (currentView: any));\n    currentView = new Uint8Array(VIEW_SIZE);\n    writtenBytes = textEncoder.encodeInto(stringChunk.slice(read), currentView)\n      .written;\n  }\n\n  if (writtenBytes === VIEW_SIZE) {\n    writeToDestination(destination, (currentView: any));\n    currentView = new Uint8Array(VIEW_SIZE);\n    writtenBytes = 0;\n  }\n}\n\nfunction writeViewChunk(destination: Destination, chunk: PrecomputedChunk) {\n  if (chunk.byteLength === 0) {\n    return;\n  }\n  if (chunk.byteLength > VIEW_SIZE) {\n    // this chunk may overflow a single view which implies it was not\n    // one that is cached by the streaming renderer. We will enqueu\n    // it directly and expect it is not re-used\n    if (writtenBytes > 0) {\n      writeToDestination(\n        destination,\n        ((currentView: any): Uint8Array).subarray(0, writtenBytes),\n      );\n      currentView = new Uint8Array(VIEW_SIZE);\n      writtenBytes = 0;\n    }\n    writeToDestination(destination, chunk);\n    return;\n  }\n\n  let bytesToWrite = chunk;\n  const allowableBytes = ((currentView: any): Uint8Array).length - writtenBytes;\n  if (allowableBytes < bytesToWrite.byteLength) {\n    // this chunk would overflow the current view. We enqueue a full view\n    // and start a new view with the remaining chunk\n    if (allowableBytes === 0) {\n      // the current view is already full, send it\n      writeToDestination(destination, (currentView: any));\n    } else {\n      // fill up the current view and apply the remaining chunk bytes\n      // to a new view.\n      ((currentView: any): Uint8Array).set(\n        bytesToWrite.subarray(0, allowableBytes),\n        writtenBytes,\n      );\n      writtenBytes += allowableBytes;\n      writeToDestination(destination, (currentView: any));\n      bytesToWrite = bytesToWrite.subarray(allowableBytes);\n    }\n    currentView = new Uint8Array(VIEW_SIZE);\n    writtenBytes = 0;\n  }\n  ((currentView: any): Uint8Array).set(bytesToWrite, writtenBytes);\n  writtenBytes += bytesToWrite.byteLength;\n\n  if (writtenBytes === VIEW_SIZE) {\n    writeToDestination(destination, (currentView: any));\n    currentView = new Uint8Array(VIEW_SIZE);\n    writtenBytes = 0;\n  }\n}\n\nexport function writeChunk(\n  destination: Destination,\n  chunk: PrecomputedChunk | Chunk,\n): void {\n  if (typeof chunk === 'string') {\n    writeStringChunk(destination, chunk);\n  } else {\n    writeViewChunk(destination, ((chunk: any): PrecomputedChunk));\n  }\n}\n\nfunction writeToDestination(destination: Destination, view: Uint8Array) {\n  const currentHasCapacity = destination.write(view);\n  destinationHasCapacity = destinationHasCapacity && currentHasCapacity;\n}\n\nexport function writeChunkAndReturn(\n  destination: Destination,\n  chunk: PrecomputedChunk | Chunk,\n): boolean {\n  writeChunk(destination, chunk);\n  return destinationHasCapacity;\n}\n\nexport function completeWriting(destination: Destination) {\n  if (currentView && writtenBytes > 0) {\n    destination.write(currentView.subarray(0, writtenBytes));\n  }\n  currentView = null;\n  writtenBytes = 0;\n  destinationHasCapacity = true;\n}\n\nexport function close(destination: Destination) {\n  destination.end();\n}\n\nconst textEncoder = new TextEncoder();\n\nexport function stringToChunk(content: string): Chunk {\n  return content;\n}\n\nexport function stringToPrecomputedChunk(content: string): PrecomputedChunk {\n  return textEncoder.encode(content);\n}\n\nexport function closeWithError(destination: Destination, error: mixed): void {\n  // $FlowFixMe: This is an Error object or the destination accepts other types.\n  destination.destroy(error);\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {ReactNodeList} from 'shared/ReactTypes';\n\nimport type {\n  Destination,\n  Chunk,\n  PrecomputedChunk,\n} from 'react-server/src/ReactServerStreamConfig';\n\nimport {\n  writeChunk,\n  writeChunkAndReturn,\n  stringToChunk,\n  stringToPrecomputedChunk,\n} from 'react-server/src/ReactServerStreamConfig';\n\nexport const isPrimaryRenderer = true;\n\n// Every list of children or string is null terminated.\nconst END_TAG = 0;\n// Tree node tags.\nconst INSTANCE_TAG = 1;\nconst PLACEHOLDER_TAG = 2;\nconst SUSPENSE_PENDING_TAG = 3;\nconst SUSPENSE_COMPLETE_TAG = 4;\nconst SUSPENSE_CLIENT_RENDER_TAG = 5;\n// Command tags.\nconst SEGMENT_TAG = 1;\nconst SUSPENSE_UPDATE_TO_COMPLETE_TAG = 2;\nconst SUSPENSE_UPDATE_TO_CLIENT_RENDER_TAG = 3;\n\nconst END = new Uint8Array(1);\nEND[0] = END_TAG;\nconst PLACEHOLDER = new Uint8Array(1);\nPLACEHOLDER[0] = PLACEHOLDER_TAG;\nconst INSTANCE = new Uint8Array(1);\nINSTANCE[0] = INSTANCE_TAG;\nconst SUSPENSE_PENDING = new Uint8Array(1);\nSUSPENSE_PENDING[0] = SUSPENSE_PENDING_TAG;\nconst SUSPENSE_COMPLETE = new Uint8Array(1);\nSUSPENSE_COMPLETE[0] = SUSPENSE_COMPLETE_TAG;\nconst SUSPENSE_CLIENT_RENDER = new Uint8Array(1);\nSUSPENSE_CLIENT_RENDER[0] = SUSPENSE_CLIENT_RENDER_TAG;\n\nconst SEGMENT = new Uint8Array(1);\nSEGMENT[0] = SEGMENT_TAG;\nconst SUSPENSE_UPDATE_TO_COMPLETE = new Uint8Array(1);\nSUSPENSE_UPDATE_TO_COMPLETE[0] = SUSPENSE_UPDATE_TO_COMPLETE_TAG;\nconst SUSPENSE_UPDATE_TO_CLIENT_RENDER = new Uint8Array(1);\nSUSPENSE_UPDATE_TO_CLIENT_RENDER[0] = SUSPENSE_UPDATE_TO_CLIENT_RENDER_TAG;\n\n// Per response,\nexport type ResponseState = {\n  nextSuspenseID: number,\n};\n\n// Allows us to keep track of what we've already written so we can refer back to it.\nexport function createResponseState(): ResponseState {\n  return {\n    nextSuspenseID: 0,\n  };\n}\n\n// isInAParentText\nexport type FormatContext = boolean;\n\nexport function createRootFormatContext(): FormatContext {\n  return false;\n}\n\nexport function getChildFormatContext(\n  parentContext: FormatContext,\n  type: string,\n  props: Object,\n): FormatContext {\n  const prevIsInAParentText = parentContext;\n  const isInAParentText =\n    type === 'AndroidTextInput' || // Android\n    type === 'RCTMultilineTextInputView' || // iOS\n    type === 'RCTSinglelineTextInputView' || // iOS\n    type === 'RCTText' ||\n    type === 'RCTVirtualText';\n\n  if (prevIsInAParentText !== isInAParentText) {\n    return isInAParentText;\n  } else {\n    return parentContext;\n  }\n}\n\n// This object is used to lazily reuse the ID of the first generated node, or assign one.\n// This is very specific to DOM where we can't assign an ID to.\nexport type SuspenseBoundaryID = number;\n\nexport const UNINITIALIZED_SUSPENSE_BOUNDARY_ID = -1;\n\nexport function assignSuspenseBoundaryID(\n  responseState: ResponseState,\n): SuspenseBoundaryID {\n  return responseState.nextSuspenseID++;\n}\n\nexport function makeId(\n  responseState: ResponseState,\n  treeId: string,\n  localId: number,\n): string {\n  throw new Error('Not implemented');\n}\n\nconst RAW_TEXT = stringToPrecomputedChunk('RCTRawText');\n\nexport function pushTextInstance(\n  target: Array<Chunk | PrecomputedChunk>,\n  text: string,\n  responseState: ResponseState,\n  // This Renderer does not use this argument\n  textEmbedded: boolean,\n): boolean {\n  target.push(\n    INSTANCE,\n    RAW_TEXT, // Type\n    END, // Null terminated type string\n    // TODO: props { text: text }\n    END, // End of children\n  );\n  return false;\n}\n\nexport function pushStartInstance(\n  target: Array<Chunk | PrecomputedChunk>,\n  type: string,\n  props: Object,\n  responseState: ResponseState,\n  formatContext: FormatContext,\n): ReactNodeList {\n  target.push(\n    INSTANCE,\n    stringToChunk(type),\n    END, // Null terminated type string\n    // TODO: props\n  );\n  return props.children;\n}\n\nexport function pushEndInstance(\n  target: Array<Chunk | PrecomputedChunk>,\n  type: string,\n  props: Object,\n): void {\n  target.push(END);\n}\n\n// In this Renderer this is a noop\nexport function pushSegmentFinale(\n  target: Array<Chunk | PrecomputedChunk>,\n  responseState: ResponseState,\n  lastPushedText: boolean,\n  textEmbedded: boolean,\n): void {}\n\nexport function writeCompletedRoot(\n  destination: Destination,\n  responseState: ResponseState,\n): boolean {\n  return true;\n}\n\n// IDs are formatted as little endian Uint16\nfunction formatID(id: number): Uint8Array {\n  if (id > 0xffff) {\n    throw new Error(\n      'More boundaries or placeholders than we expected to ever emit.',\n    );\n  }\n  const buffer = new Uint8Array(2);\n  buffer[0] = (id >>> 8) & 0xff;\n  buffer[1] = id & 0xff;\n  return buffer;\n}\n\n// Structural Nodes\n\n// A placeholder is a node inside a hidden partial tree that can be filled in later, but before\n// display. It's never visible to users.\nexport function writePlaceholder(\n  destination: Destination,\n  responseState: ResponseState,\n  id: number,\n): boolean {\n  writeChunk(destination, PLACEHOLDER);\n  return writeChunkAndReturn(destination, formatID(id));\n}\n\n// Suspense boundaries are encoded as comments.\nexport function writeStartCompletedSuspenseBoundary(\n  destination: Destination,\n  responseState: ResponseState,\n): boolean {\n  return writeChunkAndReturn(destination, SUSPENSE_COMPLETE);\n}\n\nexport function pushStartCompletedSuspenseBoundary(\n  target: Array<Chunk | PrecomputedChunk>,\n): void {\n  target.push(SUSPENSE_COMPLETE);\n}\n\nexport function writeStartPendingSuspenseBoundary(\n  destination: Destination,\n  responseState: ResponseState,\n  id: SuspenseBoundaryID,\n): boolean {\n  writeChunk(destination, SUSPENSE_PENDING);\n  return writeChunkAndReturn(destination, formatID(id));\n}\nexport function writeStartClientRenderedSuspenseBoundary(\n  destination: Destination,\n  responseState: ResponseState,\n  // TODO: encode error for native\n  errorDigest: ?string,\n  errorMessage: ?string,\n  errorComponentStack: ?string,\n): boolean {\n  return writeChunkAndReturn(destination, SUSPENSE_CLIENT_RENDER);\n}\nexport function writeEndCompletedSuspenseBoundary(\n  destination: Destination,\n  responseState: ResponseState,\n): boolean {\n  return writeChunkAndReturn(destination, END);\n}\nexport function pushEndCompletedSuspenseBoundary(\n  target: Array<Chunk | PrecomputedChunk>,\n): void {\n  target.push(END);\n}\nexport function writeEndPendingSuspenseBoundary(\n  destination: Destination,\n  responseState: ResponseState,\n): boolean {\n  return writeChunkAndReturn(destination, END);\n}\nexport function writeEndClientRenderedSuspenseBoundary(\n  destination: Destination,\n  responseState: ResponseState,\n): boolean {\n  return writeChunkAndReturn(destination, END);\n}\n\nexport function writeStartSegment(\n  destination: Destination,\n  responseState: ResponseState,\n  formatContext: FormatContext,\n  id: number,\n): boolean {\n  writeChunk(destination, SEGMENT);\n  return writeChunkAndReturn(destination, formatID(id));\n}\nexport function writeEndSegment(\n  destination: Destination,\n  formatContext: FormatContext,\n): boolean {\n  return writeChunkAndReturn(destination, END);\n}\n\n// Instruction Set\n\nexport function writeCompletedSegmentInstruction(\n  destination: Destination,\n  responseState: ResponseState,\n  contentSegmentID: number,\n): boolean {\n  // We don't need to emit this. Instead the client will keep track of pending placeholders.\n  // TODO: Returning true here is not correct. Avoid having to call this function at all.\n  return true;\n}\n\nexport function writeCompletedBoundaryInstruction(\n  destination: Destination,\n  responseState: ResponseState,\n  boundaryID: SuspenseBoundaryID,\n  contentSegmentID: number,\n): boolean {\n  writeChunk(destination, SUSPENSE_UPDATE_TO_COMPLETE);\n  writeChunk(destination, formatID(boundaryID));\n  return writeChunkAndReturn(destination, formatID(contentSegmentID));\n}\n\nexport function writeClientRenderBoundaryInstruction(\n  destination: Destination,\n  responseState: ResponseState,\n  boundaryID: SuspenseBoundaryID,\n  // TODO: encode error for native\n  errorDigest: ?string,\n  errorMessage: ?string,\n  errorComponentStack: ?string,\n): boolean {\n  writeChunk(destination, SUSPENSE_UPDATE_TO_CLIENT_RENDER);\n  return writeChunkAndReturn(destination, formatID(boundaryID));\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {\n  ReactServerContext,\n  ServerContextJSONValue,\n} from 'shared/ReactTypes';\n\nimport {REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED} from 'shared/ReactSymbols';\nimport {isPrimaryRenderer} from './ReactServerFormatConfig';\n\nlet rendererSigil;\nif (__DEV__) {\n  // Use this to detect multiple renderers using the same context\n  rendererSigil = {};\n}\n\n// Used to store the parent path of all context overrides in a shared linked list.\n// Forming a reverse tree.\ntype ContextNode<T: ServerContextJSONValue> = {\n  parent: null | ContextNode<any>,\n  depth: number, // Short hand to compute the depth of the tree at this node.\n  context: ReactServerContext<T>,\n  parentValue: T,\n  value: T,\n};\n\n// The structure of a context snapshot is an implementation of this file.\n// Currently, it's implemented as tracking the current active node.\nexport opaque type ContextSnapshot = null | ContextNode<any>;\n\nexport const rootContextSnapshot: ContextSnapshot = null;\n\n// We assume that this runtime owns the \"current\" field on all ReactContext instances.\n// This global (actually thread local) state represents what state all those \"current\",\n// fields are currently in.\nlet currentActiveSnapshot: ContextSnapshot = null;\n\nfunction popNode(prev: ContextNode<any>): void {\n  if (isPrimaryRenderer) {\n    prev.context._currentValue = prev.parentValue;\n  } else {\n    prev.context._currentValue2 = prev.parentValue;\n  }\n}\n\nfunction pushNode(next: ContextNode<any>): void {\n  if (isPrimaryRenderer) {\n    next.context._currentValue = next.value;\n  } else {\n    next.context._currentValue2 = next.value;\n  }\n}\n\nfunction popToNearestCommonAncestor(\n  prev: ContextNode<any>,\n  next: ContextNode<any>,\n): void {\n  if (prev === next) {\n    // We've found a shared ancestor. We don't need to pop nor reapply this one or anything above.\n  } else {\n    popNode(prev);\n    const parentPrev = prev.parent;\n    const parentNext = next.parent;\n    if (parentPrev === null) {\n      if (parentNext !== null) {\n        throw new Error(\n          'The stacks must reach the root at the same time. This is a bug in React.',\n        );\n      }\n    } else {\n      if (parentNext === null) {\n        throw new Error(\n          'The stacks must reach the root at the same time. This is a bug in React.',\n        );\n      }\n\n      popToNearestCommonAncestor(parentPrev, parentNext);\n      // On the way back, we push the new ones that weren't common.\n      pushNode(next);\n    }\n  }\n}\n\nfunction popAllPrevious(prev: ContextNode<any>): void {\n  popNode(prev);\n  const parentPrev = prev.parent;\n  if (parentPrev !== null) {\n    popAllPrevious(parentPrev);\n  }\n}\n\nfunction pushAllNext(next: ContextNode<any>): void {\n  const parentNext = next.parent;\n  if (parentNext !== null) {\n    pushAllNext(parentNext);\n  }\n  pushNode(next);\n}\n\nfunction popPreviousToCommonLevel(\n  prev: ContextNode<any>,\n  next: ContextNode<any>,\n): void {\n  popNode(prev);\n  const parentPrev = prev.parent;\n\n  if (parentPrev === null) {\n    throw new Error(\n      'The depth must equal at least at zero before reaching the root. This is a bug in React.',\n    );\n  }\n\n  if (parentPrev.depth === next.depth) {\n    // We found the same level. Now we just need to find a shared ancestor.\n    popToNearestCommonAncestor(parentPrev, next);\n  } else {\n    // We must still be deeper.\n    popPreviousToCommonLevel(parentPrev, next);\n  }\n}\n\nfunction popNextToCommonLevel(\n  prev: ContextNode<any>,\n  next: ContextNode<any>,\n): void {\n  const parentNext = next.parent;\n\n  if (parentNext === null) {\n    throw new Error(\n      'The depth must equal at least at zero before reaching the root. This is a bug in React.',\n    );\n  }\n\n  if (prev.depth === parentNext.depth) {\n    // We found the same level. Now we just need to find a shared ancestor.\n    popToNearestCommonAncestor(prev, parentNext);\n  } else {\n    // We must still be deeper.\n    popNextToCommonLevel(prev, parentNext);\n  }\n  pushNode(next);\n}\n\n// Perform context switching to the new snapshot.\n// To make it cheap to read many contexts, while not suspending, we make the switch eagerly by\n// updating all the context's current values. That way reads, always just read the current value.\n// At the cost of updating contexts even if they're never read by this subtree.\nexport function switchContext(newSnapshot: ContextSnapshot): void {\n  // The basic algorithm we need to do is to pop back any contexts that are no longer on the stack.\n  // We also need to update any new contexts that are now on the stack with the deepest value.\n  // The easiest way to update new contexts is to just reapply them in reverse order from the\n  // perspective of the backpointers. To avoid allocating a lot when switching, we use the stack\n  // for that. Therefore this algorithm is recursive.\n  // 1) First we pop which ever snapshot tree was deepest. Popping old contexts as we go.\n  // 2) Then we find the nearest common ancestor from there. Popping old contexts as we go.\n  // 3) Then we reapply new contexts on the way back up the stack.\n  const prev = currentActiveSnapshot;\n  const next = newSnapshot;\n  if (prev !== next) {\n    if (prev === null) {\n      // $FlowFixMe: This has to be non-null since it's not equal to prev.\n      pushAllNext(next);\n    } else if (next === null) {\n      popAllPrevious(prev);\n    } else if (prev.depth === next.depth) {\n      popToNearestCommonAncestor(prev, next);\n    } else if (prev.depth > next.depth) {\n      popPreviousToCommonLevel(prev, next);\n    } else {\n      popNextToCommonLevel(prev, next);\n    }\n    currentActiveSnapshot = next;\n  }\n}\n\nexport function pushProvider<T: ServerContextJSONValue>(\n  context: ReactServerContext<T>,\n  nextValue: T,\n): ContextSnapshot {\n  let prevValue;\n  if (isPrimaryRenderer) {\n    prevValue = context._currentValue;\n    context._currentValue = nextValue;\n    if (__DEV__) {\n      if (\n        context._currentRenderer !== undefined &&\n        context._currentRenderer !== null &&\n        context._currentRenderer !== rendererSigil\n      ) {\n        console.error(\n          'Detected multiple renderers concurrently rendering the ' +\n            'same context provider. This is currently unsupported.',\n        );\n      }\n      context._currentRenderer = rendererSigil;\n    }\n  } else {\n    prevValue = context._currentValue2;\n    context._currentValue2 = nextValue;\n    if (__DEV__) {\n      if (\n        context._currentRenderer2 !== undefined &&\n        context._currentRenderer2 !== null &&\n        context._currentRenderer2 !== rendererSigil\n      ) {\n        console.error(\n          'Detected multiple renderers concurrently rendering the ' +\n            'same context provider. This is currently unsupported.',\n        );\n      }\n      context._currentRenderer2 = rendererSigil;\n    }\n  }\n  const prevNode = currentActiveSnapshot;\n  const newNode: ContextNode<T> = {\n    parent: prevNode,\n    depth: prevNode === null ? 0 : prevNode.depth + 1,\n    context: context,\n    parentValue: prevValue,\n    value: nextValue,\n  };\n  currentActiveSnapshot = newNode;\n  return newNode;\n}\n\nexport function popProvider(): ContextSnapshot {\n  const prevSnapshot = currentActiveSnapshot;\n\n  if (prevSnapshot === null) {\n    throw new Error(\n      'Tried to pop a Context at the root of the app. This is a bug in React.',\n    );\n  }\n\n  if (isPrimaryRenderer) {\n    const value = prevSnapshot.parentValue;\n    if (value === REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED) {\n      prevSnapshot.context._currentValue = prevSnapshot.context._defaultValue;\n    } else {\n      prevSnapshot.context._currentValue = value;\n    }\n  } else {\n    const value = prevSnapshot.parentValue;\n    if (value === REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED) {\n      prevSnapshot.context._currentValue2 = prevSnapshot.context._defaultValue;\n    } else {\n      prevSnapshot.context._currentValue2 = value;\n    }\n  }\n  return (currentActiveSnapshot = prevSnapshot.parent);\n}\n\nexport function getActiveContext(): ContextSnapshot {\n  return currentActiveSnapshot;\n}\n\nexport function readContext<T>(context: ReactServerContext<T>): T {\n  const value = isPrimaryRenderer\n    ? context._currentValue\n    : context._currentValue2;\n  return value;\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {Dispatcher as DispatcherType} from 'react-reconciler/src/ReactInternalTypes';\nimport type {Request} from './ReactFlightServer';\nimport type {ReactServerContext} from 'shared/ReactTypes';\nimport {REACT_SERVER_CONTEXT_TYPE} from 'shared/ReactSymbols';\nimport {readContext as readContextImpl} from './ReactFlightNewContext';\n\nlet currentRequest = null;\n\nexport function prepareToUseHooksForRequest(request: Request) {\n  currentRequest = request;\n}\n\nexport function resetHooksForRequest() {\n  currentRequest = null;\n}\n\nfunction readContext<T>(context: ReactServerContext<T>): T {\n  if (__DEV__) {\n    if (context.$$typeof !== REACT_SERVER_CONTEXT_TYPE) {\n      console.error('Only ServerContext is supported in Flight');\n    }\n    if (currentCache === null) {\n      console.error(\n        'Context can only be read while React is rendering. ' +\n          'In classes, you can read it in the render method or getDerivedStateFromProps. ' +\n          'In function components, you can read it directly in the function body, but not ' +\n          'inside Hooks like useReducer() or useMemo().',\n      );\n    }\n  }\n  return readContextImpl(context);\n}\n\nexport const Dispatcher: DispatcherType = {\n  useMemo<T>(nextCreate: () => T): T {\n    return nextCreate();\n  },\n  useCallback<T>(callback: T): T {\n    return callback;\n  },\n  useDebugValue(): void {},\n  useDeferredValue: (unsupportedHook: any),\n  useTransition: (unsupportedHook: any),\n  getCacheForType<T>(resourceType: () => T): T {\n    if (!currentCache) {\n      throw new Error('Reading the cache is only supported while rendering.');\n    }\n\n    let entry: T | void = (currentCache.get(resourceType): any);\n    if (entry === undefined) {\n      entry = resourceType();\n      // TODO: Warn if undefined?\n      currentCache.set(resourceType, entry);\n    }\n    return entry;\n  },\n  readContext,\n  useContext: readContext,\n  useReducer: (unsupportedHook: any),\n  useRef: (unsupportedHook: any),\n  useState: (unsupportedHook: any),\n  useInsertionEffect: (unsupportedHook: any),\n  useLayoutEffect: (unsupportedHook: any),\n  useImperativeHandle: (unsupportedHook: any),\n  useEffect: (unsupportedHook: any),\n  useId,\n  useMutableSource: (unsupportedHook: any),\n  useSyncExternalStore: (unsupportedHook: any),\n  useCacheRefresh(): <T>(?() => T, ?T) => void {\n    return unsupportedRefresh;\n  },\n};\n\nfunction unsupportedHook(): void {\n  throw new Error('This Hook is not supported in Server Components.');\n}\n\nfunction unsupportedRefresh(): void {\n  if (!currentCache) {\n    throw new Error(\n      'Refreshing the cache is not supported in Server Components.',\n    );\n  }\n}\n\nlet currentCache: Map<Function, mixed> | null = null;\n\nexport function setCurrentCache(cache: Map<Function, mixed> | null) {\n  currentCache = cache;\n  return currentCache;\n}\n\nexport function getCurrentCache() {\n  return currentCache;\n}\n\nfunction useId(): string {\n  if (currentRequest === null) {\n    throw new Error('useId can only be used while React is rendering');\n  }\n  const id = currentRequest.identifierCount++;\n  // use 'S' for Flight components to distinguish from 'R' and 'r' in Fizz/Client\n  return ':' + currentRequest.identifierPrefix + 'S' + id.toString(32) + ':';\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\n\nconst ReactSharedInternals =\n  React.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n\nexport default ReactSharedInternals;\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport {REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED} from 'shared/ReactSymbols';\nimport ReactSharedInternals from 'shared/ReactSharedInternals';\nimport {createServerContext} from 'react';\n\nconst ContextRegistry = ReactSharedInternals.ContextRegistry;\n\nexport function getOrCreateServerContext(globalName: string) {\n  if (!ContextRegistry[globalName]) {\n    ContextRegistry[globalName] = createServerContext(\n      globalName,\n      REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED,\n    );\n  }\n  return ContextRegistry[globalName];\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {\n  Destination,\n  Chunk,\n  BundlerConfig,\n  ModuleMetaData,\n  ModuleReference,\n  ModuleKey,\n} from './ReactFlightServerConfig';\nimport type {ContextSnapshot} from './ReactFlightNewContext';\nimport type {\n  ReactProviderType,\n  ServerContextJSONValue,\n} from 'shared/ReactTypes';\n\nimport {\n  scheduleWork,\n  beginWriting,\n  writeChunkAndReturn,\n  completeWriting,\n  flushBuffered,\n  close,\n  closeWithError,\n  processModelChunk,\n  processModuleChunk,\n  processProviderChunk,\n  processSymbolChunk,\n  processErrorChunk,\n  resolveModuleMetaData,\n  getModuleKey,\n  isModuleReference,\n} from './ReactFlightServerConfig';\n\nimport {\n  Dispatcher,\n  getCurrentCache,\n  prepareToUseHooksForRequest,\n  resetHooksForRequest,\n  setCurrentCache,\n} from './ReactFlightHooks';\nimport {\n  pushProvider,\n  popProvider,\n  switchContext,\n  getActiveContext,\n  rootContextSnapshot,\n} from './ReactFlightNewContext';\n\nimport {\n  REACT_ELEMENT_TYPE,\n  REACT_FORWARD_REF_TYPE,\n  REACT_FRAGMENT_TYPE,\n  REACT_LAZY_TYPE,\n  REACT_MEMO_TYPE,\n  REACT_PROVIDER_TYPE,\n} from 'shared/ReactSymbols';\n\nimport {getOrCreateServerContext} from 'shared/ReactServerContextRegistry';\nimport ReactSharedInternals from 'shared/ReactSharedInternals';\nimport isArray from 'shared/isArray';\n\ntype ReactJSONValue =\n  | string\n  | boolean\n  | number\n  | null\n  | $ReadOnlyArray<ReactJSONValue>\n  | ReactModelObject;\n\nexport type ReactModel =\n  | React$Element<any>\n  | string\n  | boolean\n  | number\n  | null\n  | Iterable<ReactModel>\n  | ReactModelObject;\n\ntype ReactModelObject = {+[key: string]: ReactModel};\n\ntype Segment = {\n  id: number,\n  model: ReactModel,\n  ping: () => void,\n  context: ContextSnapshot,\n};\n\nexport type Request = {\n  status: 0 | 1 | 2,\n  fatalError: mixed,\n  destination: null | Destination,\n  bundlerConfig: BundlerConfig,\n  cache: Map<Function, mixed>,\n  nextChunkId: number,\n  pendingChunks: number,\n  pingedSegments: Array<Segment>,\n  completedModuleChunks: Array<Chunk>,\n  completedJSONChunks: Array<Chunk>,\n  completedErrorChunks: Array<Chunk>,\n  writtenSymbols: Map<Symbol, number>,\n  writtenModules: Map<ModuleKey, number>,\n  writtenProviders: Map<string, number>,\n  identifierPrefix: string,\n  identifierCount: number,\n  onError: (error: mixed) => void,\n  toJSON: (key: string, value: ReactModel) => ReactJSONValue,\n};\n\nconst ReactCurrentDispatcher = ReactSharedInternals.ReactCurrentDispatcher;\n\nfunction defaultErrorHandler(error: mixed) {\n  console['error'](error);\n  // Don't transform to our wrapper\n}\n\nconst OPEN = 0;\nconst CLOSING = 1;\nconst CLOSED = 2;\n\nexport function createRequest(\n  model: ReactModel,\n  bundlerConfig: BundlerConfig,\n  onError: void | ((error: mixed) => void),\n  context?: Array<[string, ServerContextJSONValue]>,\n  identifierPrefix?: string,\n): Request {\n  const pingedSegments = [];\n  const request = {\n    status: OPEN,\n    fatalError: null,\n    destination: null,\n    bundlerConfig,\n    cache: new Map(),\n    nextChunkId: 0,\n    pendingChunks: 0,\n    pingedSegments: pingedSegments,\n    completedModuleChunks: [],\n    completedJSONChunks: [],\n    completedErrorChunks: [],\n    writtenSymbols: new Map(),\n    writtenModules: new Map(),\n    writtenProviders: new Map(),\n    identifierPrefix: identifierPrefix || '',\n    identifierCount: 1,\n    onError: onError === undefined ? defaultErrorHandler : onError,\n    toJSON: function(key: string, value: ReactModel): ReactJSONValue {\n      return resolveModelToJSON(request, this, key, value);\n    },\n  };\n  request.pendingChunks++;\n  const rootContext = createRootContext(context);\n  const rootSegment = createSegment(request, model, rootContext);\n  pingedSegments.push(rootSegment);\n  return request;\n}\n\nfunction createRootContext(\n  reqContext?: Array<[string, ServerContextJSONValue]>,\n) {\n  return importServerContexts(reqContext);\n}\n\nconst POP = {};\n\nfunction attemptResolveElement(\n  type: any,\n  key: null | React$Key,\n  ref: mixed,\n  props: any,\n): ReactModel {\n  if (ref !== null && ref !== undefined) {\n    // When the ref moves to the regular props object this will implicitly\n    // throw for functions. We could probably relax it to a DEV warning for other\n    // cases.\n    throw new Error(\n      'Refs cannot be used in server components, nor passed to client components.',\n    );\n  }\n  if (typeof type === 'function') {\n    // This is a server-side component.\n    return type(props);\n  } else if (typeof type === 'string') {\n    // This is a host element. E.g. HTML.\n    return [REACT_ELEMENT_TYPE, type, key, props];\n  } else if (typeof type === 'symbol') {\n    if (type === REACT_FRAGMENT_TYPE) {\n      // For key-less fragments, we add a small optimization to avoid serializing\n      // it as a wrapper.\n      // TODO: If a key is specified, we should propagate its key to any children.\n      // Same as if a server component has a key.\n      return props.children;\n    }\n    // This might be a built-in React component. We'll let the client decide.\n    // Any built-in works as long as its props are serializable.\n    return [REACT_ELEMENT_TYPE, type, key, props];\n  } else if (type != null && typeof type === 'object') {\n    if (isModuleReference(type)) {\n      // This is a reference to a client component.\n      return [REACT_ELEMENT_TYPE, type, key, props];\n    }\n    switch (type.$$typeof) {\n      case REACT_LAZY_TYPE: {\n        const payload = type._payload;\n        const init = type._init;\n        const wrappedType = init(payload);\n        return attemptResolveElement(wrappedType, key, ref, props);\n      }\n      case REACT_FORWARD_REF_TYPE: {\n        const render = type.render;\n        return render(props, undefined);\n      }\n      case REACT_MEMO_TYPE: {\n        return attemptResolveElement(type.type, key, ref, props);\n      }\n      case REACT_PROVIDER_TYPE: {\n        pushProvider(type._context, props.value);\n        if (__DEV__) {\n          const extraKeys = Object.keys(props).filter(value => {\n            if (value === 'children' || value === 'value') {\n              return false;\n            }\n            return true;\n          });\n          if (extraKeys.length !== 0) {\n            console.error(\n              'ServerContext can only have a value prop and children. Found: %s',\n              JSON.stringify(extraKeys),\n            );\n          }\n        }\n        return [\n          REACT_ELEMENT_TYPE,\n          type,\n          key,\n          // Rely on __popProvider being serialized last to pop the provider.\n          {value: props.value, children: props.children, __pop: POP},\n        ];\n      }\n    }\n  }\n  throw new Error(\n    `Unsupported server component type: ${describeValueForErrorMessage(type)}`,\n  );\n}\n\nfunction pingSegment(request: Request, segment: Segment): void {\n  const pingedSegments = request.pingedSegments;\n  pingedSegments.push(segment);\n  if (pingedSegments.length === 1) {\n    scheduleWork(() => performWork(request));\n  }\n}\n\nfunction createSegment(\n  request: Request,\n  model: ReactModel,\n  context: ContextSnapshot,\n): Segment {\n  const id = request.nextChunkId++;\n  const segment = {\n    id,\n    model,\n    context,\n    ping: () => pingSegment(request, segment),\n  };\n  return segment;\n}\n\nfunction serializeByValueID(id: number): string {\n  return '$' + id.toString(16);\n}\n\nfunction serializeByRefID(id: number): string {\n  return '@' + id.toString(16);\n}\n\nfunction escapeStringValue(value: string): string {\n  if (value[0] === '$' || value[0] === '@') {\n    // We need to escape $ or @ prefixed strings since we use those to encode\n    // references to IDs and as special symbol values.\n    return '$' + value;\n  } else {\n    return value;\n  }\n}\n\nfunction isObjectPrototype(object): boolean {\n  if (!object) {\n    return false;\n  }\n  const ObjectPrototype = Object.prototype;\n  if (object === ObjectPrototype) {\n    return true;\n  }\n  // It might be an object from a different Realm which is\n  // still just a plain simple object.\n  if (Object.getPrototypeOf(object)) {\n    return false;\n  }\n  const names = Object.getOwnPropertyNames(object);\n  for (let i = 0; i < names.length; i++) {\n    if (!(names[i] in ObjectPrototype)) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction isSimpleObject(object): boolean {\n  if (!isObjectPrototype(Object.getPrototypeOf(object))) {\n    return false;\n  }\n  const names = Object.getOwnPropertyNames(object);\n  for (let i = 0; i < names.length; i++) {\n    const descriptor = Object.getOwnPropertyDescriptor(object, names[i]);\n    if (!descriptor) {\n      return false;\n    }\n    if (!descriptor.enumerable) {\n      if (\n        (names[i] === 'key' || names[i] === 'ref') &&\n        typeof descriptor.get === 'function'\n      ) {\n        // React adds key and ref getters to props objects to issue warnings.\n        // Those getters will not be transferred to the client, but that's ok,\n        // so we'll special case them.\n        continue;\n      }\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction objectName(object): string {\n  const name = Object.prototype.toString.call(object);\n  return name.replace(/^\\[object (.*)\\]$/, function(m, p0) {\n    return p0;\n  });\n}\n\nfunction describeKeyForErrorMessage(key: string): string {\n  const encodedKey = JSON.stringify(key);\n  return '\"' + key + '\"' === encodedKey ? key : encodedKey;\n}\n\nfunction describeValueForErrorMessage(value: ReactModel): string {\n  switch (typeof value) {\n    case 'string': {\n      return JSON.stringify(\n        value.length <= 10 ? value : value.substr(0, 10) + '...',\n      );\n    }\n    case 'object': {\n      if (isArray(value)) {\n        return '[...]';\n      }\n      const name = objectName(value);\n      if (name === 'Object') {\n        return '{...}';\n      }\n      return name;\n    }\n    case 'function':\n      return 'function';\n    default:\n      // eslint-disable-next-line react-internal/safe-string-coercion\n      return String(value);\n  }\n}\n\nfunction describeObjectForErrorMessage(\n  objectOrArray:\n    | {+[key: string | number]: ReactModel}\n    | $ReadOnlyArray<ReactModel>,\n  expandedName?: string,\n): string {\n  if (isArray(objectOrArray)) {\n    let str = '[';\n    const array: $ReadOnlyArray<ReactModel> = objectOrArray;\n    for (let i = 0; i < array.length; i++) {\n      if (i > 0) {\n        str += ', ';\n      }\n      if (i > 6) {\n        str += '...';\n        break;\n      }\n      const value = array[i];\n      if (\n        '' + i === expandedName &&\n        typeof value === 'object' &&\n        value !== null\n      ) {\n        str += describeObjectForErrorMessage(value);\n      } else {\n        str += describeValueForErrorMessage(value);\n      }\n    }\n    str += ']';\n    return str;\n  } else {\n    let str = '{';\n    const object: {+[key: string | number]: ReactModel} = objectOrArray;\n    const names = Object.keys(object);\n    for (let i = 0; i < names.length; i++) {\n      if (i > 0) {\n        str += ', ';\n      }\n      if (i > 6) {\n        str += '...';\n        break;\n      }\n      const name = names[i];\n      str += describeKeyForErrorMessage(name) + ': ';\n      const value = object[name];\n      if (\n        name === expandedName &&\n        typeof value === 'object' &&\n        value !== null\n      ) {\n        str += describeObjectForErrorMessage(value);\n      } else {\n        str += describeValueForErrorMessage(value);\n      }\n    }\n    str += '}';\n    return str;\n  }\n}\n\nlet insideContextProps = null;\nlet isInsideContextValue = false;\n\nexport function resolveModelToJSON(\n  request: Request,\n  parent: {+[key: string | number]: ReactModel} | $ReadOnlyArray<ReactModel>,\n  key: string,\n  value: ReactModel,\n): ReactJSONValue {\n  if (__DEV__) {\n    // $FlowFixMe\n    const originalValue = parent[key];\n    if (typeof originalValue === 'object' && originalValue !== value) {\n      console.error(\n        'Only plain objects can be passed to client components from server components. ' +\n          'Objects with toJSON methods are not supported. Convert it manually ' +\n          'to a simple value before passing it to props. ' +\n          'Remove %s from these props: %s',\n        describeKeyForErrorMessage(key),\n        describeObjectForErrorMessage(parent),\n      );\n    }\n  }\n\n  // Special Symbols\n  switch (value) {\n    case REACT_ELEMENT_TYPE:\n      return '$';\n  }\n\n  if (__DEV__) {\n    if (\n      parent[0] === REACT_ELEMENT_TYPE &&\n      parent[1] &&\n      parent[1].$$typeof === REACT_PROVIDER_TYPE &&\n      key === '3'\n    ) {\n      insideContextProps = value;\n    } else if (insideContextProps === parent && key === 'value') {\n      isInsideContextValue = true;\n    } else if (insideContextProps === parent && key === 'children') {\n      isInsideContextValue = false;\n    }\n  }\n\n  // Resolve server components.\n  while (\n    typeof value === 'object' &&\n    value !== null &&\n    ((value: any).$$typeof === REACT_ELEMENT_TYPE ||\n      (value: any).$$typeof === REACT_LAZY_TYPE)\n  ) {\n    if (__DEV__) {\n      if (isInsideContextValue) {\n        console.error('React elements are not allowed in ServerContext');\n      }\n    }\n\n    try {\n      switch ((value: any).$$typeof) {\n        case REACT_ELEMENT_TYPE: {\n          // TODO: Concatenate keys of parents onto children.\n          const element: React$Element<any> = (value: any);\n          // Attempt to render the server component.\n          value = attemptResolveElement(\n            element.type,\n            element.key,\n            element.ref,\n            element.props,\n          );\n          break;\n        }\n        case REACT_LAZY_TYPE: {\n          const payload = (value: any)._payload;\n          const init = (value: any)._init;\n          value = init(payload);\n          break;\n        }\n      }\n    } catch (x) {\n      if (typeof x === 'object' && x !== null && typeof x.then === 'function') {\n        // Something suspended, we'll need to create a new segment and resolve it later.\n        request.pendingChunks++;\n        const newSegment = createSegment(request, value, getActiveContext());\n        const ping = newSegment.ping;\n        x.then(ping, ping);\n        return serializeByRefID(newSegment.id);\n      } else {\n        logRecoverableError(request, x);\n        // Something errored. We'll still send everything we have up until this point.\n        // We'll replace this element with a lazy reference that throws on the client\n        // once it gets rendered.\n        request.pendingChunks++;\n        const errorId = request.nextChunkId++;\n        emitErrorChunk(request, errorId, x);\n        return serializeByRefID(errorId);\n      }\n    }\n  }\n\n  if (value === null) {\n    return null;\n  }\n\n  if (typeof value === 'object') {\n    if (isModuleReference(value)) {\n      const moduleReference: ModuleReference<any> = (value: any);\n      const moduleKey: ModuleKey = getModuleKey(moduleReference);\n      const writtenModules = request.writtenModules;\n      const existingId = writtenModules.get(moduleKey);\n      if (existingId !== undefined) {\n        if (parent[0] === REACT_ELEMENT_TYPE && key === '1') {\n          // If we're encoding the \"type\" of an element, we can refer\n          // to that by a lazy reference instead of directly since React\n          // knows how to deal with lazy values. This lets us suspend\n          // on this component rather than its parent until the code has\n          // loaded.\n          return serializeByRefID(existingId);\n        }\n        return serializeByValueID(existingId);\n      }\n      try {\n        const moduleMetaData: ModuleMetaData = resolveModuleMetaData(\n          request.bundlerConfig,\n          moduleReference,\n        );\n        request.pendingChunks++;\n        const moduleId = request.nextChunkId++;\n        emitModuleChunk(request, moduleId, moduleMetaData);\n        writtenModules.set(moduleKey, moduleId);\n        if (parent[0] === REACT_ELEMENT_TYPE && key === '1') {\n          // If we're encoding the \"type\" of an element, we can refer\n          // to that by a lazy reference instead of directly since React\n          // knows how to deal with lazy values. This lets us suspend\n          // on this component rather than its parent until the code has\n          // loaded.\n          return serializeByRefID(moduleId);\n        }\n        return serializeByValueID(moduleId);\n      } catch (x) {\n        request.pendingChunks++;\n        const errorId = request.nextChunkId++;\n        emitErrorChunk(request, errorId, x);\n        return serializeByValueID(errorId);\n      }\n    } else if ((value: any).$$typeof === REACT_PROVIDER_TYPE) {\n      const providerKey = ((value: any): ReactProviderType<any>)._context\n        ._globalName;\n      const writtenProviders = request.writtenProviders;\n      let providerId = writtenProviders.get(key);\n      if (providerId === undefined) {\n        request.pendingChunks++;\n        providerId = request.nextChunkId++;\n        writtenProviders.set(providerKey, providerId);\n        emitProviderChunk(request, providerId, providerKey);\n      }\n      return serializeByValueID(providerId);\n    } else if (value === POP) {\n      popProvider();\n      if (__DEV__) {\n        insideContextProps = null;\n        isInsideContextValue = false;\n      }\n      return (undefined: any);\n    }\n\n    if (__DEV__) {\n      if (value !== null && !isArray(value)) {\n        // Verify that this is a simple plain object.\n        if (objectName(value) !== 'Object') {\n          console.error(\n            'Only plain objects can be passed to client components from server components. ' +\n              'Built-ins like %s are not supported. ' +\n              'Remove %s from these props: %s',\n            objectName(value),\n            describeKeyForErrorMessage(key),\n            describeObjectForErrorMessage(parent),\n          );\n        } else if (!isSimpleObject(value)) {\n          console.error(\n            'Only plain objects can be passed to client components from server components. ' +\n              'Classes or other objects with methods are not supported. ' +\n              'Remove %s from these props: %s',\n            describeKeyForErrorMessage(key),\n            describeObjectForErrorMessage(parent, key),\n          );\n        } else if (Object.getOwnPropertySymbols) {\n          const symbols = Object.getOwnPropertySymbols(value);\n          if (symbols.length > 0) {\n            console.error(\n              'Only plain objects can be passed to client components from server components. ' +\n                'Objects with symbol properties like %s are not supported. ' +\n                'Remove %s from these props: %s',\n              symbols[0].description,\n              describeKeyForErrorMessage(key),\n              describeObjectForErrorMessage(parent, key),\n            );\n          }\n        }\n      }\n    }\n\n    return value;\n  }\n\n  if (typeof value === 'string') {\n    return escapeStringValue(value);\n  }\n\n  if (\n    typeof value === 'boolean' ||\n    typeof value === 'number' ||\n    typeof value === 'undefined'\n  ) {\n    return value;\n  }\n\n  if (typeof value === 'function') {\n    if (/^on[A-Z]/.test(key)) {\n      throw new Error(\n        'Event handlers cannot be passed to client component props. ' +\n          `Remove ${describeKeyForErrorMessage(\n            key,\n          )} from these props if possible: ${describeObjectForErrorMessage(\n            parent,\n          )}\n` +\n          'If you need interactivity, consider converting part of this to a client component.',\n      );\n    } else {\n      throw new Error(\n        'Functions cannot be passed directly to client components ' +\n          \"because they're not serializable. \" +\n          `Remove ${describeKeyForErrorMessage(key)} (${value.displayName ||\n            value.name ||\n            'function'}) from this object, or avoid the entire object: ${describeObjectForErrorMessage(\n            parent,\n          )}`,\n      );\n    }\n  }\n\n  if (typeof value === 'symbol') {\n    const writtenSymbols = request.writtenSymbols;\n    const existingId = writtenSymbols.get(value);\n    if (existingId !== undefined) {\n      return serializeByValueID(existingId);\n    }\n    const name = value.description;\n\n    if (Symbol.for(name) !== value) {\n      throw new Error(\n        'Only global symbols received from Symbol.for(...) can be passed to client components. ' +\n          `The symbol Symbol.for(${value.description}) cannot be found among global symbols. ` +\n          `Remove ${describeKeyForErrorMessage(\n            key,\n          )} from this object, or avoid the entire object: ${describeObjectForErrorMessage(\n            parent,\n          )}`,\n      );\n    }\n\n    request.pendingChunks++;\n    const symbolId = request.nextChunkId++;\n    emitSymbolChunk(request, symbolId, name);\n    writtenSymbols.set(value, symbolId);\n    return serializeByValueID(symbolId);\n  }\n\n  // $FlowFixMe: bigint isn't added to Flow yet.\n  if (typeof value === 'bigint') {\n    throw new Error(\n      `BigInt (${value}) is not yet supported in client component props. ` +\n        `Remove ${describeKeyForErrorMessage(\n          key,\n        )} from this object or use a plain number instead: ${describeObjectForErrorMessage(\n          parent,\n        )}`,\n    );\n  }\n\n  throw new Error(\n    `Type ${typeof value} is not supported in client component props. ` +\n      `Remove ${describeKeyForErrorMessage(\n        key,\n      )} from this object, or avoid the entire object: ${describeObjectForErrorMessage(\n        parent,\n      )}`,\n  );\n}\n\nfunction logRecoverableError(request: Request, error: mixed): void {\n  const onError = request.onError;\n  onError(error);\n}\n\nfunction fatalError(request: Request, error: mixed): void {\n  // This is called outside error handling code such as if an error happens in React internals.\n  if (request.destination !== null) {\n    request.status = CLOSED;\n    closeWithError(request.destination, error);\n  } else {\n    request.status = CLOSING;\n    request.fatalError = error;\n  }\n}\n\nfunction emitErrorChunk(request: Request, id: number, error: mixed): void {\n  // TODO: We should not leak error messages to the client in prod.\n  // Give this an error code instead and log on the server.\n  // We can serialize the error in DEV as a convenience.\n  let message;\n  let stack = '';\n  try {\n    if (error instanceof Error) {\n      // eslint-disable-next-line react-internal/safe-string-coercion\n      message = String(error.message);\n      // eslint-disable-next-line react-internal/safe-string-coercion\n      stack = String(error.stack);\n    } else {\n      message = 'Error: ' + (error: any);\n    }\n  } catch (x) {\n    message = 'An error occurred but serializing the error message failed.';\n  }\n\n  const processedChunk = processErrorChunk(request, id, message, stack);\n  request.completedErrorChunks.push(processedChunk);\n}\n\nfunction emitModuleChunk(\n  request: Request,\n  id: number,\n  moduleMetaData: ModuleMetaData,\n): void {\n  const processedChunk = processModuleChunk(request, id, moduleMetaData);\n  request.completedModuleChunks.push(processedChunk);\n}\n\nfunction emitSymbolChunk(request: Request, id: number, name: string): void {\n  const processedChunk = processSymbolChunk(request, id, name);\n  request.completedModuleChunks.push(processedChunk);\n}\n\nfunction emitProviderChunk(\n  request: Request,\n  id: number,\n  contextName: string,\n): void {\n  const processedChunk = processProviderChunk(request, id, contextName);\n  request.completedJSONChunks.push(processedChunk);\n}\n\nfunction retrySegment(request: Request, segment: Segment): void {\n  switchContext(segment.context);\n  try {\n    let value = segment.model;\n    while (\n      typeof value === 'object' &&\n      value !== null &&\n      (value: any).$$typeof === REACT_ELEMENT_TYPE\n    ) {\n      // TODO: Concatenate keys of parents onto children.\n      const element: React$Element<any> = (value: any);\n      // Attempt to render the server component.\n      // Doing this here lets us reuse this same segment if the next component\n      // also suspends.\n      segment.model = value;\n      value = attemptResolveElement(\n        element.type,\n        element.key,\n        element.ref,\n        element.props,\n      );\n    }\n    const processedChunk = processModelChunk(request, segment.id, value);\n    request.completedJSONChunks.push(processedChunk);\n  } catch (x) {\n    if (typeof x === 'object' && x !== null && typeof x.then === 'function') {\n      // Something suspended again, let's pick it back up later.\n      const ping = segment.ping;\n      x.then(ping, ping);\n      return;\n    } else {\n      logRecoverableError(request, x);\n      // This errored, we need to serialize this error to the\n      emitErrorChunk(request, segment.id, x);\n    }\n  }\n}\n\nfunction performWork(request: Request): void {\n  const prevDispatcher = ReactCurrentDispatcher.current;\n  const prevCache = getCurrentCache();\n  ReactCurrentDispatcher.current = Dispatcher;\n  setCurrentCache(request.cache);\n  prepareToUseHooksForRequest(request);\n\n  try {\n    const pingedSegments = request.pingedSegments;\n    request.pingedSegments = [];\n    for (let i = 0; i < pingedSegments.length; i++) {\n      const segment = pingedSegments[i];\n      retrySegment(request, segment);\n    }\n    if (request.destination !== null) {\n      flushCompletedChunks(request, request.destination);\n    }\n  } catch (error) {\n    logRecoverableError(request, error);\n    fatalError(request, error);\n  } finally {\n    ReactCurrentDispatcher.current = prevDispatcher;\n    setCurrentCache(prevCache);\n    resetHooksForRequest();\n  }\n}\n\nfunction flushCompletedChunks(\n  request: Request,\n  destination: Destination,\n): void {\n  beginWriting(destination);\n  try {\n    // We emit module chunks first in the stream so that\n    // they can be preloaded as early as possible.\n    const moduleChunks = request.completedModuleChunks;\n    let i = 0;\n    for (; i < moduleChunks.length; i++) {\n      request.pendingChunks--;\n      const chunk = moduleChunks[i];\n      const keepWriting: boolean = writeChunkAndReturn(destination, chunk);\n      if (!keepWriting) {\n        request.destination = null;\n        i++;\n        break;\n      }\n    }\n    moduleChunks.splice(0, i);\n    // Next comes model data.\n    const jsonChunks = request.completedJSONChunks;\n    i = 0;\n    for (; i < jsonChunks.length; i++) {\n      request.pendingChunks--;\n      const chunk = jsonChunks[i];\n      const keepWriting: boolean = writeChunkAndReturn(destination, chunk);\n      if (!keepWriting) {\n        request.destination = null;\n        i++;\n        break;\n      }\n    }\n    jsonChunks.splice(0, i);\n    // Finally, errors are sent. The idea is that it's ok to delay\n    // any error messages and prioritize display of other parts of\n    // the page.\n    const errorChunks = request.completedErrorChunks;\n    i = 0;\n    for (; i < errorChunks.length; i++) {\n      request.pendingChunks--;\n      const chunk = errorChunks[i];\n      const keepWriting: boolean = writeChunkAndReturn(destination, chunk);\n      if (!keepWriting) {\n        request.destination = null;\n        i++;\n        break;\n      }\n    }\n    errorChunks.splice(0, i);\n  } finally {\n    completeWriting(destination);\n  }\n  flushBuffered(destination);\n  if (request.pendingChunks === 0) {\n    // We're done.\n    close(destination);\n  }\n}\n\nexport function startWork(request: Request): void {\n  scheduleWork(() => performWork(request));\n}\n\nexport function startFlowing(request: Request, destination: Destination): void {\n  if (request.status === CLOSING) {\n    request.status = CLOSED;\n    closeWithError(destination, request.fatalError);\n    return;\n  }\n  if (request.status === CLOSED) {\n    return;\n  }\n  if (request.destination !== null) {\n    // We're already flowing.\n    return;\n  }\n  request.destination = destination;\n  try {\n    flushCompletedChunks(request, destination);\n  } catch (error) {\n    logRecoverableError(request, error);\n    fatalError(request, error);\n  }\n}\n\nfunction importServerContexts(\n  contexts?: Array<[string, ServerContextJSONValue]>,\n) {\n  if (contexts) {\n    const prevContext = getActiveContext();\n    switchContext(rootContextSnapshot);\n    for (let i = 0; i < contexts.length; i++) {\n      const [name, value] = contexts[i];\n      const context = getOrCreateServerContext(name);\n      pushProvider(context, value);\n    }\n    const importedContext = getActiveContext();\n    switchContext(prevContext);\n    return importedContext;\n  }\n  return rootContextSnapshot;\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {ReactModel} from 'react-server/src/ReactFlightServer';\nimport type {\n  BundlerConfig,\n  Destination,\n} from './ReactFlightNativeRelayServerHostConfig';\n\nimport {\n  createRequest,\n  startWork,\n  startFlowing,\n} from 'react-server/src/ReactFlightServer';\n\nfunction render(\n  model: ReactModel,\n  destination: Destination,\n  config: BundlerConfig,\n): void {\n  const request = createRequest(model, config);\n  startWork(request);\n  startFlowing(request, destination);\n}\n\nexport {render};\n"],"names":["hasOwnProperty","Object","prototype","isArrayImpl","Array","isArray","a","isModuleReference","reference","JSResourceReferenceImpl","getModuleKey","resolveModuleMetaData","config","resource","resolveModuleMetaDataImpl","processErrorChunk","request","id","message","stack","convertModelToJSON","parent","key","model","json","resolveModelToJSON","jsonArray","i","length","jsonObj","nextKey","call","processModelChunk","processModuleChunk","moduleMetaData","processProviderChunk","contextName","processSymbolChunk","name","scheduleWork","callback","writeChunkAndReturn","destination","chunk","emitRow","closeWithError","error","close","REACT_ELEMENT_TYPE","Symbol","for","REACT_FRAGMENT_TYPE","REACT_PROVIDER_TYPE","REACT_FORWARD_REF_TYPE","REACT_MEMO_TYPE","REACT_LAZY_TYPE","REACT_SERVER_CONTEXT_DEFAULT_VALUE_NOT_LOADED","textEncoder","TextEncoder","stringToPrecomputedChunk","content","encode","END_TAG","INSTANCE_TAG","PLACEHOLDER_TAG","SUSPENSE_PENDING_TAG","SUSPENSE_COMPLETE_TAG","SUSPENSE_CLIENT_RENDER_TAG","SEGMENT_TAG","SUSPENSE_UPDATE_TO_COMPLETE_TAG","SUSPENSE_UPDATE_TO_CLIENT_RENDER_TAG","END","Uint8Array","PLACEHOLDER","INSTANCE","SUSPENSE_PENDING","SUSPENSE_COMPLETE","SUSPENSE_CLIENT_RENDER","SEGMENT","SUSPENSE_UPDATE_TO_COMPLETE","SUSPENSE_UPDATE_TO_CLIENT_RENDER","RAW_TEXT","rootContextSnapshot","currentActiveSnapshot","popNode","prev","context","_currentValue","parentValue","pushNode","next","value","popToNearestCommonAncestor","parentPrev","parentNext","Error","popAllPrevious","pushAllNext","popPreviousToCommonLevel","depth","popNextToCommonLevel","switchContext","newSnapshot","pushProvider","nextValue","prevValue","prevNode","newNode","popProvider","prevSnapshot","_defaultValue","getActiveContext","readContext","isPrimaryRenderer","currentRequest","prepareToUseHooksForRequest","resetHooksForRequest","readContextImpl","Dispatcher","useMemo","nextCreate","useCallback","useDebugValue","useDeferredValue","unsupportedHook","useTransition","getCacheForType","resourceType","currentCache","entry","get","undefined","set","useContext","useReducer","useRef","useState","useInsertionEffect","useLayoutEffect","useImperativeHandle","useEffect","useId","useMutableSource","useSyncExternalStore","useCacheRefresh","unsupportedRefresh","setCurrentCache","cache","getCurrentCache","identifierCount","identifierPrefix","toString","ReactSharedInternals","React","ContextRegistry","getOrCreateServerContext","globalName","createServerContext","ReactCurrentDispatcher","defaultErrorHandler","console","OPEN","CLOSING","CLOSED","createRequest","bundlerConfig","onError","pingedSegments","status","fatalError","Map","nextChunkId","pendingChunks","completedModuleChunks","completedJSONChunks","completedErrorChunks","writtenSymbols","writtenModules","writtenProviders","toJSON","rootContext","createRootContext","rootSegment","createSegment","push","reqContext","importServerContexts","POP","attemptResolveElement","type","ref","props","children","$$typeof","payload","_payload","init","_init","wrappedType","render","_context","__pop","describeValueForErrorMessage","pingSegment","segment","performWork","ping","serializeByValueID","serializeByRefID","escapeStringValue","objectName","object","replace","m","p0","describeKeyForErrorMessage","encodedKey","JSON","stringify","substr","String","describeObjectForErrorMessage","objectOrArray","expandedName","str","array","names","keys","element","x","then","newSegment","logRecoverableError","errorId","emitErrorChunk","moduleReference","moduleKey","existingId","moduleId","emitModuleChunk","providerKey","_globalName","providerId","emitProviderChunk","test","displayName","description","symbolId","emitSymbolChunk","processedChunk","retrySegment","prevDispatcher","current","prevCache","flushCompletedChunks","beginWriting","moduleChunks","keepWriting","splice","jsonChunks","errorChunks","completeWriting","startWork","startFlowing","contexts","prevContext","importedContext"],"mappings":"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"}